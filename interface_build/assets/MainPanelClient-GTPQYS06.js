import{r as f,M as w,j as e,F as ce,b as de,c as me,C as T,u as z,d as ue,P as N,t as pe,e as X,f as ee,i as xe,n as fe,g as he,h as H,k as _e,l as ge,m as je,o as J,p as B,R as r,B as D,q as Q,s as W,v as R,w as O,x as Y,y as te,z as Ne,A as be,D as ve,E as ye,G as we,H as Ce,J as Se,T as Ae,K as Ee,L as ke,N as ae,O as Te,Q as De,S as Ie,U as Me,V as Pe,W as Oe,X as Re,Y as Le,Z as Fe,$ as $e,a0 as Ue,a1 as qe,a2 as ze,a3 as Be,a4 as Ge,a5 as Ve,a6 as He,a7 as Je,a8 as Qe,a9 as We,aa as Ke,ab as Xe,ac as se,ad as ne}from"./index-o99sonZ7.js";import{T as k,m as Ye}from"./messagesEventManager-8aUUZ6gA.js";function q({children:t}){const{clearModal:a}=f.useContext(w),s=({target:l})=>{l.dataset.close&&a(null,{clearLast:!0})};return e.jsx("div",{className:"w-full h-full flex justify-center items-center","data-close":!0,onClick:s,children:e.jsx("div",{className:"p-4 bg-primary-100 text-light dark:bg-primary-300 border border-primary-100 rounded-md",children:t})})}function Ze(){f.useEffect(()=>{const a=localStorage.theme==="dark";document.documentElement.classList.toggle("dark",a)},[]);const t=()=>{const a=localStorage.theme==="dark";document.documentElement.classList.toggle("dark",!a);const s=a?"light":"dark";localStorage.theme=s};return e.jsxs("div",{className:"flex gap-3 px-8",children:[e.jsx(k,{tip:"Notificações",position:"BOTTOM",children:e.jsx("div",{className:"bg-primary-100 rounded-full p-1",children:e.jsx(ce,{className:"text-2xl fill-light cursor-pointer"})})}),e.jsx(k,{tip:"Escolha entre thema light ou dark",position:"BOTTOM",children:e.jsxs("div",{className:"bg-primary-100 rounded-full p-1",onClick:t,children:[e.jsx(de,{className:"text-2xl fill-light cursor-pointer hidden dark:block"}),e.jsx(me,{className:"text-2xl fill-light cursor-pointer block dark:hidden"})]})})]})}function et(){return e.jsx("header",{className:"w-full h-[8%] px-20 min-h-[70px] col-span-8 row-span-1 flex justify-end items-center",children:e.jsx(Ze,{})})}function tt({plan_management_id:t}){const{client:a}=f.useContext(T),{setModalContent:s}=f.useContext(w),l=z(),n=()=>{if(a!=null&&a.plan_management){const o=a.plan_management.plan.max_projects,m=a.plan_management.project.length;a.plan_management.status!=="DISABLED"?o>m?l(`/create-chat/${t}`):s({componentName:"modal_reached_max_plan",components:e.jsx(N,{message:"Você atingiu o número maximo de chats por plano.",componentName:"modal_reached_max_plan"})}):s({componentName:"modal_plan_is_desabled",components:e.jsx(N,{message:"O plano da sua conta está desabilitado.",componentName:"modal_plan_is_desabled",functionAfterComplete:()=>l("/panel?tab=4")})})}else s({componentName:"modal_without_plan",components:e.jsx(N,{message:"Nenhum plano foi vinculado a sua conta",componentName:"modal_without_plan",functionAfterComplete:()=>l("/panel?tab=4")})})};return e.jsx(k,{tip:"Crie um novo chat",children:e.jsx("div",{onClick:n,className:"border border-primary-100 rounded-full cursor-pointer",children:e.jsx(ue,{className:"text-4xl text-primary-100"})})})}function L({children:t,title:a,className:s}){return e.jsxs("div",{className:pe("w-full flex flex-col justify-center items-start p-8 bg-light dark:bg-dark rounded-xl border border-primary-300 relative",s),children:[e.jsx("h2",{className:"w-full mb-8 text-dark dark:text-light text-2xl font-semibold uppercase",children:a}),t]})}function at({slug:t}){const{setModalContent:a}=f.useContext(w),s=f.useRef(null),l=f.useRef(null),n=()=>{window.open(`https://chat.wipzee.com/${t}`)},o=()=>{try{const i=s.current;if(i){i.classList.toggle("disabled"),i.disabled=!1,i.select();var u=document.execCommand("copy");u&&a({componentName:"modal_copy_link",components:e.jsx(N,{message:"Link Copiado!",type:"INFORMATION",componentName:"modal_copy_link"})}),i.classList.toggle("disabled"),i.disabled=!0}}catch{a({componentName:"modal_failed_copy_link",components:e.jsx(N,{message:"Falha ao copiar o link!",type:"ERROR",componentName:"modal_failed_copy_link"})})}},m=()=>{try{const i=l.current;if(i){i.classList.toggle("disabled"),i.disabled=!1,i.select();var u=document.execCommand("copy");u&&a({componentName:"modal_copy_widget",components:e.jsx(N,{message:"Widget Copiado!",type:"INFORMATION",componentName:"modal_copy_widget"})}),i.classList.toggle("disabled"),i.disabled=!0}}catch{a({componentName:"modal_failed_copy_widget",components:e.jsx(N,{message:"Falha ao copiar o link!",type:"ERROR",componentName:"modal_failed_copy_widget"})})}};return e.jsxs("div",{className:"w-full flex flex-col gap-8",children:[e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx("h2",{className:"w-4/5 text-center uppercase",children:"Link do seu chat"}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("input",{ref:s,className:"w-4/5 border border-light/20 p-2 rounded-xl disabled",disabled:!0,defaultValue:`https://chat.wipzee.com/${t}`}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx(X,{onClick:o,className:" text-2xl cursor-pointer"}),e.jsx(ee,{onClick:n,className:" text-2xl cursor-pointer"})]})]}),e.jsx("span",{className:"w-4/5 text-center opacity-60",children:"Esse será o link que você enviará aos usuários que irão acessar seu chat."})]}),e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx("h2",{className:"w-4/5 text-center uppercase",children:"Código do Widget"}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("input",{ref:l,className:"w-4/5 border border-light/20 p-2 rounded-xl disabled",disabled:!0,defaultValue:`<script src="https://widget.wipzee.com/${t}" defer><\/script>`}),e.jsx("div",{className:"w-1/5 flex justify-center items-center gap-4",children:e.jsx(X,{onClick:m,className:" text-2xl cursor-pointer"})})]}),e.jsx("span",{className:"w-4/5 text-center opacity-60",children:"Copie e cole esse código no head do html do seu site."})]})]})}const st=t=>t.errors!=null,nt=(t,a)=>{const s={};for(;t.length;){const l=t[0],{code:n,message:o,path:m}=l,u=m.join(".");if(!s[u])if("unionErrors"in l){const i=l.unionErrors[0].errors[0];s[u]={message:i.message,type:i.code}}else s[u]={message:o,type:n};if("unionErrors"in l&&l.unionErrors.forEach(i=>i.errors.forEach(p=>t.push(p))),a){const i=s[u].types,p=i&&i[l.code];s[u]=he(u,a,s,n,p?[].concat(p,l.message):l.message)}t.shift()}return s},oe=(t,a,s={})=>async(l,n,o)=>{try{const m=await t[s.mode==="sync"?"parse":"parseAsync"](l,a);return o.shouldUseNativeValidation&&xe({},o),{errors:{},values:s.raw?l:m}}catch(m){if(st(m))return{values:{},errors:fe(nt(m.errors,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw m}};function ot({previousSlug:t}){const{watch:a}=H(),[s,l]=f.useState(),n=t.includes("-")?t.split("-")[0]:"";return f.useEffect(()=>{const o=a("step_4.slug");l(o.replaceAll(" ","-"))},[a()]),!!n&&e.jsxs("div",{className:"w-full flex gap-2 items-center bg-white p-2 my-4 rounded-md",children:[e.jsx(_e,{className:"fill-zinc-600"}),e.jsx(ge,{className:"fill-zinc-600"}),e.jsx(je,{className:"fill-zinc-600"}),e.jsxs("div",{className:"w-full bg-zinc-600 rounded-xl p-3 flex gap-2 items-center",children:[e.jsx(J,{className:"fill-green-600"}),e.jsxs("h2",{className:"opacity-80",children:["https://chat.wipzee.com/",n,"-",s]})]})]})}function rt(){const{control:t}=H(),{fields:a,remove:s,append:l}=B({control:t,name:"step_0.social_proof"});return e.jsxs(r.Container,{className:"overflow-auto h-[400px] mt-8",children:[e.jsxs(r.Container,{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione avaliações dos seus clientes:"}),e.jsx("span",{className:"text-sm opacity-70",children:"(Essas avaliações estarão visível na bio do chat)"})]}),e.jsxs(D,{type:"button",onClick:()=>l({}),children:["Adicionar ",e.jsx(Q,{})]})]}),e.jsx(r.Container,{className:"px-4",children:a.map((n,o)=>e.jsxs(r.Container,{className:"w-full flex flex-col gap-6 my-4 p-2 border border-primary-100 relative",children:[e.jsx(W,{className:"absolute -top-3 -right-3 bg-red-800/50 fill-red-500 cursor-pointer rounded-full p-1 text-2xl",onClick:()=>s(o)}),e.jsxs(r.Container,{className:"w-full flex justify-start items-center gap-4",children:[e.jsx(r.File,{name:`step_0.social_proof.${o}.avatar`,sizeContainer:"50px"}),e.jsx(r.Input,{title:"Nome do cliente",name:`step_0.social_proof.${o}.person_name`}),e.jsx(r.Input,{type:"number",title:"Nota da avaliação",name:`step_0.social_proof.${o}.rating`,min:0,max:5})]}),e.jsx(r.TextArea,{name:`step_0.social_proof.${o}.text`,title:"Oque o cliente achou do produto?"}),e.jsxs(r.Container,{className:"flex gap-4 justify-start",children:[e.jsx(r.File,{name:`step_0.social_proof.${o}.images.0`,sizeContainer:"50px"}),e.jsx(r.File,{name:`step_0.social_proof.${o}.images.1`,sizeContainer:"50px"}),e.jsx(r.File,{name:`step_0.social_proof.${o}.images.2`,sizeContainer:"50px"})]})]},n.id))})]})}function lt({project:t,setProjects:a}){var $;const{setModalContent:s,clearModal:l}=f.useContext(w),{setClient:n,client:o}=f.useContext(T),[m,u]=f.useState(),[i,p]=R(),g=Number(i.get(O)),x=Number(i.get(Y))||0,c=te({resolver:oe(Ne),defaultValues:{step_0:{project_name:t.project_name,logo:t.logo,bio:t.bio,social_proof:t.social_proof},step_1:{prompt_id:t.prompt.id,chat_input_message:t.chat_input_message,call_to_action:t.call_to_action},step_2:{facebook_pixel:t.pixel_facebook},step_3:{chat_appearence:{chat_icon:t.chat_appearence.chat_icon,icon_text:t.chat_appearence.icon_text,primary_color:t.chat_appearence.primary_color,second_color:t.chat_appearence.second_color,background:t.chat_appearence.background}},step_4:{slug:($=t.slug)==null?void 0:$.split("-").filter((j,h)=>h!==0).join("")}}}),{fields:d,append:_,remove:b,update:v}=B({control:c.control,name:"step_1.call_to_action"});f.useEffect(()=>{(async()=>{i.set(O,(t.call_to_action.length-1).toString()),p(i);const j=await be(t.plan_management_id);(j==null?void 0:j.status)===200&&u(j.data.prompt)})()},[]);const A=async j=>{let h={};if(Object.keys(j).forEach(y=>{const E=j[y];Object.keys(E).forEach(U=>{h[U]=j[y][U]})}),h&&t.slug){h.chat_appearence.can_update=t.chat_appearence.can_update,h.chat_appearence.id=t.chat_appearence.id;const y=await we(h,t.slug);y&&y.status===200&&(a(E=>{const U=E.findIndex(G=>G.id===t.id),K=E.filter(G=>G.id!==t.id);return h.is_online=y.data.is_online,h.plan_management_id=y.data.plan_management_id,h.id=y.data.id,h.prompt={},h.chat_appearence=y.data.chat_appearence,K.splice(U,0,h),K}),s({componentName:"modal_chat_updated",components:e.jsx(N,{message:"Chat atualizado com sucesso",componentName:"modal_chat_updated",functionAfterComplete:()=>l("modal_edit_project")})}))}};async function M(){if(t.id){const j=await Ce(t.id);if(j&&j.status===200){a(y=>y.filter(E=>E.id!==t.id));const h=o==null?void 0:o.plan_management.project.findIndex(y=>y.id===t.id);o&&h&&(o.plan_management.project.splice(h,1),n(o)),s({componentName:"modal_delete_success",components:e.jsx(N,{message:"Chat excluido com sucesso!",componentName:"modal_delete_success",functionAfterComplete:()=>l(null,{clearAll:!0})})})}}}const P=j=>{const h=c.watch(`step_1.call_to_action.${g}`);d.find(E=>E.button_text===(h==null?void 0:h.button_text)&&E.button_link===h.button_link)||(!d[g].button_text&&h?v(g,{button_text:h.button_text,button_link:h.button_link,button_describe:h.button_describe}):b(d.length-1)),i.set(O,j.toString()),p(i)},C=()=>{var j;if(d.length===0||(j=d[d.length-1])!=null&&j.button_text)if(d.length<3){_({button_describe:"",button_link:"",button_text:""});const h=g+1;i.set(O,h.toString()),p(i)}else s({componentName:"modal_limit_cta",components:e.jsx(N,{message:"Você pode ter no maximo 3 CTA por chat.",componentName:"modal_limit_cta",type:"WARNING"})});else s({componentName:"modal_empty_cta",components:e.jsx(N,{message:"Você precisa preencher o ultimo link, antes de adicionar mais",componentName:"modal_empty_cta"})})},S=j=>{i.set(Y,j.toString()),p(i),c.unregister("step_3.chat_appearence.chat_icon"),c.register("step_3.chat_appearence.chat_icon",{value:j})};return!!(m!=null&&m.length)&&e.jsx("div",{className:"w-[90vw] h-[80vh] min-h-[450px] min-w-[700px] flex",children:e.jsxs(r.EditForm,{form:c,onDelete:M,onSubmit:A,activeSimulator:!0,children:[e.jsxs(r.EditStep,{index:0,titleStep:"Informações do chat",children:[e.jsxs(r.Container,{className:"flex justify-start items-center gap-6",children:[e.jsx(r.File,{name:"step_0.logo",sizeContainer:"80px"}),e.jsx(r.Input,{name:"step_0.project_name",title:"Escreva o nome do seu chat"})]}),e.jsx(r.TextArea,{name:"step_0.bio",title:"Escreva uma descrição para seu chat",height:100}),e.jsx(rt,{})]}),e.jsxs(r.EditStep,{index:1,titleStep:"Configurações do chat",children:[e.jsx(r.Select,{name:"step_1.prompt_id",options:m.map(j=>Object({value:j.id,text:j.prompt_name})),title:"Selecione sua fonte de dados"}),e.jsx(r.TextArea,{name:"step_1.chat_input_message.0",title:"Digite a primeira mensagem do seu chat",height:100}),e.jsxs("div",{className:"flex flex-col ",children:[e.jsxs("div",{className:"flex justify-between py-4",children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione chamadas para ação no seu chat"}),e.jsx("span",{className:"text-sm opacity-70",children:"(Essas CTA serão usadas no contexto da conversa)"})]}),e.jsxs(D,{type:"button",customClass:"bg-primary-200",onClick:C,children:[e.jsx(Q,{}),"  Adicionar link"]})]}),e.jsx("div",{className:"flex justify-center gap-4 border-b border-primary-100/50",children:d.map((j,h)=>h!==g&&!!j.button_text&&e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"w-full flex gap-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer bg-primary-100 px-3 rounded-lg",onClick:()=>P(h),children:[j.button_text,e.jsx(ve,{className:"text-xl"})]})})},j.id))}),e.jsx("div",{className:"flex justify-center p-4",children:d.map((j,h)=>h===g&&e.jsxs(r.Container,{className:"flex gap-4",children:[e.jsxs(r.Container,{className:"flex flex-col gap-8",children:[e.jsxs(r.Container,{className:"flex gap-4",children:[e.jsx(r.Input,{name:`step_1.call_to_action.${h}.button_text`,title:"Digite o texto do link"}),e.jsx(r.Input,{name:`step_1.call_to_action.${h}.button_link`,title:"Digite a url do link"})]}),e.jsx(r.TextArea,{name:`step_1.call_to_action.${h}.button_describe`,title:"Digite a descrição do link"})]}),e.jsx(W,{className:"text-2xl fill-red-500 bg-red-900/50 rounded-full mt-4 cursor-pointer",onClick:()=>{b(h),i.set(O,(h-1).toString()),p(i)}})]},j.id))})]})]}),e.jsx(r.EditStep,{index:2,titleStep:"Eventos e rastreamentos",children:e.jsx(r.Input,{name:"step_2.facebook_pixel",title:"Adicione o pixel do seu facebook"})}),e.jsx(r.EditStep,{index:3,titleStep:"Aparência do chat",children:e.jsxs(r.Container,{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"flex flex-col justify-center gap-4",children:[e.jsx("h2",{className:"text-center text-xl",children:"Escolha um icone para seu chat"}),e.jsx("div",{className:"flex justify-center gap-8 text-5xl",children:ye.map(({Icon:j,id:h},y)=>e.jsx(j,{"data-iscurrent":x===y,className:"hover:bg-primary-100 data-[iscurrent=true]:bg-primary-100 cursor-pointer rounded-full p-2",onClick:()=>S(h)},h))})]}),e.jsx(r.Input,{name:"step_3.chat_appearence.icon_text",title:"Digite o texto que será exibido ao lado do icon"}),e.jsxs(r.Container,{className:"flex",children:[e.jsx(r.Color,{name:"step_3.chat_appearence.primary_color",title:"Escolha a cor primária do seu chat"}),e.jsx(r.Color,{name:"step_3.chat_appearence.second_color",title:"Escolha a cor secundária do seu chat"})]}),e.jsx(r.Color,{name:"step_3.chat_appearence.background",title:"Escolha a cor do background do seu chat"})]})}),e.jsx(r.EditStep,{index:4,titleStep:"Configuração avançadas",children:e.jsxs(r.Container,{className:"flex flex-col",children:[e.jsx(r.Input,{name:"step_4.slug",title:"Altere a slug do seu chat"}),e.jsx(ot,{previousSlug:(t==null?void 0:t.slug)||""})]})})]})})}function it({project:t,setNewProject:a,prompts:s}){const{setModalContent:l}=f.useContext(w),n=z(),o=()=>{l({componentName:"modal_edit_project",components:e.jsx(q,{children:e.jsx(lt,{setProjects:a,project:t,prompts:s})})})},m=async(p,g)=>{if(!g)return l({componentName:"modal_failed_updated_status_chat",components:e.jsx(N,{message:"Falha ao atualizar o status do chat, reinicie a página e tente novamente",componentName:"modal_failed_updated_status_chat",type:"WARNING"})}),!1;const x=await Ee(p,g);return(x==null?void 0:x.status)===200?(a(c=>(c.find(d=>d.id===x.data.id).is_online=x.data.is_online,c)),!0):(l({componentName:"modal_failed_updated_status_chat_02",components:e.jsx(N,{message:"Falha ao atualizar o status do chat, reinicie a página e tente novamente",componentName:"modal_failed_updated_status_chat_02",type:"WARNING"})}),!1)},u=()=>{if(!t.slug){l({componentName:"modal_failed_display_link",components:e.jsx(N,{message:"Falha ao exibir seus links",type:"ERROR",componentName:"modal_failed_display_link"})});return}l({componentName:"modal_display_share_project",components:e.jsx(q,{children:e.jsx(at,{slug:t.slug})})})},i=({target:p})=>{p.dataset.metric&&n("/panel?tab=1")};return t&&e.jsxs("div",{className:"w-1/4 min-w-[200px] bg-gray  relative flex flex-col items-center gap-2 cursor-pointer rounded-xl",onClick:i,"data-metric":!0,children:[e.jsxs("div",{className:"w-full flex justify-between items-center gap-2 p-2",children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(k,{tip:"Veja todos os seus links",children:e.jsx(ee,{className:" text-xl",onClick:u})}),e.jsx(k,{tip:"Edite seu chat",children:e.jsx(Se,{className:"text-xl",onClick:o})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(k,{tip:"Ative ou desative seu chat",children:e.jsx(Ae,{isActive:t.is_online,template:"onOff",cb:p=>m(p,t.slug)})})})]}),e.jsx("div",{className:"w-[150px] h-[110px] rounded-xl overflow-hidden","data-metric":!0,children:e.jsx("img",{src:t.logo||"https://via.placeholder.com/100",alt:"imagem do projeto",className:"w-full h-full object-cover"})}),e.jsx("h2",{className:"text-center py-4 font-bold text-lg","data-metric":!0,children:t.project_name})]},t.slug)}function ct(){var l;const{client:t}=f.useContext(T),[a,s]=f.useState(t!=null&&t.plan_management?t.plan_management.project:[]);return t&&e.jsx(L,{title:"Meus chats",children:e.jsxs("div",{className:"w-4/5 flex flex-col gap-8",children:[e.jsx("div",{className:"w-full flex justify-end items-center",children:e.jsx(tt,{plan_management_id:(l=t==null?void 0:t.plan_management)==null?void 0:l.id})}),a.length?e.jsx("div",{className:"w-full flex flex-col gap-4",children:e.jsx("div",{className:"w-full flex items-center gap-4",children:a.map(n=>{var o;return e.jsx(it,{project:n,setNewProject:s,prompts:(o=t.plan_management)==null?void 0:o.prompt},n.id)})})}):e.jsx("h2",{className:"py-8 font-bold",children:'Você ainda não possui nenhum chat, clique em "Novo chat" para começar seu primeiro projeto.'})]})})}function dt({setColumns:t,columns:a,modalName:s}){const{clearModal:l}=f.useContext(w),[n,o]=f.useState(a),m=i=>{const p=i.currentTarget.dataset.status=="true",g=i.currentTarget.dataset.name;o(()=>[...a.filter((x,c)=>(c>1&&x.columnName===g&&(x.status=!p),x))])},u=()=>{localStorage.setItem("metricColumnActive",JSON.stringify(a)),t(a),l(s)};return e.jsxs("div",{className:"w-1/2 max-w-[400px] bg-zinc-800 text-light",children:[e.jsx("h2",{className:"w-full text-center text-xl p-4",children:"Organize suas columns"}),e.jsx("div",{className:"w-full flex gap-2 flex-col",children:n.map((i,p)=>e.jsxs("div",{className:"w-full flex justify-between px-4",children:[e.jsx("p",{children:i.columnName}),e.jsx("div",{className:"w-[30px] h-[20px] bg-zinc-100 flex overflow-hidden rounded-full cursor-pointer",style:{justifyContent:`${i.status?"end":"start"}`},onClick:m,"data-status":i.status,"data-name":i.columnName,children:e.jsx("div",{className:"w-2/3 h-full rounded-xl flex justify-center items-center",style:{background:`${i.status?"green":"red"}`},children:p<2&&e.jsx(J,{className:"w-[8px]"})})})]},i.columnName))}),e.jsx("div",{className:"w-full flex mt-12 justify-center",children:e.jsx(D,{onClick:u,children:"Salvar"})})]})}const mt=[{short:"Jan",complete:"Janeiro"},{short:"Fev",complete:"Fevereiro"},{short:"Mar",complete:"Março"},{short:"Abr",complete:"Abril"},{short:"Mai",complete:"Maio"},{short:"Jun",complete:"Junho"},{short:"Jul",complete:"Julho"},{short:"Ago",complete:"Agosto"},{short:"Set",complete:"Setembro"},{short:"Out",complete:"Outubro"},{short:"Nov",complete:"Novembro"},{short:"Dez",complete:"Dezembro"}];function F(t){const a=new Date(t);a.toLocaleTimeString("pt-BR",{hour12:!1});const s=a.getTimezoneOffset(),l=a.getMonth(),n=a.getUTCHours()-s/60,o=a.toLocaleDateString(),m=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`,u=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,i=`${a.getDay()} de ${mt[l].short} - ${u}`;return{currentHour:n,fullDate:o,fullHour:m,shortHour:u,dateFormat_A:i,fullDateWithHour:`${o} - ${m}`}}function re({options:t,alternativeTitle:a,title:s,Icon:l,defaultValue:n,handleSelectDatabase:o}){return e.jsxs("div",{className:"w-full px-2 h-full bg-gray border border-primary-100 font-bold rounded-lg flex gap-2 justify-center items-center",children:[l&&e.jsx(l,{className:"text-2xl"}),e.jsxs("select",{className:"h-full bg-gray cursor-pointer outline-none ",disabled:!t.length,onChange:o,defaultValue:n||"#",children:[s&&a&&e.jsx("option",{disabled:!0,value:"#",className:"cursor-pointer",children:t.length?s:a}),t.map((m,u)=>e.jsx("option",{value:m.id,className:"cursor-pointer",children:m.name},u))]})]})}function le({typeFilter:t}){const[a,s]=R(),l=({target:n})=>{const o=F(new Date).currentHour,m=n,{value:u}=n.options[m.selectedIndex];var i=0;switch(u){case"today":i=o;break;case"yesterday":i=o+24;break;case"last_7_days":i=o+6*24;break;case"last_14_days":i=o+13*24;break;case"last_month":i=o+29*24;break;case"last_3_month":i=o+89*24;break;case"last_6_month":i=o+179*24;break;case"last_year":i=o+364*24;break;default:i=0;break}const p=new URLSearchParams(a);p.set(t,i.toString()),s(p)};return e.jsx(re,{handleSelectDatabase:l,Icon:ke,options:[{id:"0",name:"Todas as datas"},{id:"today",name:"Hoje"},{id:"yesterday",name:"Ontem"},{id:"last_7_days",name:"Ultimos 7 dias"},{id:"last_14_days",name:"Ultimos 14 dias"},{id:"last_month",name:"Ultimo mês"},{id:"last_3_month",name:"Ultimos 3 meses"},{id:"last_6_month",name:"Ultimos 6 meses"},{id:"last_year",name:"Ultimo ano"}]})}function ut({client:t,handleRequestDataProject:a,setColumns:s,columns:l}){const{setModalContent:n}=f.useContext(w),o=async({currentTarget:u})=>{if(t!=null&&t.plan_management){const i=u.querySelector("svg");i.classList.add("rotate-[-360deg]","transition-transform","duration-1000"),a(t==null?void 0:t.id);const p=setTimeout(()=>{i.classList.remove("rotate-[-360deg]","transition-transform","duration-1000"),clearTimeout(p)},1e3)}},m=()=>{n({componentName:"modal_organization_column",components:e.jsx(dt,{modalName:"modal_organization_column",setColumns:s,columns:l})})};return e.jsxs("div",{className:"w-full flex gap-8 justify-end items-center",children:[e.jsx("div",{className:"p-2 bg-dark border border-primary-100 rounded-md cursor-pointer",onClick:o,children:e.jsx(ae,{className:"text-xl"})}),e.jsx("div",{className:"h-[40px]",children:e.jsx(le,{typeFilter:"filter_time_metric"})}),e.jsxs(D,{onClick:m,customClass:"bg-dark border border-primary-100 px-4",children:[" ",e.jsx(Te,{className:"text-xl"})," Organize as colunas"]})]})}const V=[{key:"IS_ONLINE",columnName:"status",status:!0,dataType:"boolean"},{key:"NAME",columnName:"Nome do chat",status:!0,dataType:"string"},{key:"CAT",columnName:"Chats abertos (total)",status:!0,dataType:"number"},{key:"CAU",columnName:"Chats abertos (unico)",status:!1,dataType:"number"},{key:"MESSAGE_INPUT",columnName:"Mensagens de entrada",status:!1,dataType:"number"},{key:"MESSAGE_OUTPUT",columnName:"Mensagens de saída",status:!1,dataType:"number"},{key:"MESSAGES_TOTAL",columnName:"Mensagens total",status:!0,dataType:"number"},{key:"MEDIA_MESSAGES_CHAT",columnName:"Mensagens por chat",status:!1,dataType:"number"},{key:"USAGE_TIME",columnName:"Tempo de uso",status:!1,dataType:"string"},{key:"MEDIA_USAGE_TIME",columnName:"Tempo de uso por chat",status:!0,dataType:"string"},{key:"LINK_CLICKS",columnName:"Cliques no link",status:!0,dataType:"number"},{key:"LEADS_COLLECTED",columnName:"Leads coletados",status:!0,dataType:"number"},{key:"SERVICE_NOTE",columnName:"Nota de atendimento",status:!0,dataType:"number"},{key:"RESOLUTION_RATE",columnName:"Taxa de resolução",status:!0,dataType:"number"},{key:"CREATED_AT",columnName:"Criado em",status:!0,dataType:"string"}];function pt({setColumns:t,columns:a}){return f.useEffect(()=>{const s=JSON.parse(localStorage.getItem("metricColumnActive")||"[]");s.length>0?s.length!==V.length?localStorage.setItem("metricColumnActive",JSON.stringify(V)):t(s):localStorage.setItem("metricColumnActive",JSON.stringify(V))},[]),a&&e.jsx("div",{className:"w-1/2 flex",children:a.map(s=>s.status&&e.jsx("span",{className:"w-48 flex-none p-3 text-center bg-primary-300 border-r border-r-primary-100",children:s.columnName},s.columnName))})}function I(t){const a=Number(new Date),s=Number(new Date(t)),n=(a-s)/(1e3*3600);return Math.floor(n)}function Z(t,a=0){function s(){return t.metric.chat_event.reduce((c,d)=>{const _=d.open_chat.filter(b=>{const v=I(b.created_at);return a>0?v<=a:!0});return c+_.length},0)}function l(){return(t.metric.chat_event.filter(d=>{const _=I(d.created_at);return a>0?_<=a:!0})||[]).filter((d,_,b)=>_===b.findIndex(v=>v.guest_id===d.guest_id)).length}function n(){return t.plan_message_manager.filter(c=>{const d=I(c.created_at);return a>0?d<=a:!0},0).reduce((c,d)=>c+d.input,0)}function o(){return t.plan_message_manager.filter(c=>{const d=I(c.created_at);return a>0?d<=a:!0},0).reduce((c,d)=>c+d.output,0)}function m(){const x=n()+o(),c=l()>0?x/l():0;return c%1===0?c:Number(c.toFixed(1))}function u(){const x=t.metric.chat_event.reduce((v,A)=>{const M=A.chat_time.filter(P=>{const C=I(P.created_at);return a>0?C<=a:!0});return v+M.reduce((P,C)=>{if(!C.closed_at&&!C.created_at)return 0;const S=Number(new Date(C.closed_at))-Number(new Date(C.created_at));return P+S},0)},0),c=Math.floor(x/1e3),d=Math.floor(c/60);return`${Math.floor(d/60).toString().padStart(2,"0")}:${(d%60).toString().padStart(2,"0")}:${(c%60).toString().padStart(2,"0")}`}function i(){const x=t.metric.chat_event.reduce((A,M)=>{const P=M.chat_time.filter(C=>{const S=I(C.created_at);return a>0?S<=a:!0});return A+P.reduce((C,S)=>{if(!S.closed_at&&!S.created_at)return 0;const $=Number(new Date(S.closed_at))-Number(new Date(S.created_at));return C+$},0)},0),c=x>0?x/l():0,d=Math.floor(c/1e3),_=Math.floor(d/60),b=Math.floor(_/60),v=`${b.toString().padStart(2,"0")}:${(_%60).toString().padStart(2,"0")}:${(d%60).toString().padStart(2,"0")}`;return b!==1/0?v:"00:00:00"}function p(){return t.metric.button_event.filter(c=>{const d=I(c);return a>0?d<=a:!0},0).reduce((c,d)=>c+d.clicked_button.length,0)}function g(){return F(t.created_at).dateFormat_A}return{IS_ONLINE:t.is_online||!1,NAME:t.project_name,CAT:s(),CAU:l(),MESSAGE_INPUT:n(),MESSAGE_OUTPUT:o(),MESSAGES_TOTAL:n()+o(),MEDIA_MESSAGES_CHAT:m(),USAGE_TIME:u(),MEDIA_USAGE_TIME:i(),CREATED_AT:g(),LINK_CLICKS:p(),LEADS_COLLECTED:0,SERVICE_NOTE:0,RESOLUTION_RATE:0,TOKEN_INPUT:"0",TOKEN_OUTPUT:"0",TOKEN_TOTAL:"0",USED_REAL:"0"}}function xt({columns:t,setColumns:a,planManagement:s}){const[l]=R(),n=l.get("filter_time_metric");return e.jsxs("div",{className:"w-[70vw] h-[40vh] self-center rounded-xl overflow-x-auto",children:[e.jsx(pt,{setColumns:a,columns:t}),e.jsx("div",{className:"flex flex-col",children:s!=null&&s.project?s.project.map(o=>e.jsx("div",{className:"flex-none flex",children:t.map((m,u)=>m.status&&e.jsx("span",{className:"w-48 flex-none text-ellipsis overflow-hidden whitespace-nowrap text-center border border-primary-100/30 p-2",children:u===0?e.jsxs("div",{className:"w-full flex justify-center items-center gap-2",children:[e.jsx("div",{className:`w-[8px] h-[8px] ${o.is_online?"bg-green-700":"bg-red-700"} rounded-full`}),e.jsx("span",{children:o.is_online?"Ativo":"Desativado"})]}):u===1?o.project_name:Z(o,n)[m.key]},m.columnName))},o.id)):e.jsx("h2",{className:"text-center p-4",children:'Você ainda não criou nenhum chat, clique em "Meus chats" , depois criar "Novo chat".'})}),e.jsx("div",{className:"flex-none flex bg-primary-300",children:t.map((o,m)=>o.status&&e.jsx("div",{className:"w-48 flex-none p-2 flex justify-center items-center gap-2",children:m===1?e.jsx("span",{className:"w-full font-bold text-primary-100 text-xl text-center",children:"TOTAL"}):o.dataType==="number"?e.jsx("span",{className:"w-full font-bold text-primary-100 text-xl text-center",children:s==null?void 0:s.project.reduce((u,i)=>u+Number(Z(i,n)[o.key]),0)}):e.jsx("span",{className:"w-full text-primary-100 text-xl text-center",children:"-"})},o.key))})]})}function ft(){const t=JSON.parse(localStorage.getItem("metricColumnActive")||"[]"),{setModalContent:a}=f.useContext(w),{client:s}=f.useContext(T),[l,n]=f.useState(t),[o,m]=f.useState(s==null?void 0:s.plan_management);f.useEffect(()=>{s!=null&&s.plan_management&&u(s==null?void 0:s.id)},[]);const u=async i=>{const p=await De(i);(p==null?void 0:p.status)===200?m(p.data.plan_management):a({componentName:"modal_failed_load_metric",components:e.jsx(N,{message:"Falha ao recarregar as métricas, tente reiniciar a página.",type:"ERROR",componentName:"modal_failed_load_metric"})})};return e.jsx("div",{className:"w-full h-full overflow-y-auto flex flex-col gap-8",children:e.jsxs(L,{title:"Métricas",className:"flex-col gap-8",children:[e.jsx(ut,{client:s,columns:l,handleRequestDataProject:u,setColumns:n}),e.jsx(xt,{columns:l,planManagement:o,setColumns:n})]})})}function ht({plan_management_id:t}){const{client:a}=f.useContext(T),{setModalContent:s}=f.useContext(w),l=z(),n=()=>{if(a!=null&&a.plan_management){const o=a.plan_management.plan.max_databases,m=a.plan_management.prompt.length;a.plan_management.status!=="DISABLED"?o>m?l(`/create-database/${t}`):s({componentName:"modal_max_database",components:e.jsx(N,{message:"Você atingiu o número maximo de base de dados no seu plano.",componentName:"modal_max_database"})}):s({componentName:"modal_desactive_account",components:e.jsx(N,{message:"O plano da sua conta está desabilitado.",componentName:"modal_desactive_account"})})}else s({componentName:"modal_without_plan",components:e.jsx(N,{message:"Nenhum plano foi vinculado a sua conta",componentName:"modal_without_plan"})})};return e.jsx(Ie,{className:"w-[300px] text-5xl py-3",onClick:n})}function _t(){const{control:t}=H(),{append:a,remove:s,fields:l}=B({control:t,name:"step_6.questions"});return e.jsxs("div",{className:"w-full flex flex-col gap-6 justify-center items-center",children:[e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione as perguntas e as respostas frequentes"}),e.jsxs(D,{type:"button",onClick:()=>a({ask:"",answer:""}),children:["Adicionar",e.jsx(Q,{className:"text-lg"})]})]}),e.jsx("div",{className:"w-full flex flex-col gap-4",children:l.map((n,o)=>e.jsxs("div",{className:"w-full flex gap-4 justify-center items-center",children:[e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(r.Input,{name:`step_6.questions.${o}.ask`,title:"Digite uma pergunta"}),e.jsx(r.Input,{name:`step_6.questions.${o}.answer`,title:"Digite a resposta"})]}),e.jsx("div",{children:e.jsx(W,{className:"fill-red-700 bg-red-900/50 rounded-full p-1 text-2xl cursor-pointer",onClick:()=>s(o)})})]},n.id))})]})}function gt({prompt:t,setPrompts:a}){const{setModalContent:s,clearModal:l}=f.useContext(w),n=JSON.parse(t.prompt_query||"{}"),o=!!Object.keys(n).length,m=te({resolver:oe(ze),defaultValues:o?{step_0:{who_created:n.step_0.who_created||"",andvisa_record:n.step_0.andvisa_record||"",how_works:n.step_0.how_works||"",what_is:n.step_0.how_works||""},step_1:{benefits:n.step_1.benefits||"",contraindications:n.step_1.contraindications||"",ingredients:n.step_1.ingredients||"",side_effects:n.step_1.side_effects||""},step_2:{average_delivery_time:{end:n.step_2.average_delivery_time.end||0,start:n.step_2.average_delivery_time.start||0},order_tracking:n.step_2.order_tracking||"",tracking_link:n.step_2.tracking_link||""},step_3:{days_of_warranty:n.step_3.days_of_warranty||0,disclaimer:n.step_3.disclaimer||"",how_exchanges_work_and_returns:n.step_3.how_exchanges_work_and_returns||"",how_guarantee_work:n.step_3.how_guarantee_work||""},step_4:{how_to_buy:n.step_4.how_to_buy||"",payment_methods:n.step_4.payment_methods||"",products:n.step_4.products||""},step_5:{address:n.step_5.address||"",CNPJ:n.step_5.CNPJ||"",company_name:n.step_5.company_name||"",contact_email:n.step_5.contact_email||"",contact_phone_number:n.step_5.contact_phone_number||"",support_hours:n.step_5.support_hours||""},step_6:{questions:n.step_6.questions||""},step_7:{client_describe:n.step_7.client_describe||"",ia_name:n.step_7.ia_name||"",restrictions:n.step_7.restrictions}}:void 0}),{fields:u,append:i,remove:p}=B({control:m.control,name:"step_4.products"}),g=async c=>{const d=JSON.stringify(c),b={prompt:Be(c),prompt_query:d,client_describe:c.step_7.client_describe};if(b){const v=await Ge(b,t.id);v&&v.status===200&&(a(A=>[...A.filter(M=>M.id!==v.data.id),v.data]),s({componentName:"modal_updated_database",components:e.jsx(N,{message:"Database atualizado com sucesso",componentName:"modal_updated_database",functionAfterComplete:()=>l(null,{clearAll:!0})})}))}};async function x(){if(t.id){const c=await Ve(t.id);(c==null?void 0:c.status)===200?(localStorage.removeItem(He),a(d=>d.filter(_=>_.id!==c.data.id)),s({componentName:"modal_delete_success",components:e.jsx(N,{message:"Fonte de dados excluido com sucesso!",componentName:"modal_delete_success",functionAfterComplete:()=>l(null,{clearAll:!0})})})):(c==null?void 0:c.status)===500&&s({componentName:"modal_failed_delete_database",components:e.jsx(N,{message:"Você não pode excluir uma fonte de dados que possui um chat vinculado a ela, tente excluir todos os chats primeiro, antes de excluir essa fonte de dados.",type:"ERROR",componentName:"modal_failed_delete_database"})})}}return e.jsx("div",{className:"w-[80vw] h-[70vh] flex overflow-auto ",children:e.jsxs(r.EditForm,{form:m,onDelete:x,onSubmit:g,children:[e.jsxs(r.EditStep,{index:0,titleStep:"Informações básicas",icon:e.jsx(Me,{}),children:[e.jsx(r.Input,{title:"Quem foi o criador desse produto?",name:"step_0.who_created"}),e.jsx(r.TextArea,{title:"Conte um pouco sobre seu produto...",height:100,name:"step_0.what_is"}),e.jsx(r.TextArea,{title:"Como ele funciona?",height:100,name:"step_0.how_works"}),e.jsx(r.Optional,{text:"O produto possui registro na ANVISA?",children:e.jsx(r.Input,{title:"Digite o registro da ANVISA:",name:"step_0.andvisa_record"})})]}),e.jsxs(r.EditStep,{index:1,titleStep:"Informações avançadas",icon:e.jsx(Pe,{}),children:[e.jsx(r.TextArea,{name:"step_1.benefits",title:"Quais são os beneficios do seu produto?"}),e.jsx(r.TextArea,{name:"step_1.ingredients",title:"Quais são os ingredientes do seu produto?"}),e.jsx(r.Optional,{active:!0,text:"Esse produto possui alguma contra indicação?",name:"step_1.contraindications",children:e.jsx(r.TextArea,{name:"step_1.contraindications",title:"Quais são as contra-indicações do seu produto?"})}),e.jsx(r.Optional,{active:!0,text:"Existe algum efeito colateral?",name:"step_1.side_effects",children:e.jsx(r.TextArea,{name:"step_1.side_effects",title:"Quais?"})})]}),e.jsxs(r.EditStep,{index:2,titleStep:"Entrega do produto",icon:e.jsx(Oe,{}),children:[e.jsxs(r.Container,{className:"flex gap-4",title:"Qual o prazo médio em dias para entrega:",children:[e.jsx(r.Input,{type:"number",min:1,max:365,name:"step_2.average_delivery_time.start",title:"de:",joinAtInput:"dia(s)"}),e.jsx(r.Input,{type:"number",min:1,max:365,name:"step_2.average_delivery_time.end",title:"até:",joinAtInput:"dia(s)"})]}),e.jsx(r.TextArea,{name:"step_2.order_tracking",title:"Como os clientes podem rastrear seu pedido?"}),e.jsx(r.Optional,{active:!1,text:"Você possui link para rastrear pedido?",children:e.jsx(r.Input,{title:"Digite a url do site:",name:"step_2.tracking_link",onChange:({target:c})=>{c.value.toLowerCase().includes("http")||(c.value=`https://${c.value.replace("http","")}`)}})})]}),e.jsxs(r.EditStep,{index:3,titleStep:"Politicas e condições",icon:e.jsx(Re,{}),children:[e.jsx(r.Input,{type:"number",name:"step_3.days_of_warranty",title:"Quantos dias o cliente tem de garantia?"}),e.jsx(r.TextArea,{name:"step_3.how_guarantee_work",title:"Como funciona a garantia?"}),e.jsx(r.TextArea,{name:"step_3.how_exchanges_work_and_returns",title:"Como funciona as trocas e devoluções?"}),e.jsx(r.Optional,{active:!1,text:"Gostaria de deixar um disclaimer para seus clientes?",children:e.jsx(r.TextArea,{name:"step_3.disclaimer",title:"Aviso legal ( Disclaimer )"})})]}),e.jsxs(r.EditStep,{index:4,titleStep:"Métodos de pagamentos",icon:e.jsx(Le,{}),children:[e.jsx(r.Container,{className:"flex gap-4",title:"Quais são os métodos de pagamentos aceitos?",children:e.jsx(r.Select,{title:"Escolha seus métodos de pagamentos",isMultiple:!0,name:"step_4.payment_methods",options:[{value:"Pix",text:"Pix"},{value:"Boleto",text:"Boleto"},{value:"Cartão de débito",text:"Cartão de débito"},{value:"Cartão de crédito",text:"Cartão de crédito"},{value:"Pagamentos em aplicativo",text:"Pagamentos em aplicativo"}]})}),e.jsx(r.TextArea,{name:"step_4.how_to_buy",title:"como comprar seu produto?"}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("div",{className:"w-full flex justify-end",children:e.jsx(D,{type:"button",onClick:()=>i({name:"",value:"R$ 0"}),children:" Adicionar produto"})}),e.jsx(r.Container,{className:"flex flex-col gap-4",children:u.map((c,d)=>e.jsxs("div",{className:"flex justify-center items-center gap-8",children:[e.jsxs("div",{className:"w-4/5 flex gap-6 justify-center items-center",children:[e.jsx(r.Input,{name:`step_4.products.${d}.name`,title:"De um nome a esse produto:"}),e.jsx(r.Input,{name:`step_4.products.${d}.value`,onChange:({target:_})=>{const v=(parseFloat(_.value.replace(/[^\d]/g,""))/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});_.value=v},title:"Qual o valor do produto?"})]}),e.jsx(Fe,{onClick:()=>p(d),className:"fill-red-500 text-2xl cursor-pointer"})]},c.id))})]})]}),e.jsxs(r.EditStep,{index:5,titleStep:"Sobre a empresa",icon:e.jsx($e,{}),children:[e.jsxs(r.Container,{className:"flex gap-4",children:[e.jsx(r.Input,{name:"step_5.company_name",title:"Qual o nome da empresa?"}),e.jsx(r.Input,{title:"Qual o seu CNPJ?",name:"step_5.CNPJ",onChange:({target:c})=>{if(c.value.length<=18){const _=c.value.replace(/[^\d]/g,"").replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/,"$1.$2.$3/$4-$5");c.value=_}else c.value=c.value.substring(0,18)}})]}),e.jsx(r.Input,{name:"step_5.address",title:"Qual o endereço da sua empresa?"}),e.jsxs(r.Container,{className:"flex gap-4",children:[e.jsx(r.Input,{name:"step_5.contact_email",title:"Digite um e-mail para contato"}),e.jsx(r.Input,{title:"Digite um telefone para contato",name:"step_5.contact_phone_number",onChange:({target:c})=>{const d=c.value.replace(/[^\d]/g,"");if(d.length<11){let _;d.length===11?_=d.replace(/^(\d{2})(\d{1})(\d{4})(\d{4})$/,"($1) $2 $3-$4"):_=d.replace(/^(\d{2})(\d{4})(\d{4})$/,"($1) $2-$3"),c.value=_}else c.value=c.value.substring(0,15)}})]}),e.jsx(r.Input,{name:"step_5.support_hours",title:"Qual seu horário para suporte humano?"})]}),e.jsx(r.EditStep,{index:6,titleStep:"Perguntas frequentes",icon:e.jsx(Ue,{}),children:e.jsx(_t,{})}),e.jsxs(r.EditStep,{index:7,titleStep:"Personalidade da IA ",icon:e.jsx(qe,{}),children:[e.jsx(r.Optional,{text:"Deseja dar um nome a sua inteligência artificial?",active:!1,children:e.jsx(r.Input,{name:"step_7.ia_name",title:"Qual o nome da sua inteligência artificial?"})}),e.jsx(r.Optional,{text:"Deseja adicionar restrições de palavras ou frase?",active:!1,name:"step_7.restrictions",children:e.jsx(r.Input,{name:"step_7.restrictions",title:"Faça uma lista de restrições para que a IA evite utiliza-la em uma conversa"})}),e.jsx(r.TextArea,{title:"Faça uma breve descrição de quem é seu público (cliente)",name:"step_7.client_describe"})]})]})})}function jt(){var i;const{client:t}=f.useContext(T),{setModalContent:a,clearModal:s}=f.useContext(w),l=Array(Je).fill(0),[n,o]=f.useState(((i=t==null?void 0:t.plan_management)==null?void 0:i.prompt)||[]),m=p=>{n!=null&&n.length&&a({componentName:"modal_create_database",components:e.jsx(q,{children:e.jsx(gt,{prompt:n[p],setPrompts:o})})})},u=p=>{async function g(x){x.preventDefault();const c=x.target.querySelector("input").value,d=n[p].id;if(c){const _=await Ke(c,d);(_==null?void 0:_.status)===200&&(o([...n,n[p].prompt_name=c]),a({componentName:"modal_saved",components:e.jsx(N,{message:"Nome da sua base de dados foi atualizado com sucesso!",componentName:"modal_saved",functionAfterComplete:()=>s(null,{clearAll:!0})})}))}}a({componentName:"modal_edit_name",components:e.jsx(q,{children:e.jsxs("div",{className:"flex flex-col justify-center items-center gap-4",children:[e.jsx("h2",{children:"Digite o novo nome da sua fonte de dados:"}),e.jsxs("form",{onSubmit:g,className:"flex flex-col justify-center items-center gap-4",children:[e.jsx("input",{placeholder:"Ex: Minha nova base de dados",name:"database_name",defaultValue:n[p].prompt_name}),e.jsx(D,{children:"Salvar"})]})]})})})};return t&&e.jsx(L,{title:"Fonte de dados",children:e.jsx("div",{className:"w-full flex-wrap flex justify-center p-4 my-12 gap-8",children:l.map((p,g)=>{var x,c,d,_,b;return(x=t.plan_management)!=null&&x.plan&&g<t.plan_management.plan.max_databases?e.jsx("div",{"data-prompt":!!((c=n[g])!=null&&c.prompt_name),className:"flex justify-center items-center rounded-xl cursor-pointer border border-primary-100 bg-primary-300 hover:bg-primary-200 text-xl data-[prompt=false]:text-2xl data-[prompt=false]:bg-primary-200/20",children:(d=n[g])!=null&&d.prompt_name?e.jsxs("div",{className:"w-[300px] flex gap-2 items-center justify-center",children:[e.jsxs("h2",{className:"w-[200px] text-center py-4 flex justify-center items-center gap-2 ",onClick:()=>m(g),children:[e.jsx(Qe,{}),e.jsx("span",{className:"w-full whitespace-nowrap text-ellipsis overflow-x-hidden",children:(_=n[g])==null?void 0:_.prompt_name})]}),e.jsx(We,{className:"cursor-text ",onClick:()=>u(g)})]}):e.jsx(ht,{plan_management_id:t.plan_management.id})},g):e.jsx("div",{"data-prompt":!!((b=n[g])!=null&&b.prompt_name),className:"flex opacity-30 cursor-not-allowed justify-center items-center rounded-xl border border-primary-100 bg-primary-300 hover:bg-primary-200 text-xl data-[prompt=false]:text-2xl data-[prompt=false]:bg-primary-200/20",children:e.jsx(J,{className:"w-[300px] py-3 text-5xl"})},g)})})})}function Nt({chats:t,setIndex:a}){const s=l=>{a(l)};return e.jsx("div",{className:"w-1/3 flex flex-col border-r border-light/40",children:t==null?void 0:t.map((l,n)=>e.jsxs("div",{className:"w-full  cursor-pointer hover:bg-primary-200 transition-colors p-4 border border-primary-100/20",onClick:()=>s(n),children:[e.jsx("h2",{className:"whitespace-nowrap text-ellipsis overflow-hidden py-1 text-xl font-bold",children:l.messages.length>1?l.messages[1].message.replace("<br/>",""):`Chat ${n.toString().padStart(2,"0")}`},l.messages.join()),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"italic text-xs",children:[l.messages.length," messagens"]}),e.jsx("span",{className:"italic text-xs",children:F(l.messages[l.messages.length-1].time).dateFormat_A})]})]},l.id))})}function bt({chats:t,index:a}){const{client:s}=f.useContext(T),[l,n]=f.useState();return f.useEffect(()=>{var o,m;if(t.length){const u=(o=s==null?void 0:s.plan_management.project.find(p=>t&&p.id===t[a].project_id))==null?void 0:o.logo,i=(m=s==null?void 0:s.plan_management.project.find(p=>t&&p.id===t[a].project_id))==null?void 0:m.project_name;u&&i&&n({logoChat:u,projectName:i})}},[]),l?e.jsx("div",{className:"w-2/3 h-[500px] overflow-auto flex flex-col",children:e.jsxs("div",{className:"w-full flex flex-col gap-4",children:[e.jsxs("div",{className:"w-full h-[60px] flex items-center px-4 bg-primary-100",children:[e.jsx("div",{className:"w-[50px] h-[50px] overflow-hidden rounded-full",children:e.jsx("img",{src:l.logoChat,alt:"logo do cliente",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"px-4 text-xl",children:l.projectName})]}),e.jsx("div",{className:"w-full p-4 flex flex-col gap-4 overflow-y-auto",children:t&&t[a].messages.map((o,m)=>e.jsx("div",{"data-player":o.player,className:"w-full flex data-[player='1']:justify-end justify-start",children:e.jsxs("div",{"data-player":o.player,className:"bg-light text-black/80 data-[player='1']:bg-primary-200 data-[player='1']:text-light p-2 rounded-xl max-w-md",children:[e.jsx("h2",{className:"",dangerouslySetInnerHTML:{__html:o.message}}),e.jsx("span",{className:"w-full flex justify-end text-xs italic",children:F(o.time).shortHour})]})},m))})]})}):e.jsx("h2",{className:"w-full h-[200px] flex justify-center items-center",children:"Ainda não existe nenhuma conversa para esse chat"})}function vt(){var g;const{client:t}=f.useContext(T),[a,s]=R(),[l,n]=f.useState(0),[o,m]=f.useState([]),u=(g=t==null?void 0:t.plan_management)==null?void 0:g.project.map(x=>Object({id:x.project_name.replace(" ","_"),name:x.project_name}));f.useEffect(()=>{const x=a.get("filter_time_chats"),c=a.get("project");if(t&&u!=null&&u.length){let d;c?d=t.plan_management.project.filter(b=>b.project_name.replace(" ","_")===c&&b):d=t.plan_management.project;const _=d.map(b=>b.chat.filter(A=>Number(x)?I(A.created_at)<=Number(x):!0)).flat();m(_)}},[a]);const i=({target:x})=>{const c=x.selectedIndex,d=x.options[c].value,_=new URLSearchParams(a);_.set("project",d),s(_)},p=async({currentTarget:x})=>{if(t!=null&&t.plan_management){const c=x.querySelector("svg");c.classList.add("rotate-[-360deg]","transition-transform","duration-1000");const d=setTimeout(()=>{c.classList.remove("rotate-[-360deg]","transition-transform","duration-1000"),clearTimeout(d)},1e3)}};return e.jsxs(L,{title:"Registros",className:"px-8",children:[e.jsxs("div",{className:"flex gap-8 h-[40px]",children:[e.jsx(k,{tip:"Selecione uma data como filtro",children:e.jsx(le,{typeFilter:"filter_time_chats"})}),e.jsx(k,{tip:"Selecione um chat",children:e.jsx(re,{options:u||[],Icon:Xe,handleSelectDatabase:i})}),e.jsx(k,{tip:"Atualize seus chats",children:e.jsx("div",{className:"p-2 bg-primary-100 rounded-md cursor-pointer",onClick:p,children:e.jsx(ae,{className:"text-xl"})})})]}),e.jsxs("div",{className:"w-full flex my-8 bg-gray",children:[e.jsx(Nt,{chats:o,setIndex:n}),e.jsx(bt,{chats:o,index:l})]})]})}function yt({plan_management:t}){return e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsx("h2",{className:"text-xl p-2",children:"Historico de transações"}),e.jsx("div",{className:"w-full max-w-[1000px]",children:t?e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("div",{className:"w-full flex p-4 justify-between border border-zinc-800",children:[e.jsx("span",{className:"w-1/3 text-center",children:"Plano"}),e.jsx("span",{className:"w-1/3 text-center",children:"Transação"}),e.jsx("span",{className:"w-1/3 text-center",children:"Data e hora"}),e.jsx("span",{className:"w-1/3 text-center",children:"Valor do plano"}),e.jsx("span",{className:"w-1/3 text-center",children:"Método de pagamento"}),e.jsx("span",{className:"w-1/3 text-center",children:"Status"})]}),t.trasaction.map((a,s)=>e.jsxs("div",{className:"w-full flex px-4 justify-between border border-zinc-500/20",children:[e.jsx("span",{className:"w-1/3 text-center",children:t.plan.plan_name}),e.jsx("span",{className:"w-1/3 text-center",children:a.transaction_describe==="PAYMENT"?"Pagamento":a.transaction_describe==="REFUND_REQUEST"?"Reembolso solicitado":a.transaction_describe==="SUBSCRIPTION_CANCELLATION"?"Plano cancelado":"Reembolso cancelado"}),e.jsx("span",{className:"w-1/3 text-center",children:F(a.created_at).dateFormat_A}),e.jsxs("span",{className:"w-1/3 text-center",children:["R$",Number(a.amount_paid).toFixed(2).replace(".",",")]}),e.jsx("span",{className:"w-1/3 text-center",children:a.payment_method}),e.jsx("span",{className:"w-1/3 text-center",children:a.status==="APPROVED"?"Aprovado":a.status==="REJECT"?"Recusado":"Pendente"})]},s))]}):e.jsx("h2",{className:"text-zinc-500",children:"Você ainda não efetuou nenhum pagamento"})})]})}function wt({plan_management:t}){return t&&t.status!=="DISABLED"?e.jsx("span",{className:"font-bold text-yellow-600 uppercase",children:t.plan.plan_name}):e.jsx("span",{className:"text-zinc-400/60",children:"Sem plano"})}function ie(t){const n=(new Date(t)-new Date)/(1e3*60*60*24);return Number(n.toFixed(0))}function Ct({plan_management:t}){const a=()=>t?ie(t.free_trial):0;return t&&t.status!=="DISABLED"&&e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("span",{children:["Projetos criados: ",t.project.length," / ",t.plan.max_projects]}),e.jsxs("span",{children:["Limite de messages: ",Ye(t).totalMessages," / ",t.plan.max_messages," "]}),e.jsxs("span",{children:["Reembolso garantido: ",a()>0?a()+" dias restantes":"expirado"]}),e.jsxs("span",{children:["Status do plano: ",t.status==="ACTIVE"?"Ativo":"Desativado"]})]})}function St({client:t}){const a=z(),s=()=>{a("/plans")};return(t!=null&&t.refund_requested.length&&t.refund_requested[0].status!=="PENDING",!0)&&e.jsx("div",{className:"w-full flex flex-col gap-4 my-4",children:e.jsx(D,{onClick:s,children:t!=null&&t.plan_management&&t.plan_management.status!=="DISABLED"?"Mudar de plano":"Adicionar plano"})})}async function At(t){return await se.post(`${ne}/refund_requested`,t).catch(s=>console.log(s))}async function Et(t){return await se.post(`${ne}/refund_requested/reactive`,{client_id:t}).catch(s=>console.log(s))}function kt({client:t}){const{setModalContent:a}=f.useContext(w),s=()=>t!=null&&t.plan_management?ie(t==null?void 0:t.plan_management.free_trial):0,l=async()=>{if(t){const u=prompt("Digite o motivo do seu cancelamento:"),i=prompt("Digite de 0 a 5, o quanto você gostou do nosso sistema"),p={client_id:t.id,reason:u||"",product_review:Number(i||0)};await At(p)?(a({componentName:"modal_request_success",components:e.jsx(N,{message:"Solicitação de reembolso foi enviada com sucesso!",componentName:"modal_request_success"})}),setTimeout(()=>window.location.reload(),1e3)):a({componentName:"modal_error_request",components:e.jsx(N,{message:"Ocorreu um erro ao enviar sua solicitação de reembolso, por favor entre em contato com nosso suporte.",componentName:"modal_error_request"})})}else a({componentName:"modal_error_client",components:e.jsx(N,{message:"Erro ao processar o cliente, por favor recarregue a página.",componentName:"modal_error_client"})})},n=()=>{if(t!=null&&t.plan_management)return t!=null&&t.refund_requested.length&&t.plan_management.status==="ACTIVE"&&s()>0?t.refund_requested[0].status!=="PENDING":s()>0&&t.plan_management.status!=="DISABLED"},o=()=>{t?window.open(`https://dash.ticto.com.br/subscription-verification?code=${t==null?void 0:t.ticto_order_code}&email=${t==null?void 0:t.purchase_email}`):a({componentName:"modal_failed_cancel",components:e.jsx(N,{message:"Falha ao preencher os dados de cancelamento, por favor entre em contato com o suporte.",componentName:"modal_failed_cancel"})})},m=()=>{if(t!=null&&t.plan_management&&t.plan_management.status==="ACTIVE"&&s()<=0)return t.refund_requested[0].status!=="PENDING"};return n()?e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("a",{onClick:l,className:"text-center underline cursor-pointer",children:"Pedir reembolso"})}):m()&&e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("a",{onClick:o,className:"text-center underline cursor-pointer",children:"Gerenciar assinatura"})})}function Tt({client:t}){return e.jsxs("div",{className:"w-1/2 min-w-[150px] max-w-[400px] border border-zinc-600 p-2 rounded-md",children:[e.jsx("h2",{className:"w-full text-center",children:"Plano atual:"}),e.jsx("div",{className:"w-full flex justify-center p-4",children:e.jsx(wt,{plan_management:t==null?void 0:t.plan_management})}),e.jsx("div",{className:"w-full flex justify-center p-4",children:e.jsx(Ct,{plan_management:t==null?void 0:t.plan_management})}),e.jsx(St,{client:t}),e.jsx(kt,{client:t})]})}function Dt({client:t}){const{setModalContent:a}=f.useContext(w),s=async()=>{t&&await Et(t.id)&&(a({componentName:"modal_reactive_plan",components:e.jsx(N,{message:"Plano reativado com  sucesso!",componentName:"modal_reactive_plan"})}),setTimeout(()=>window.location.reload(),1500))};return!!(t!=null&&t.refund_requested.length)&&t.refund_requested[0].status!=="CANCEL"&&e.jsxs("div",{className:"w-1/2 min-w-[150px] max-w-[400px] border border-zinc-600 p-2 rounded-md",children:[e.jsx("h2",{className:"w-full text-center pb-4 text-xl",children:"Reembolso solicitado:"}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Reembolso solicidado em:",e.jsx("p",{children:t.refund_requested[0].created_at.substring(0,10)})]}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Plano:",e.jsx("p",{children:t.plan_management.plan.plan_name})]}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Status:",t.refund_requested[0].status==="PENDING"?e.jsx("p",{className:"text-red-600",children:"Pendente"}):t.refund_requested[0].status==="APPROVED"?e.jsx("p",{className:"text-green-600",children:"Dinheiro devolvido"}):e.jsx("p",{className:"text-zinc-200",children:"Reembolso cancelado"})]}),e.jsx("div",{className:"w-full flex justify-center mt-6",children:t.refund_requested[0].status==="PENDING"&&e.jsx(D,{onClick:s,children:"Cancelar reembolso"})})]})}function It(){const{client:t}=f.useContext(T);return e.jsxs(L,{title:"Assinatura",className:"flex-col gap-8",children:[e.jsxs("div",{className:"w-full p-4 flex gap-6 justify-center",children:[e.jsx(Tt,{client:t}),e.jsx(Dt,{client:t})]}),e.jsx(yt,{plan_management:t==null?void 0:t.plan_management})]})}function Mt(){const[t]=R(),a=Number(t.get("tab"))||0;return e.jsx("div",{className:"w-full p-8 overflow-hidden",children:a===0?e.jsx(ct,{}):a===1?e.jsx(ft,{}):a===2?e.jsx(jt,{}):a===3?e.jsx(vt,{}):a===4?e.jsx(It,{}):e.jsx("h2",{children:"Configurações"})})}function Rt(){return e.jsxs("div",{className:"w-[90%] h-full flex-grow flex flex-col items-center bg-gradient-to-br from-primary-100 from-[10%] to-light to-[20%] dark:to-dark",children:[e.jsx(et,{}),e.jsx(Mt,{})]})}export{Rt as default};
