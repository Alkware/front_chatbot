import{j as e,B as v,b as R,A as O,r as x,C,M as w,F as pe,c as xe,d as fe,T as D,e as he,f as _e,u as H,g as ge,P as g,h as Y,t as je,i as se,k as Ne,l as ye,n as be,m as ve,o as U,p as we,q as Ce,s as Se,v as $,w as Z,R as c,x as oe,y as G,z as te,D as J,E as Ae,G as Ee,H as ke,J as Ie,K as Te,L as Me,N as De,O as Pe,Q as Re,S as Oe,U as Fe,V as Le,W as qe,X as ze,Y as $e,Z as Ue,$ as re,a0 as Ge,a1 as Be,a2 as Ve,a3 as He,a4 as Je,a5 as Qe,a6 as We,a7 as Ke,a8 as Xe,a9 as Ye,aa as Ze,ab as le,ac as ea,ad as aa,ae as sa,af as ta,ag as na,ah as oa,ai as ra,aj as la,ak as ia,al as ca,am as da,an as ma,ao as ua,ap as X,aq as ie,ar as pa,as as q,at as xa,au as fa,av as ha,aw as _a}from"./index-PQvQN0rr.js";import{P as T,C as ga,m as ja}from"./messagesEventManager-v0HlIVh3.js";const Na=[{short:"Jan",complete:"Janeiro"},{short:"Fev",complete:"Fevereiro"},{short:"Mar",complete:"Março"},{short:"Abr",complete:"Abril"},{short:"Mai",complete:"Maio"},{short:"Jun",complete:"Junho"},{short:"Jul",complete:"Julho"},{short:"Ago",complete:"Agosto"},{short:"Set",complete:"Setembro"},{short:"Out",complete:"Outubro"},{short:"Nov",complete:"Novembro"},{short:"Dez",complete:"Dezembro"}];function F(a){const s=new Date(a);s.toLocaleTimeString("pt-BR",{hour12:!1});const t=s.getTimezoneOffset(),n=s.getMonth(),l=s.getUTCHours()-t/60,r=s.toLocaleDateString(),i=`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}:${s.getSeconds().toString().padStart(2,"0")}`,u=`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`,o=`${s.getDay()} de ${Na[n].short} - ${u}`;return{currentHour:l,fullDate:r,fullHour:i,shortHour:u,dateFormat_A:o,fullDateWithHour:`${r} - ${i}`}}function ya({notification:a}){return e.jsxs("div",{className:"flex flex-col justify-center items-center gap-4 min-w-[500px]",children:[e.jsx("h2",{className:"w-full text-2xl text-center font-bold",children:a.notification.title}),e.jsx("p",{dangerouslySetInnerHTML:{__html:a.notification.describe}}),e.jsx("div",{className:"flex p-4",children:!!Object.keys(a.notification.call_to_action).length&&e.jsx(v,{onClick:()=>window.open(a.notification.call_to_action.link),children:a.notification.call_to_action.text})})]})}async function ba(a){return await R.post(`${O}/notification/${a}/read`).catch(t=>console.log(t))}function va(){const{client:a}=x.useContext(C),{setModalContent:s}=x.useContext(w),[t,n]=x.useState(),[l,r]=x.useState(),i=l==null?void 0:l.filter(o=>!o.read);x.useEffect(()=>{var d;const o=(d=a==null?void 0:a.notification_client)==null?void 0:d.sort((m,p)=>!m.read&&p.read?-1:m.read&&!p.read?1:0);r(o)},[]);const u=async o=>{const d=await ba(o.id);(d==null?void 0:d.status)===200&&(r(m=>{if(m){const p=m.filter(h=>h.id!==o.id),f=m.find(h=>h.id===o.id);if(f)return f.read=!0,p.push(f),p}}),s({componentName:"modal_display_notification",components:e.jsx(T,{children:e.jsx(ya,{notification:o})})}))};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-primary-100 rounded-full p-1",onClick:()=>n(o=>!o),children:[e.jsx("span",{"data-isnotification":!!(i!=null&&i.length),className:"w-[20px] h-[20px] data-[isnotification=false]:hidden flex justify-center items-center text-xs bg-red-800 border border-primary-300 rounded-full absolute -top-[10px] -right-[10px]",children:i==null?void 0:i.length}),e.jsx(pe,{className:"text-2xl fill-light cursor-pointer"})]}),e.jsxs("div",{"data-display":!!t,className:"data-[display=false]:hidden flex flex-col absolute z-50 rounded-md bg-primary-100 p-4 right-0 translate-x-[122px] my-2 min-w-[400px]",children:[e.jsxs("div",{className:"w-full flex justify-between items-center border-b border-white/30",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Notificações"}),e.jsx(v,{children:"Marcar todas como lida"})]}),e.jsx("div",{className:"w-full flex flex-col",children:l==null?void 0:l.map(o=>e.jsxs("div",{className:"flex gap-4 items-center min-h-[60px] border-b border-white/30 hover:bg-primary-200/50 transition-colors cursor-pointer",onClick:()=>u(o),children:[e.jsx("div",{className:"min-w-1/3",children:o.read?e.jsx(xe,{className:"text-2xl fill-zinc-300"}):e.jsx(fe,{className:"text-2xl fill-orange-400"})}),e.jsxs("div",{"data-isread":!!o.read,className:"flex flex-col data-[isread=true]:opacity-60",children:[e.jsx("h2",{className:"font-medium text-lg",children:o.notification.title}),e.jsxs("div",{className:"flex gap-2 items-end px-2",children:[e.jsx("p",{className:"w-2/3 line-clamp-1 opacity-90",children:o.notification.describe}),e.jsx("span",{className:"text-xs opacity-70",children:F(o.notification.created_at).dateFormat_A})]})]})]},o.id))})]})]})}function wa(){x.useEffect(()=>{const s=localStorage.theme==="dark";document.documentElement.classList.toggle("dark",s)},[]);const a=()=>{const s=localStorage.theme==="dark";document.documentElement.classList.toggle("dark",!s);const t=s?"light":"dark";localStorage.theme=t};return e.jsxs("div",{className:"flex gap-3 px-8",children:[e.jsx(D,{tip:"Notificações",position:"BOTTOM",children:e.jsx(va,{})}),e.jsx(D,{tip:"Escolha entre thema light ou dark",position:"BOTTOM",children:e.jsxs("div",{className:"bg-primary-100 rounded-full p-1",onClick:a,children:[e.jsx(he,{className:"text-2xl fill-light cursor-pointer hidden dark:block"}),e.jsx(_e,{className:"text-2xl fill-light cursor-pointer block dark:hidden"})]})})]})}function Ca(){return e.jsx("header",{className:"w-full h-[8%] px-20 min-h-[70px] col-span-8 row-span-1 flex justify-end items-center",children:e.jsx(wa,{})})}function Sa({plan_management_id:a}){const{client:s}=x.useContext(C),{setModalContent:t,clearModal:n}=x.useContext(w),l=H(),r=()=>{if(s!=null&&s.plan_management)if(s!=null&&s.plan_management.prompt.length){const i=Number(s.plan_management.plan.max_projects.default),u=s.plan_management.project.length;s.plan_management.status!=="DISABLED"?i>u?l(`/create-chat/${a}`):t({componentName:"modal_reached_max_plan",components:e.jsx(g,{message:"Você atingiu o número maximo de chats por plano.",componentName:"modal_reached_max_plan"})}):t({componentName:"modal_plan_is_desabled",components:e.jsx(g,{message:"O plano da sua conta está desabilitado.",componentName:"modal_plan_is_desabled",functionAfterComplete:()=>l("/panel?tab=4")})})}else t({componentName:"modal_create_database",components:e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("h2",{className:"text-xl text-center",children:["Para criar um novo chat, antes é necessário ",e.jsx("br",{}),"  criar uma fonte de dados."]}),e.jsxs("h2",{className:"text-lg text-center opacity-80",children:["Nossa inteligência artifical vai analisar seus dados e ",e.jsx("br",{})," responder as dúvidas do usuário ",e.jsx("br",{}),"conforme as informações passadas na fonte de dados."]}),e.jsxs(v,{customClass:"my-4",onClick:()=>{l("/panel?tab=2"),n("modal_create_database")},children:[e.jsx(Y,{}),"Criar fonte de dados"]})]})})});else t({componentName:"modal_without_plan",components:e.jsx(g,{message:"Nenhum plano foi vinculado a sua conta",componentName:"modal_without_plan",functionAfterComplete:()=>l("/panel?tab=4")})})};return e.jsx(D,{tip:"Crie um novo chat",children:e.jsx("div",{onClick:r,className:"border border-primary-100 rounded-full cursor-pointer",children:e.jsx(ge,{className:"text-4xl text-primary-100"})})})}function z({children:a,title:s,className:t}){return e.jsxs("div",{className:je("w-full h-full flex flex-col gap-4 justify-center items-start bg-light dark:bg-dark rounded-xl border border-primary-300 relative",t),children:[e.jsx("h2",{className:"w-full text-dark dark:text-light text-2xl font-semibold uppercase p-4 px-8",children:s}),a]})}function Aa({slug:a}){const{setModalContent:s}=x.useContext(w),t=x.useRef(null),n=x.useRef(null),l=()=>{window.open(`https://chat.wipzee.com/${a}`)},r=()=>{try{const o=t.current;if(o){o.classList.toggle("disabled"),o.disabled=!1,o.select();var u=document.execCommand("copy");u&&s({componentName:"modal_copy_link",components:e.jsx(g,{message:"Link Copiado!",type:"INFORMATION",componentName:"modal_copy_link"})}),o.classList.toggle("disabled"),o.disabled=!0}}catch{s({componentName:"modal_failed_copy_link",components:e.jsx(g,{message:"Falha ao copiar o link!",type:"ERROR",componentName:"modal_failed_copy_link"})})}},i=()=>{try{const o=n.current;if(o){o.classList.toggle("disabled"),o.disabled=!1,o.select();var u=document.execCommand("copy");u&&s({componentName:"modal_copy_widget",components:e.jsx(g,{message:"Widget Copiado!",type:"INFORMATION",componentName:"modal_copy_widget"})}),o.classList.toggle("disabled"),o.disabled=!0}}catch{s({componentName:"modal_failed_copy_widget",components:e.jsx(g,{message:"Falha ao copiar o link!",type:"ERROR",componentName:"modal_failed_copy_widget"})})}};return e.jsxs("div",{className:"w-full flex flex-col gap-8",children:[e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx("h2",{className:"w-4/5 text-center uppercase",children:"Link do seu chat"}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("input",{ref:t,className:"w-4/5 border border-light/20 p-2 rounded-xl disabled",disabled:!0,defaultValue:`https://chat.wipzee.com/${a}`}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx(se,{onClick:r,className:" text-2xl cursor-pointer"}),e.jsx(Ne,{onClick:l,className:" text-xl cursor-pointer"})]})]}),e.jsx("span",{className:"w-4/5 text-center opacity-60",children:"Esse será o link que você enviará aos usuários que irão acessar seu chat."})]}),e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx("h2",{className:"w-4/5 text-center uppercase",children:"Código do Widget"}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("input",{ref:n,className:"w-4/5 border border-light/20 p-2 rounded-xl disabled",disabled:!0,defaultValue:`<script src="https://widget.wipzee.com/${a}" defer><\/script>`}),e.jsx("div",{className:"w-1/5 flex justify-center items-center gap-4",children:e.jsx(se,{onClick:i,className:" text-2xl cursor-pointer"})})]}),e.jsx("span",{className:"w-4/5 text-center opacity-60",children:"Copie e cole esse código no head do html do seu site."})]})]})}const Ea=a=>a.errors!=null,ka=(a,s)=>{const t={};for(;a.length;){const n=a[0],{code:l,message:r,path:i}=n,u=i.join(".");if(!t[u])if("unionErrors"in n){const o=n.unionErrors[0].errors[0];t[u]={message:o.message,type:o.code}}else t[u]={message:r,type:l};if("unionErrors"in n&&n.unionErrors.forEach(o=>o.errors.forEach(d=>a.push(d))),s){const o=t[u].types,d=o&&o[n.code];t[u]=ve(u,s,t,l,d?[].concat(d,n.message):n.message)}a.shift()}return t},ce=(a,s,t={})=>async(n,l,r)=>{try{const i=await a[t.mode==="sync"?"parse":"parseAsync"](n,s);return r.shouldUseNativeValidation&&ye({},r),{errors:{},values:t.raw?n:i}}catch(i){if(Ea(i))return{values:{},errors:be(ka(i.errors,!r.shouldUseNativeValidation&&r.criteriaMode==="all"),r)};throw i}};function Ia(){const{watch:a}=U(),[s,t]=x.useState();return x.useEffect(()=>{const n=a("step_4.slug");t(n.replaceAll(" ","-"))},[a()]),e.jsxs("div",{className:"w-full flex gap-2 items-center bg-white p-2 my-4 rounded-md",children:[e.jsx(we,{className:"fill-zinc-600"}),e.jsx(Ce,{className:"fill-zinc-600"}),e.jsx(Se,{className:"fill-zinc-600"}),e.jsxs("div",{className:"w-full bg-zinc-600 rounded-xl p-3 flex gap-2 items-center",children:[e.jsx($,{className:"fill-green-600"}),e.jsxs("h2",{className:"opacity-80",children:["https://chat.wipzee.com/",s]})]})]})}function Ta(){const{control:a}=U(),{fields:s,remove:t,append:n}=Z({control:a,name:"step_0.social_proof"});return e.jsxs(c.Container,{className:"overflow-auto h-[400px]",children:[e.jsxs(c.Container,{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione avaliações dos seus clientes:"}),e.jsx("span",{className:"text-sm opacity-70",children:"(Essas avaliações estarão visível na bio do chat)"})]}),e.jsxs(v,{type:"button",onClick:()=>n({}),children:["Adicionar ",e.jsx(Y,{})]})]}),e.jsx(c.Container,{className:"px-4 overflow-auto h-[300px] my-2",children:s.map((l,r)=>e.jsxs(c.Container,{className:"w-full flex flex-col gap-4 my-2 p-2 rounded-lg border border-primary-100 relative",children:[e.jsx(oe,{className:"absolute -top-3 -right-3 bg-red-800/50 fill-red-500 cursor-pointer rounded-full p-1 text-2xl",onClick:()=>t(r)}),e.jsxs(c.Container,{className:"w-full flex justify-start items-center gap-4",children:[e.jsx(c.File,{name:`step_0.social_proof.${r}.avatar`,sizeContainer:"50px"}),e.jsx(c.Input,{title:"Nome do cliente",name:`step_0.social_proof.${r}.person_name`}),e.jsx(c.Input,{type:"number",title:"Nota da avaliação",name:`step_0.social_proof.${r}.rating`,min:0,max:5})]}),e.jsx(c.TextArea,{name:`step_0.social_proof.${r}.text`,title:"Oque o cliente achou do produto?"}),e.jsxs(c.Container,{className:"flex gap-4 justify-start",children:[e.jsx(c.File,{name:`step_0.social_proof.${r}.images.0`,sizeContainer:"50px"}),e.jsx(c.File,{name:`step_0.social_proof.${r}.images.1`,sizeContainer:"50px"}),e.jsx(c.File,{name:`step_0.social_proof.${r}.images.2`,sizeContainer:"50px"})]})]},l.id))})]})}function Ma({project:a,setProjects:s}){var j,b,S,A,I;const{setModalContent:t,clearModal:n}=x.useContext(w),{setClient:l,client:r}=x.useContext(C),[i,u]=x.useState(),[o,d]=G(),m=Number(o.get(te))||0,p=J({resolver:ce(Ae),defaultValues:{step_0:{project_name:a.project_name,logo:a.logo,bio:a.bio,social_proof:a.social_proof},step_1:{prompt_id:a.prompt.id,chat_input_message:a.chat_input_message,call_to_action:a.call_to_action},step_2:{facebook_pixel:a.pixel_facebook},step_3:{chat_appearance:{chat_icon:(j=a.chat_appearance)==null?void 0:j.chat_icon,icon_text:(b=a.chat_appearance)==null?void 0:b.icon_text,primary_color:(S=a.chat_appearance)==null?void 0:S.primary_color,second_color:(A=a.chat_appearance)==null?void 0:A.second_color,background:(I=a.chat_appearance)==null?void 0:I.background}},step_4:{slug:a.slug}}});x.useEffect(()=>{(async()=>{o.set(Ee,(a.call_to_action.length-1).toString()),d(o);const N=await ke(a.plan_management_id);(N==null?void 0:N.status)===200&&u(N.data.prompt)})()},[]);const f=async N=>{var M,L;let y={};if(Object.keys(N).forEach(E=>{const B=N[E];Object.keys(B).forEach(V=>{y[V]=N[E][V]})}),y&&a.slug){if((M=N.step_4)!=null&&M.slug&&((L=N.step_4)==null?void 0:L.slug)!==a.slug&&!await Me(N.step_4.slug)){t({componentName:"modal_error_slug",components:e.jsx(g,{componentName:"modal_error_slug",message:"A slug escolhida não está disponível!",type:"WARNING"})});return}y.chat_appearance.can_update=a.chat_appearance.can_update,y.chat_appearance.id=a.chat_appearance.id;const E=await De(y,a.slug);E&&E.status===200&&(s(B=>{const V=B.findIndex(Q=>Q.id===a.id),ae=B.filter(Q=>Q.id!==a.id);return y.is_online=E.data.is_online,y.plan_management_id=E.data.plan_management_id,y.id=E.data.id,y.prompt=E.data.prompt,y.chat_appearance=E.data.chat_appearance,ae.splice(V,0,y),ae}),t({componentName:"modal_chat_updated",components:e.jsx(g,{message:"Chat atualizado com sucesso",componentName:"modal_chat_updated",functionAfterComplete:()=>n("modal_edit_project")})}))}};async function h(){const N=async()=>{if(a.id){const y=await Pe(a.id);if(y&&y.status===200){s(L=>L.filter(E=>E.id!==a.id));const M=r==null?void 0:r.plan_management.project.findIndex(L=>L.id===a.id);r&&M&&(r.plan_management.project.splice(M,1),l(r)),t({componentName:"modal_delete_success",components:e.jsx(g,{message:"Chat excluido com sucesso!",componentName:"modal_delete_success",functionAfterComplete:()=>n(null,{clearAll:!0})})})}}};t({componentName:"modal_confirm_delete_chat",components:e.jsx(T,{children:e.jsx(ga,{title:"Tem certeza que deseja deletar esse chat?",subTitle:"Uma vez removido, não pode ser revertido.",confirmFunction:N,cancelFuntion:()=>n("modal_confirm_delete_chat")})})})}const _=N=>{o.set(te,N.toString()),d(o),p.unregister("step_3.chat_appearance.chat_icon"),p.register("step_3.chat_appearance.chat_icon",{value:N})};return!!(i!=null&&i.length)&&e.jsx("div",{className:"w-[90vw] h-[80vh] min-h-[450px] min-w-[700px] flex overflow-hidden",children:e.jsxs(c.EditForm,{form:p,onDelete:h,onSubmit:f,activeSimulator:!0,children:[e.jsxs(c.EditStep,{index:0,titleStep:"Informações do chat",children:[e.jsxs(c.Container,{className:"flex justify-start items-center gap-6",children:[e.jsx(c.File,{name:"step_0.logo",sizeContainer:"80px"}),e.jsx(c.Input,{name:"step_0.project_name",title:"Escreva o nome do seu chat"})]}),e.jsx(c.TextArea,{name:"step_0.bio",title:"Escreva uma descrição para seu chat"}),e.jsx(Ta,{})]}),e.jsxs(c.EditStep,{index:1,titleStep:"Configurações do chat",children:[e.jsx(c.Select,{name:"step_1.prompt_id",options:i.map(N=>Object({value:N.id,text:N.prompt_name})),title:"Selecione sua fonte de dados"}),e.jsx(c.TextArea,{name:"step_1.chat_input_message.0",title:"Digite a primeira mensagem do seu chat"}),e.jsx(Ie,{})]}),e.jsx(c.EditStep,{index:3,titleStep:"Aparência do chat",children:e.jsxs(c.Container,{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"flex flex-col justify-center gap-4",children:[e.jsx("h2",{className:"text-center text-xl",children:"Escolha um icone para seu chat"}),e.jsx("div",{className:"flex justify-center gap-8 text-5xl",children:Te.map(({Icon:N,id:y},M)=>e.jsx(N,{"data-iscurrent":m-1===M,className:"hover:bg-primary-100 data-[iscurrent=true]:bg-primary-100 cursor-pointer rounded-full p-2",onClick:()=>_(y)},y))})]}),e.jsx(c.Input,{name:"step_3.chat_appearance.icon_text",title:"Digite o texto que será exibido ao lado do icon"}),e.jsxs(c.Container,{className:"flex",children:[e.jsx(c.Color,{name:"step_3.chat_appearance.primary_color",title:"Escolha a cor primária do seu chat"}),e.jsx(c.Color,{name:"step_3.chat_appearance.second_color",title:"Escolha a cor secundária do seu chat"})]}),e.jsx(c.Color,{name:"step_3.chat_appearance.background",title:"Escolha a cor do background do seu chat"})]})}),e.jsx(c.EditStep,{index:4,titleStep:"Configuração avançadas",children:e.jsxs(c.Container,{className:"flex flex-col",children:[e.jsx(c.Input,{name:"step_4.slug",title:"Altere a slug do seu chat"}),e.jsx(Ia,{}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium uppercase",children:"Lembre-se"}),e.jsx("span",{className:"opacity-70",children:"Ao trocar a slug do seu chat, todos seus clientes que possuirem a URL antiga, podem perder acesso ao seu site utilizando a antiga URL."})]})]})})]})})}function Da({project:a,setNewProject:s,prompts:t}){const{setModalContent:n}=x.useContext(w),l=H(),r=()=>{n({componentName:"modal_edit_project",components:e.jsx(T,{children:e.jsx(Ma,{setProjects:s,project:a,prompts:t})})})},i=async(d,m)=>{if(!m)return n({componentName:"modal_failed_updated_status_chat",components:e.jsx(g,{message:"Falha ao atualizar o status do chat, reinicie a página e tente novamente",componentName:"modal_failed_updated_status_chat",type:"WARNING"})}),!1;const p=await Le(d,m);return(p==null?void 0:p.status)===200?(s(f=>(f.find(h=>h.id===p.data.id).is_online=p.data.is_online,f)),!0):(n({componentName:"modal_failed_updated_status_chat_02",components:e.jsx(g,{message:"Falha ao atualizar o status do chat, reinicie a página e tente novamente",componentName:"modal_failed_updated_status_chat_02",type:"WARNING"})}),!1)},u=()=>{if(!a.slug){n({componentName:"modal_failed_display_link",components:e.jsx(g,{message:"Falha ao exibir seus links",type:"ERROR",componentName:"modal_failed_display_link"})});return}n({componentName:"modal_display_share_project",components:e.jsx(T,{children:e.jsx(Aa,{slug:a.slug})})})},o=({target:d})=>{d.dataset.metric&&l("/panel?tab=1")};return a&&e.jsxs("div",{className:"w-1/4 min-w-[200px] bg-gray  relative flex flex-col items-center gap-2 cursor-pointer rounded-xl",onClick:o,"data-metric":!0,children:[e.jsxs("div",{className:"w-full flex justify-between items-center gap-2 p-2",children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(D,{tip:"Veja todos os seus links",children:e.jsx(Re,{className:" text-xl",onClick:u})}),e.jsx(D,{tip:"Edite seu chat",children:e.jsx(Oe,{className:"text-xl",onClick:r})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(D,{tip:"Ative ou desative seu chat",children:e.jsx(Fe,{isActive:a.is_online,template:"onOff",cb:d=>i(d,a.slug)})})})]}),e.jsx("div",{className:"w-[150px] h-[110px] rounded-xl overflow-hidden","data-metric":!0,children:e.jsx("img",{src:a.logo||"https://via.placeholder.com/100",alt:"imagem do projeto",className:"w-full h-full object-cover"})}),e.jsx("h2",{className:"text-center py-4 font-bold text-lg","data-metric":!0,children:a.project_name})]},a.slug)}const Pa=[{id:"create_chat",title:"Crie seu primeiro chat",text:'Clique em <div class="bg-white inline-block p-1 mx-2 rounded-sm"><div class="w-[30px] h-[30px] flex justify-center items-center overflow-hidden border-2 border-primary-100 rounded-full"><span class="text-primary-100 text-3xl">+</span></div></div> para criar seu primeiro chat simples e rápido',positionX:"60vw",positionY:"2vh"},{id:"add_plan",title:"Parece que você ainda não adicionou seu plano",text:`Basta clicar em <span class='font-bold uppercase'>"adicionar plano"</span> para adicionar um plano a sua conta wipzee`,positionX:"60vw",positionY:"2vh"},{id:"database",title:"Vamos criar sua primeira fonte de dados",text:'Clique em <div class="w-[60px] bg-primary-200 border-2 border-primary-100 inline-block p-1 mx-2 rounded-sm"><span class="text-light text-2xl">+</span></div> para iniciar o processo de criação da sua fonte de dados, essa etapa é muito importante para que nossa inteligência artificial entenda como funciona seu negócio e possa fornecer informações precisas ao seu cliente.',positionX:"20vw",positionY:"40vh"}];function ee({tutorialId:a}){const{client:s,setClient:t}=x.useContext(C),n=Pa.find(r=>r.id===a),l=async()=>{if(s){const r=await qe(s.id,!1);t(r)}};return s&&n&&e.jsx("div",{"data-istutorial":s.tutorial,className:"data-[istutorial='false']:hidden fixed bg-black/70 w-screen h-screen top-0 left-0 z-0",children:e.jsxs("div",{className:" bg-primary-100 absolute rounded-md flex flex-col justify-center items-center px-4",style:{top:n.positionY,left:n.positionX,zIndex:"999"},children:[e.jsx("h2",{className:"text-center py-2 font-bold text-xl",children:n.title}),e.jsx("p",{className:"w-[400px] px-4 text-center",dangerouslySetInnerHTML:{__html:n.text}}),e.jsx("div",{className:"w-full flex justify-center mt-8",children:e.jsx("span",{className:"underline opacity-70 cursor-pointer",onClick:l,children:"Pular tutorial"})})]})})}function Ra(){var n;const{client:a}=x.useContext(C),[s,t]=x.useState(a!=null&&a.plan_management?a.plan_management.project:[]);return a&&e.jsx(e.Fragment,{children:e.jsxs(z,{title:"Meus chats",children:[e.jsxs("div",{className:"w-4/5 px-8 pb-6 flex flex-col gap-8 z-50",children:[e.jsx("div",{className:"w-full flex justify-end items-center",children:e.jsx(Sa,{plan_management_id:(n=a==null?void 0:a.plan_management)==null?void 0:n.id})}),s.length?e.jsx("div",{className:"w-full flex flex-col gap-4",children:e.jsx("div",{className:"w-full flex items-center gap-4",children:s.map(l=>{var r;return e.jsx(Da,{project:l,setNewProject:t,prompts:(r=a.plan_management)==null?void 0:r.prompt},l.id)})})}):e.jsx("h2",{className:"py-8 font-bold",children:'Você ainda não possui nenhum chat, clique em "Novo chat" para começar seu primeiro projeto.'})]}),e.jsx(ee,{tutorialId:"create_chat"})]})})}function Oa({setColumns:a,columns:s,modalName:t}){const{clearModal:n}=x.useContext(w),[l,r]=x.useState(s),i=o=>{const d=o.currentTarget.dataset.status=="true",m=o.currentTarget.dataset.name;r(()=>[...s.filter((p,f)=>(f>1&&p.columnName===m&&(p.status=!d),p))])},u=()=>{localStorage.setItem("metricColumnActive",JSON.stringify(s)),a(s),n(t)};return e.jsxs("div",{className:"w-1/2 max-w-[400px] bg-zinc-800 text-light",children:[e.jsx("h2",{className:"w-full text-center text-xl p-4",children:"Organize suas columns"}),e.jsx("div",{className:"w-full flex gap-2 flex-col",children:l.map((o,d)=>e.jsxs("div",{className:"w-full flex justify-between px-4",children:[e.jsx("p",{children:o.columnName}),e.jsx("div",{className:"w-[30px] h-[20px] bg-zinc-100 flex overflow-hidden rounded-full cursor-pointer",style:{justifyContent:`${o.status?"end":"start"}`},onClick:i,"data-status":o.status,"data-name":o.columnName,children:e.jsx("div",{className:"w-2/3 h-full rounded-xl flex justify-center items-center",style:{background:`${o.status?"green":"red"}`},children:d<2&&e.jsx($,{className:"w-[8px]"})})})]},o.columnName))}),e.jsx("div",{className:"w-full flex mt-12 justify-center",children:e.jsx(v,{onClick:u,children:"Salvar"})})]})}function de({options:a,alternativeTitle:s,title:t,Icon:n,defaultValue:l,handleSelectDatabase:r}){return e.jsxs("div",{className:"w-full px-2 h-full bg-gray border border-primary-100 font-bold rounded-lg flex gap-2 justify-center items-center",children:[n&&e.jsx(n,{className:"text-2xl"}),e.jsxs("select",{className:"h-full bg-gray cursor-pointer outline-none ",disabled:!a.length,onChange:r,defaultValue:l||"#",children:[t&&s&&e.jsx("option",{disabled:!0,value:"#",className:"cursor-pointer",children:a.length?t:s}),a.map((i,u)=>e.jsx("option",{value:i.id,className:"cursor-pointer",children:i.name},u))]})]})}function me({typeFilter:a}){const[s,t]=G(),n=({target:l})=>{const r=F(new Date).currentHour,i=l,{value:u}=l.options[i.selectedIndex];var o=0;switch(u){case"today":o=r;break;case"yesterday":o=r+24;break;case"last_7_days":o=r+6*24;break;case"last_14_days":o=r+13*24;break;case"last_month":o=r+29*24;break;case"last_3_month":o=r+89*24;break;case"last_6_month":o=r+179*24;break;case"last_year":o=r+364*24;break;default:o=0;break}const d=new URLSearchParams(s);d.set(a,o.toString()),t(d)};return e.jsx(de,{handleSelectDatabase:n,Icon:ze,options:[{id:"0",name:"Todas as datas"},{id:"today",name:"Hoje"},{id:"yesterday",name:"Ontem"},{id:"last_7_days",name:"Ultimos 7 dias"},{id:"last_14_days",name:"Ultimos 14 dias"},{id:"last_month",name:"Ultimo mês"},{id:"last_3_month",name:"Ultimos 3 meses"},{id:"last_6_month",name:"Ultimos 6 meses"},{id:"last_year",name:"Ultimo ano"}]})}function P(a){const s=Number(new Date),t=Number(new Date(a)),l=(s-t)/(1e3*3600);return Math.floor(l)}function k(a,s=0){function t(){return a.metric.chat_event.reduce((f,h)=>{const _=h.open_chat.filter(j=>{const b=P(j.created_at);return s>0?b<=s:!0});return f+_.length},0)}function n(){return(a.metric.chat_event.filter(h=>{const _=P(h.created_at);return s>0?_<=s:!0})||[]).filter((h,_,j)=>_===j.findIndex(b=>b.guest_id===h.guest_id)).length}function l(){return a.plan_message_manager.filter(f=>{const h=P(f.created_at);return s>0?h<=s:!0},0).reduce((f,h)=>f+h.input,0)}function r(){return a.plan_message_manager.filter(f=>{const h=P(f.created_at);return s>0?h<=s:!0},0).reduce((f,h)=>f+h.output,0)}function i(){const p=l()+r(),f=n()>0?p/n():0;return f%1===0?f:Number(f.toFixed(1))}function u(){const p=a.metric.chat_event.reduce((b,S)=>{const A=S.chat_time.filter(I=>{const N=P(I.created_at);return s>0?N<=s:!0});return b+A.reduce((I,N)=>{if(!N.closed_at&&!N.created_at)return 0;const y=Number(new Date(N.closed_at))-Number(new Date(N.created_at));return I+y},0)},0),f=Math.floor(p/1e3),h=Math.floor(f/60);return`${Math.floor(h/60).toString().padStart(2,"0")}:${(h%60).toString().padStart(2,"0")}:${(f%60).toString().padStart(2,"0")}`}function o(){const p=a.metric.chat_event.reduce((S,A)=>{const I=A.chat_time.filter(N=>{const y=P(N.created_at);return s>0?y<=s:!0});return S+I.reduce((N,y)=>{if(!y.closed_at&&!y.created_at)return 0;const M=Number(new Date(y.closed_at))-Number(new Date(y.created_at));return N+M},0)},0),f=p>0?p/n():0,h=Math.floor(f/1e3),_=Math.floor(h/60),j=Math.floor(_/60),b=`${j.toString().padStart(2,"0")}:${(_%60).toString().padStart(2,"0")}:${(h%60).toString().padStart(2,"0")}`;return j!==1/0?b:"00:00:00"}function d(){return a.metric.button_event.filter(f=>{const h=P(f);return s>0?h<=s:!0},0).reduce((f,h)=>f+h.clicked_button.length,0)}function m(){return F(a.created_at).dateFormat_A}return{IS_ONLINE:a.is_online||!1,NAME:a.project_name,CAT:t(),CAU:n(),MESSAGE_INPUT:l(),MESSAGE_OUTPUT:r(),MESSAGES_TOTAL:l()+r(),MEDIA_MESSAGES_CHAT:i(),USAGE_TIME:u(),MEDIA_USAGE_TIME:o(),CREATED_AT:m(),LINK_CLICKS:d(),LEADS_COLLECTED:0,SERVICE_NOTE:0,RESOLUTION_RATE:0,TOKEN_INPUT:"0",TOKEN_OUTPUT:"0",TOKEN_TOTAL:"0",USED_REAL:"0"}}async function Fa(a){return await R.post(`${O}/analyze_metric`,{prompt:a}).catch(t=>console.log(t))}function La(a){const s=a.split("");let t="";return s.forEach(n=>{n.includes(`
`)&&t.length||n.includes(":")?t+=n+"<br />":t+=n}),t}async function qa(a,s){const t=await R.post(`${O}/metric_analysis/create`,{plan_management_id:a,result:s});if(t.data.error)throw new Error("Unable to create the Metric Analysis.");return t}async function za({feedback:a,metrics_analysis_rating:s,metric_analysis_id:t}){const n=await R.post(`${O}/metric_analysis/create_feedback`,{feedback:a,metrics_analysis_rating:s,metric_analysis_id:t});if(n.data.error)throw new Error("Unable to create the Feedback Metric Analysis.");return n}async function $a(a){const s=await R.get(`${O}/metric_analysis/${a}`);if(s.status===400)throw new Error("Unable to create the Feedback Metric Analysis.");return s}function Ua({index:a,spanReview:s,metric_analysis_id:t}){const n=x.useRef(null),{setModalContent:l,clearModal:r}=x.useContext(w),i=async()=>{var o;const u=(o=n.current)==null?void 0:o.value;u&&t?(await za({feedback:u,metrics_analysis_rating:a,metric_analysis_id:t})).data.response&&l({componentName:"modal_send_success",components:e.jsx(g,{componentName:"modal_send_success",message:"Feedback enviado com sucesso. Obrigado!",functionAfterComplete:()=>r(null,{clearLast:!0})})}):l({componentName:"modal_error_send_feedback",components:e.jsx(g,{componentName:"modal_error_send_feedback",message:"Você precisa deixar um feedback antes de enviar sua avaliação ou houve um erro no envio do feedback!",type:"ERROR"})})};return e.jsxs("div",{className:"w-[300px] flex flex-col items-center gap-2",children:[e.jsxs("h2",{className:"text-center font-bold text-lg",children:['Sua avaliação foi "',s,'".']}),e.jsx("p",{className:"text-center opacity-80",children:"Gostaria de deixar um feedback em algo poderia melhorar?"}),e.jsx("textarea",{ref:n}),e.jsx(v,{customClass:"my-4",onClick:i,children:"Enviar"})]})}var ne=`
 A wipzee é uma empresa que fornece um chatbot com inteligencia artificial, promovendo uma experiência completa ao usuário.
 Desda personalização do chat até o consumo de dados (Métricas), abaixo será informado as minhas métricas, quero que você faça uma analise
 completa e sugira melhorias ou me de feedbacks positivos sobre as métricas.

 exemplo 1: se tiver muitos chats abertos e nenhum clique no link, significa que o cliente não está sendo influenciado a clicar no link. Sugestão: "Mudar o texto do link e deixar mais atrativo ou melhorar sua fonte de dados."
 exemplo 2: se tiver muitos chats abertos e nenhuma ou poucas mensagens, significa que o cliente não está sentindo avontade de conversar com a IA ou não está conseguindo conversar com ela. SOLUÇÃO: Melhorar a primeira mensagem do chat ou ver se existe algum problema tecnico nas trocas de mengens."
`;function Ga(){const{clearModal:a,setModalContent:s}=x.useContext(w),{client:t}=x.useContext(C),[n,l]=x.useState(),r=x.useRef(null);x.useEffect(()=>{(async()=>{if(t){const d=(await $a(t.plan_management.id)).data.response,m=t.plan_management.plan.max_analyze_metric;d.length?l({status:"APRROVED",analysis:d}):d.length<m?i():s({componentName:"modal_limit_analysis",components:e.jsx(g,{componentName:"modal_limit_analysis",message:"O limite de analises no seu plano foi atingido. Aguarde até amanhã ou mude de plano para fazer uma nova análise."})})}})()},[]);const i=()=>{if(n&&t&&(n==null?void 0:n.analysis.length)>=Number(t.plan_management.plan.max_analyze_metric.default)){s({componentName:"modal_max_limit_analysis",components:e.jsx(g,{componentName:"modal_max_limit_analysis",message:"O limite de análises no seu plano foi atingido. Aguarde até amanhã ou mude de plano para fazer uma nova análise.",type:"WARNING"})});return}if(l(null),!t)throw new Error("Client is missing!");const o=t.plan_management.project,d=F(new Date).currentHour;o&&o.forEach(m=>{ne+=`
                    NOME DO CHAT: ${m.project_name}
                    
                    MÉTRICAS:

                    Chats abertos total:
                    (Essa métrica pode tanto ser tanto varios usuários abrindo um chat ou como pode ser o mesmo usuário abrindo ele varias vezes)
                    [1000]

                    Chats abertos:
                    (Essa métrica conta quantas vezes o usuário abriu o chat, caso o usuário abra o mesmo chat 2 vezes ou mais, será contabilizado apenas uma vez)
                    [1]

                    Quando o chat foi criado:  
                    (Essa métrica registra quando o chat foi criado)
                    [${k(m,d).CREATED_AT}]

                    chat está ativado ou desativado:  
                    (Informa se o chat está ativado ou não: true = ativado e false = desativado)
                    [${k(m,d).IS_ONLINE}]

                    Leads coletados:  
                    (Informa quantos usuários deixaram um contato salvo no sistema)
                    [${k(m,d).LEADS_COLLECTED}]

                    Cliques no link:  
                    (Informa quantos cliques no link(call to action) foi dado no chat)
                    [100]

                    Média de mensagens:  
                    (Informa qual a média de mensagens por chat)
                    [${k(m,d).MEDIA_MESSAGES_CHAT}]

                    Média de tempo de uso:  
                    (Informa qual a média que o usuário ficou interagindo no chat)
                    [${k(m,d).MEDIA_USAGE_TIME}]

                    Total de Mensagens:  
                    (Informa qual o total de mensagens que esse chat tem)
                    [${k(m,d).MESSAGES_TOTAL}]

                    Entrada de Mensagens:  
                    (Informa quantas mensagens os usuários já mandaram para esse chat)
                    [${k(m,d).MESSAGE_INPUT}]

                    Entrada de Mensagens:  
                    (Informa quantas mensagens os usuários já mandaram para esse chat)
                    [${k(m,d).MESSAGE_OUTPUT}]

                    Saída de Mensagens:  
                    (Informa quantas mensagens nossa inteligencia artificial já mandou para esse chat)
                    [${k(m,d).MESSAGE_OUTPUT}]

                    tempo de uso:  
                    (Informa quanto tempo esse chat já ficou aberto)
                    [${k(m,d).USAGE_TIME}]`}),(async()=>{const m=await Fa(ne);if((m==null?void 0:m.status)===200&&m.data){const{text:p}=m.data.choices[0],f=await qa(t==null?void 0:t.plan_management.id,p);l({status:"APRROVED",analysis:f.data.response})}else s({componentName:"modal_error_analyze_metric",components:e.jsx(g,{componentName:"modal_error_analyze_metric",message:"Não foi possível analisar suas métricas, por favor tente mais tarde.",type:"ERROR"})})})()},u=o=>{var d,m;if(n!=null&&n.analysis[0].feedback)s({componentName:"modal_error_analysis_metric",components:e.jsx(g,{componentName:"modal_error_analysis_metric",message:"Essa análise já foi avaliada!",type:"WARNING"})});else{const p=o.currentTarget.tabIndex,f=((d=o.currentTarget.querySelector("span"))==null?void 0:d.textContent)||"Regular",h=(m=r.current)==null?void 0:m.querySelectorAll("div > svg");h==null||h.forEach(_=>_.classList.remove("fill-primary-100")),h==null||h.forEach((_,j)=>j+1<=p&&_.classList.add("fill-primary-100")),s({componentName:"modal_show_feedback_analyze",components:e.jsx(T,{children:e.jsx(Ua,{index:p,spanReview:f,metric_analysis_id:n==null?void 0:n.analysis[0].id})})})}};return n?e.jsxs("div",{className:"max-w-[500px] flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Relatório da análise"}),e.jsxs("span",{className:"opacity-70",children:[n.analysis.length,"/",Number(t==null?void 0:t.plan_management.plan.max_analyze_metric.default)," Análises restantes de hoje"]})]}),e.jsx("div",{className:"max-h-[300px] overflow-auto border border-primary-100 p-2",children:e.jsx("p",{dangerouslySetInnerHTML:{__html:La(n.analysis[0].result)},className:"text-center"})}),e.jsxs("div",{className:"flex flex-col w-full items-center my-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Avalie essa análise:"}),e.jsx("div",{className:"flex gap-2",ref:r,children:Array.from({length:5}).map((o,d)=>e.jsxs("div",{tabIndex:d+1,onClick:u,className:"group flex flex-col justify-center items-center",children:[e.jsx(Ue,{"data-isselected":d+1<=n.analysis[0].metrics_analysis_rating,className:"cursor-pointer text-3xl hover:fill-primary-100 data-[isselected=true]:fill-primary-100"}),e.jsx("span",{className:"group-hover:opacity-100 opacity-0",children:d===0?"horrível":d===1?"ruim":d===2?"regular":d===3?"boa":"excelente"})]},d))})]}),e.jsxs("div",{className:"flex gap-8 justify-center items-center",children:[e.jsx("span",{onClick:()=>a(null,{clearLast:!0}),className:"underline opacity-80 my-4 cursor-pointer",children:"Fechar análise"}),e.jsx(v,{onClick:i,children:"Nova análise"})]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx($e,{}),e.jsx("h2",{children:"Analisando métricas"})]})}function Ba({client:a,handleRequestDataProject:s,setColumns:t,columns:n}){const{setModalContent:l}=x.useContext(w),r=async({currentTarget:o})=>{if(a!=null&&a.plan_management){const d=o.querySelector("svg");d.classList.add("rotate-[-360deg]","transition-transform","duration-1000"),s(a==null?void 0:a.id);const m=setTimeout(()=>{d.classList.remove("rotate-[-360deg]","transition-transform","duration-1000"),clearTimeout(m)},1e3)}},i=()=>{l({componentName:"modal_organization_column",components:e.jsx(Oa,{modalName:"modal_organization_column",setColumns:t,columns:n})})},u=()=>{l({componentName:"modal_show_analyze_metric",components:e.jsx(T,{children:e.jsx(Ga,{})})})};return e.jsxs("div",{className:"w-[70vw] flex gap-8 justify-end items-center",children:[e.jsx("div",{className:"p-2 bg-dark border border-primary-100 rounded-md cursor-pointer",onClick:r,children:e.jsx(re,{className:"text-xl"})}),e.jsx("div",{className:"h-[40px]",children:e.jsx(me,{typeFilter:"filter_time_metric"})}),e.jsxs(v,{onClick:i,customClass:"bg-dark border border-primary-100 px-4",children:[" ",e.jsx(Ge,{className:"text-xl"})," Organize as colunas"]}),e.jsxs(v,{customClass:"bg-primary-100 border border-primary-100 px-4",onClick:u,children:[" ",e.jsx(Be,{className:"text-xl"})," Analisar métricas com IA"]})]})}const W=[{key:"IS_ONLINE",columnName:"status",status:!0,dataType:"boolean"},{key:"NAME",columnName:"Nome do chat",status:!0,dataType:"string"},{key:"CAT",columnName:"Chats abertos (total)",status:!0,dataType:"number"},{key:"CAU",columnName:"Chats abertos (unico)",status:!1,dataType:"number"},{key:"MESSAGE_INPUT",columnName:"Mensagens de entrada",status:!1,dataType:"number"},{key:"MESSAGE_OUTPUT",columnName:"Mensagens de saída",status:!1,dataType:"number"},{key:"MESSAGES_TOTAL",columnName:"Mensagens total",status:!0,dataType:"number"},{key:"MEDIA_MESSAGES_CHAT",columnName:"Mensagens por chat",status:!1,dataType:"number"},{key:"USAGE_TIME",columnName:"Tempo de uso",status:!1,dataType:"string"},{key:"MEDIA_USAGE_TIME",columnName:"Tempo de uso por chat",status:!0,dataType:"string"},{key:"LINK_CLICKS",columnName:"Cliques no link",status:!0,dataType:"number"},{key:"LEADS_COLLECTED",columnName:"Leads coletados",status:!0,dataType:"number"},{key:"SERVICE_NOTE",columnName:"Nota de atendimento",status:!0,dataType:"number"},{key:"RESOLUTION_RATE",columnName:"Taxa de resolução",status:!0,dataType:"number"},{key:"CREATED_AT",columnName:"Criado em",status:!0,dataType:"string"}];function Va({setColumns:a,columns:s}){return x.useEffect(()=>{const t=JSON.parse(localStorage.getItem("metricColumnActive")||"[]");t.length>0?t.length!==W.length?localStorage.setItem("metricColumnActive",JSON.stringify(W)):a(t):localStorage.setItem("metricColumnActive",JSON.stringify(W))},[]),s&&e.jsx("div",{className:"w-1/2 flex",children:s.map(t=>t.status&&e.jsx("span",{className:"w-48 flex-none p-3 text-center bg-primary-300 border-r border-r-primary-100",children:t.columnName},t.columnName))})}function Ha({columns:a,setColumns:s,planManagement:t}){const[n]=G(),l=n.get("filter_time_metric");return e.jsxs("div",{className:"w-[70vw] h-[40vh] self-center rounded-xl overflow-x-auto",children:[e.jsx(Va,{setColumns:s,columns:a}),e.jsx("div",{className:"flex flex-col",children:t!=null&&t.project?t.project.map(r=>e.jsx("div",{className:"flex-none flex",children:a.map((i,u)=>i.status&&e.jsx("span",{className:"w-48 flex-none text-ellipsis overflow-hidden whitespace-nowrap text-center border border-primary-100/30 p-2",children:u===0?e.jsxs("div",{className:"w-full flex justify-center items-center gap-2",children:[e.jsx("div",{className:`w-[8px] h-[8px] ${r.is_online?"bg-green-700":"bg-red-700"} rounded-full`}),e.jsx("span",{children:r.is_online?"Ativo":"Desativado"})]}):u===1?r.project_name:k(r,l)[i.key]},i.columnName))},r.id)):e.jsx("h2",{className:"text-center p-4",children:'Você ainda não criou nenhum chat, clique em "Meus chats" , depois criar "Novo chat".'})}),e.jsx("div",{className:"flex-none flex ",children:a.map((r,i)=>r.status&&e.jsx("div",{className:"w-48 flex-none p-2 flex justify-center items-center gap-2",children:i===1?e.jsx("span",{className:"w-full font-bold text-primary-100 text-xl text-center",children:"TOTAL"}):r.dataType==="number"?e.jsx("span",{className:"w-full font-bold text-primary-100 text-xl text-center",children:t==null?void 0:t.project.reduce((u,o)=>u+Number(k(o,l)[r.key]),0)}):e.jsx("span",{className:"w-full text-primary-100 text-xl text-center",children:"-"})},r.key))})]})}function Ja(){const a=JSON.parse(localStorage.getItem("metricColumnActive")||"[]"),{setModalContent:s}=x.useContext(w),{client:t}=x.useContext(C),[n,l]=x.useState(a),[r,i]=x.useState(t==null?void 0:t.plan_management);x.useEffect(()=>{t!=null&&t.plan_management&&u(t==null?void 0:t.id)},[]);const u=async o=>{const d=await Ve(o);(d==null?void 0:d.status)===200?i(d.data.plan_management):s({componentName:"modal_failed_load_metric",components:e.jsx(g,{message:"Falha ao recarregar as métricas, tente reiniciar a página.",type:"ERROR",componentName:"modal_failed_load_metric"})})};return e.jsx("div",{className:"w-full h-full overflow-y-auto flex flex-col gap-8",children:e.jsxs(z,{title:"Métricas",className:"flex-col items-center gap-8",children:[e.jsx(Ba,{client:t,columns:n,handleRequestDataProject:u,setColumns:l}),e.jsx(Ha,{columns:n,planManagement:r,setColumns:l})]})})}function Qa({plan_management_id:a}){const{client:s}=x.useContext(C),{setModalContent:t}=x.useContext(w),n=H(),l=()=>{if(s!=null&&s.plan_management){const r=Number(s.plan_management.plan.max_databases.default),i=s.plan_management.prompt.length;s.plan_management.status!=="DISABLED"?r>i?n(`/create-database/${a}`):t({componentName:"modal_max_database",components:e.jsx(g,{message:"Você atingiu o número maximo de base de dados no seu plano.",componentName:"modal_max_database"})}):t({componentName:"modal_desactive_account",components:e.jsx(g,{message:"O plano da sua conta está desabilitado.",componentName:"modal_desactive_account"})})}else t({componentName:"modal_without_plan",components:e.jsx(g,{message:"Nenhum plano foi vinculado a sua conta",componentName:"modal_without_plan"})})};return e.jsx(He,{className:"w-[300px] text-5xl py-3 ",onClick:l})}function Wa(){const{control:a}=U(),{append:s,remove:t,fields:n}=Z({control:a,name:"step_6.questions"});return e.jsxs("div",{className:"w-full flex flex-col gap-6 justify-center items-center",children:[e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione as perguntas e as respostas frequentes"}),e.jsxs(v,{type:"button",onClick:()=>s({ask:"",answer:""}),children:["Adicionar",e.jsx(Y,{className:"text-lg"})]})]}),e.jsx("div",{className:"w-full flex flex-col gap-4",children:n.map((l,r)=>e.jsxs("div",{className:"w-full flex gap-4 justify-center items-center",children:[e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(c.Input,{name:`step_6.questions.${r}.ask`,title:"Digite uma pergunta"}),e.jsx(c.Input,{name:`step_6.questions.${r}.answer`,title:"Digite a resposta"})]}),e.jsx("div",{children:e.jsx(oe,{className:"fill-red-700 bg-red-900/50 rounded-full p-1 text-2xl cursor-pointer",onClick:()=>t(r)})})]},l.id))})]})}function Ka({prompt:a,setPrompts:s}){const{setModalContent:t,clearModal:n}=x.useContext(w),{client:l,setClient:r}=x.useContext(C),i=JSON.parse(a.prompt_query||"{}"),u=!!Object.keys(i).length,o=J({resolver:ce(sa),defaultValues:u?{step_0:{who_created:i.step_0.who_created||"",andvisa_record:i.step_0.andvisa_record||"",how_works:i.step_0.how_works||"",what_is:i.step_0.what_is||""},step_1:{benefits:i.step_1.benefits||"",contraindications:i.step_1.contraindications||"",ingredients:i.step_1.ingredients||"",side_effects:i.step_1.side_effects||""},step_2:{average_delivery_time:{end:i.step_2.average_delivery_time.end||0,start:i.step_2.average_delivery_time.start||0},order_tracking:i.step_2.order_tracking||"",tracking_link:i.step_2.tracking_link||""},step_3:{days_of_warranty:i.step_3.days_of_warranty||0,disclaimer:i.step_3.disclaimer||"",how_exchanges_work_and_returns:i.step_3.how_exchanges_work_and_returns||"",how_guarantee_work:i.step_3.how_guarantee_work||""},step_4:{how_to_buy:i.step_4.how_to_buy||"",payment_methods:i.step_4.payment_methods||"",products:i.step_4.products||""},step_5:{address:i.step_5.address||"",CNPJ:i.step_5.CNPJ||"",company_name:i.step_5.company_name||"",contact_email:i.step_5.contact_email||"",contact_phone_number:i.step_5.contact_phone_number||"",support_hours:i.step_5.support_hours||""},step_6:{questions:i.step_6.questions||""},step_7:{client_describe:i.step_7.client_describe||"",ia_name:i.step_7.ia_name||"",restrictions:i.step_7.restrictions}}:void 0}),{fields:d,append:m,remove:p}=Z({control:o.control,name:"step_4.products"}),f=async _=>{const j=JSON.stringify(_),S={prompt:ta(_),prompt_query:j,client_describe:_.step_7.client_describe};if(S){const A=await na(S,a.id);A&&A.status===200&&(s(I=>[...I.filter(N=>N.id!==A.data.id),A.data]),t({componentName:"modal_updated_database",components:e.jsx(g,{message:"Database atualizado com sucesso",componentName:"modal_updated_database",functionAfterComplete:()=>n(null,{clearAll:!0})})}))}};async function h(){if(a.id){const _=await oa(a.id);if((_==null?void 0:_.status)===200){s(b=>b.filter(S=>S.id!==_.data.id));const j=l==null?void 0:l.plan_management.prompt.findIndex(b=>b.id===a.id);l&&j&&(l.plan_management.prompt.splice(j,1),r(l)),t({componentName:"modal_delete_success",components:e.jsx(g,{message:"Fonte de dados excluido com sucesso!",componentName:"modal_delete_success",functionAfterComplete:()=>n(null,{clearAll:!0})})})}else(_==null?void 0:_.status)===500&&t({componentName:"modal_failed_delete_database",components:e.jsx(g,{message:"Você não pode excluir uma fonte de dados que possui um chat vinculado a ela, tente excluir todos os chats primeiro, antes de excluir essa fonte de dados.",type:"ERROR",componentName:"modal_failed_delete_database"})})}}return e.jsx("div",{className:"w-[80vw] h-[70vh] flex overflow-auto ",children:e.jsxs(c.EditForm,{form:o,onDelete:h,onSubmit:f,children:[e.jsxs(c.EditStep,{index:0,titleStep:"Informações básicas",icon:e.jsx(Je,{}),children:[e.jsx(c.Input,{title:"Quem foi o criador desse produto?",name:"step_0.who_created"}),e.jsx(c.TextArea,{title:"Conte um pouco sobre seu produto...",name:"step_0.what_is"}),e.jsx(c.TextArea,{title:"Como ele funciona?",name:"step_0.how_works"}),e.jsx(c.Optional,{text:"O produto possui registro na ANVISA?",children:e.jsx(c.Input,{title:"Digite o registro da ANVISA:",name:"step_0.andvisa_record"})})]}),e.jsxs(c.EditStep,{index:1,titleStep:"Informações avançadas",icon:e.jsx(Qe,{}),children:[e.jsx(c.TextArea,{name:"step_1.benefits",title:"Quais são os beneficios do seu produto?"}),e.jsx(c.TextArea,{name:"step_1.ingredients",title:"Quais são os ingredientes do seu produto?"}),e.jsx(c.Optional,{active:!0,text:"Esse produto possui alguma contra indicação?",name:"step_1.contraindications",children:e.jsx(c.TextArea,{name:"step_1.contraindications",title:"Quais são as contra-indicações do seu produto?"})}),e.jsx(c.Optional,{active:!0,text:"Existe algum efeito colateral?",name:"step_1.side_effects",children:e.jsx(c.TextArea,{name:"step_1.side_effects",title:"Quais?"})})]}),e.jsxs(c.EditStep,{index:2,titleStep:"Entrega do produto",icon:e.jsx(We,{}),children:[e.jsxs(c.Container,{className:"flex gap-4",title:"Qual o prazo médio em dias para entrega:",children:[e.jsx(c.Input,{type:"number",min:1,max:365,name:"step_2.average_delivery_time.start",title:"de:",joinAtInput:"dia(s)"}),e.jsx(c.Input,{type:"number",min:1,max:365,name:"step_2.average_delivery_time.end",title:"até:",joinAtInput:"dia(s)"})]}),e.jsx(c.TextArea,{name:"step_2.order_tracking",title:"Como os clientes podem rastrear seu pedido?"}),e.jsx(c.Optional,{active:!1,text:"Você possui link para rastrear pedido?",children:e.jsx(c.Input,{title:"Digite a url do site:",name:"step_2.tracking_link",onChange:({target:_})=>{_.value.toLowerCase().includes("http")||(_.value=`https://${_.value.replace("http","")}`)}})})]}),e.jsxs(c.EditStep,{index:3,titleStep:"Politicas e condições",icon:e.jsx(Ke,{}),children:[e.jsx(c.Input,{type:"number",name:"step_3.days_of_warranty",title:"Quantos dias o cliente tem de garantia?"}),e.jsx(c.TextArea,{name:"step_3.how_guarantee_work",title:"Como funciona a garantia?"}),e.jsx(c.TextArea,{name:"step_3.how_exchanges_work_and_returns",title:"Como funciona as trocas e devoluções?"}),e.jsx(c.Optional,{active:!1,text:"Gostaria de deixar um disclaimer para seus clientes?",children:e.jsx(c.TextArea,{name:"step_3.disclaimer",title:"Aviso legal ( Disclaimer )"})})]}),e.jsxs(c.EditStep,{index:4,titleStep:"Métodos de pagamentos",icon:e.jsx(Xe,{}),children:[e.jsx(c.Container,{className:"flex gap-4",title:"Quais são os métodos de pagamentos aceitos?",children:e.jsx(c.Select,{title:"Escolha seus métodos de pagamentos",isMultiple:!0,name:"step_4.payment_methods",options:[{value:"Pix",text:"Pix"},{value:"Boleto",text:"Boleto"},{value:"Cartão de débito",text:"Cartão de débito"},{value:"Cartão de crédito",text:"Cartão de crédito"},{value:"Pagamentos em aplicativo",text:"Pagamentos em aplicativo"}]})}),e.jsx(c.TextArea,{name:"step_4.how_to_buy",title:"como comprar seu produto?"}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("div",{className:"w-full flex justify-end",children:e.jsx(v,{type:"button",onClick:()=>m({name:"",value:"R$ 0"}),children:" Adicionar produto"})}),e.jsx(c.Container,{className:"flex flex-col gap-4",children:d.map((_,j)=>e.jsxs("div",{className:"flex justify-center items-center gap-8",children:[e.jsxs("div",{className:"w-4/5 flex gap-6 justify-center items-center",children:[e.jsx(c.Input,{name:`step_4.products.${j}.name`,title:"De um nome a esse produto:"}),e.jsx(c.Input,{name:`step_4.products.${j}.value`,onChange:({target:b})=>{const A=(parseFloat(b.value.replace(/[^\d]/g,""))/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});b.value=A},title:"Qual o valor do produto?"})]}),e.jsx(Ye,{onClick:()=>p(j),className:"fill-red-500 text-2xl cursor-pointer"})]},_.id))})]})]}),e.jsxs(c.EditStep,{index:5,titleStep:"Sobre a empresa",icon:e.jsx(Ze,{}),children:[e.jsxs(c.Container,{className:"flex gap-4",children:[e.jsx(c.Input,{name:"step_5.company_name",title:"Qual o nome da empresa?"}),e.jsx(c.Input,{title:"Qual o seu CNPJ?",name:"step_5.CNPJ",mask:le})]}),e.jsx(c.Input,{name:"step_5.address",title:"Qual o endereço da sua empresa?"}),e.jsxs(c.Container,{className:"flex gap-4",children:[e.jsx(c.Input,{name:"step_5.contact_email",title:"Digite um e-mail para contato"}),e.jsx(c.Input,{title:"Digite um telefone para contato",name:"step_5.contact_phone_number",onChange:({target:_})=>{const j=_.value.replace(/[^\d]/g,"");if(j.length<11){let b;j.length===11?b=j.replace(/^(\d{2})(\d{1})(\d{4})(\d{4})$/,"($1) $2 $3-$4"):b=j.replace(/^(\d{2})(\d{4})(\d{4})$/,"($1) $2-$3"),_.value=b}else _.value=_.value.substring(0,15)}})]}),e.jsx(c.Input,{name:"step_5.support_hours",title:"Qual seu horário para suporte humano?"})]}),e.jsx(c.EditStep,{index:6,titleStep:"Perguntas frequentes",icon:e.jsx(ea,{}),children:e.jsx(Wa,{})}),e.jsxs(c.EditStep,{index:7,titleStep:"Personalidade da IA ",icon:e.jsx(aa,{}),children:[e.jsx(c.Optional,{text:"Deseja dar um nome a sua inteligência artificial?",active:!1,children:e.jsx(c.Input,{name:"step_7.ia_name",title:"Qual o nome da sua inteligência artificial?"})}),e.jsx(c.Optional,{text:"Deseja adicionar restrições de palavras ou frase?",active:!1,name:"step_7.restrictions",children:e.jsx(c.Input,{name:"step_7.restrictions",title:"Faça uma lista de restrições para que a IA evite utiliza-la em uma conversa"})}),e.jsx(c.TextArea,{title:"Faça uma breve descrição de quem é seu público (cliente)",name:"step_7.client_describe"})]})]})})}function Xa(){var o;const{client:a}=x.useContext(C),{setModalContent:s,clearModal:t}=x.useContext(w),n=Array(ra).fill(0),[l,r]=x.useState(((o=a==null?void 0:a.plan_management)==null?void 0:o.prompt)||[]),i=d=>{l!=null&&l.length&&s({componentName:"modal_create_database",components:e.jsx(T,{children:e.jsx(Ka,{prompt:l[d],setPrompts:r})})})},u=d=>{async function m(p){p.preventDefault();const f=p.target.querySelector("input").value,h=l[d].id;if(f){const _=await ca(f,h);(_==null?void 0:_.status)===200&&(r([...l,l[d].prompt_name=f]),s({componentName:"modal_saved",components:e.jsx(g,{message:"Nome da sua base de dados foi atualizado com sucesso!",componentName:"modal_saved",functionAfterComplete:()=>t(null,{clearAll:!0})})}))}}s({componentName:"modal_edit_name",components:e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col justify-center items-center gap-4",children:[e.jsx("h2",{children:"Digite o novo nome da sua fonte de dados:"}),e.jsxs("form",{onSubmit:m,className:"flex flex-col justify-center items-center gap-4",children:[e.jsx("input",{placeholder:"Ex: Minha nova base de dados",name:"database_name",defaultValue:l[d].prompt_name}),e.jsx(v,{children:"Salvar"})]})]})})})};return a&&e.jsx(z,{title:"Fonte de dados",children:e.jsxs("div",{className:"w-full flex-wrap flex justify-center p-4 my-12 gap-8",children:[n.map((d,m)=>{var p,f,h,_,j;return(p=a.plan_management)!=null&&p.plan&&m<Number(a.plan_management.plan.max_databases.default)?e.jsx("div",{"data-prompt":!!((f=l[m])!=null&&f.prompt_name),className:"flex justify-center items-center rounded-xl cursor-pointer border border-primary-100 bg-primary-300 hover:bg-primary-200 text-xl data-[prompt=false]:text-2xl data-[prompt=false]:bg-primary-200/20 z-50",children:(h=l[m])!=null&&h.prompt_name?e.jsxs("div",{className:"w-[300px] flex gap-2 items-center justify-center",children:[e.jsxs("h2",{className:"w-[200px] text-center py-4 flex justify-center items-center gap-2",onClick:()=>i(m),children:[e.jsx(la,{}),e.jsx("span",{className:"w-full whitespace-nowrap text-ellipsis overflow-x-hidden",children:(_=l[m])==null?void 0:_.prompt_name})]}),e.jsx(ia,{className:"cursor-text ",onClick:()=>u(m)})]}):e.jsx(Qa,{plan_management_id:a.plan_management.id})},m):e.jsx("div",{"data-prompt":!!((j=l[m])!=null&&j.prompt_name),className:"flex opacity-30 cursor-not-allowed justify-center items-center rounded-xl border border-primary-100 bg-primary-300 hover:bg-primary-200 text-xl data-[prompt=false]:text-2xl data-[prompt=false]:bg-primary-200/20",children:e.jsx($,{className:"w-[300px] py-3 text-5xl"})},m)}),e.jsx(ee,{tutorialId:"database"})]})})}function Ya({chats:a,setIndex:s}){const t=n=>{s(n)};return e.jsx("div",{className:"w-[300px] flex flex-col border-r border-light/40",children:a==null?void 0:a.map((n,l)=>!!n.messages.length&&e.jsxs("div",{className:"w-full cursor-pointer hover:bg-primary-200 transition-colors p-4 border border-primary-100/20",onClick:()=>t(l),children:[e.jsx("h2",{className:"whitespace-nowrap text-ellipsis overflow-hidden py-1 text-xl font-bold",children:n.messages.length>1?n.messages[1].message.replace("<br/>",""):`Chat ${l.toString().padStart(2,"0")}`},n.messages.join()),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"italic text-xs",children:[n.messages.length," messagens"]}),e.jsx("span",{className:"italic text-xs",children:F(n.messages[n.messages.length-1].time).dateFormat_A})]})]},n.id))})}function Za({chats:a,index:s}){var r;const{client:t}=x.useContext(C),[n,l]=x.useState();return x.useEffect(()=>{var i,u;if(a.length){const o=(i=t==null?void 0:t.plan_management.project.find(m=>a&&m.id===a[s].project_id))==null?void 0:i.logo,d=(u=t==null?void 0:t.plan_management.project.find(m=>a&&m.id===a[s].project_id))==null?void 0:u.project_name;o&&d&&l({logoChat:o,projectName:d})}},[]),n&&e.jsx("div",{className:"w-2/3 overflow-auto flex flex-col",children:e.jsxs("div",{className:"w-full flex flex-col gap-4",children:[e.jsxs("div",{className:"w-full h-[60px] flex items-center px-4 bg-primary-100",children:[e.jsx("div",{className:"w-[50px] h-[50px] overflow-hidden rounded-full",children:e.jsx("img",{src:n==null?void 0:n.logoChat,alt:"logo do cliente",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"px-4 text-xl",children:n==null?void 0:n.projectName})]}),e.jsx("div",{className:"w-full h-[350px] p-4 flex flex-col gap-4 overflow-y-auto",children:(r=a[s])!=null&&r.messages?a[s].messages.map((i,u)=>e.jsx("div",{"data-player":i.player,className:"w-full flex data-[player='1']:justify-end justify-start",children:e.jsxs("div",{"data-player":i.player,className:"bg-light text-black/80 data-[player='1']:bg-primary-200 data-[player='1']:text-light p-2 rounded-xl max-w-md",children:[e.jsx("h2",{className:"",dangerouslySetInnerHTML:{__html:i.message}}),e.jsx("span",{className:"w-full flex justify-end text-xs italic",children:F(i.time).shortHour})]})},u)):e.jsx("h2",{className:"w-full h-[200px] flex justify-center items-center",children:"Ainda não existe nenhuma conversa para esse chat"})})]})})}function es(){var m;const{client:a}=x.useContext(C),[s,t]=G(),[n,l]=x.useState(0),[r,i]=x.useState([]),u=(m=a==null?void 0:a.plan_management)==null?void 0:m.project.map(p=>Object({id:p.project_name.replace(" ","_"),name:p.project_name}));x.useEffect(()=>{const p=s.get("filter_time_chats"),f=s.get("project");if(a&&u!=null&&u.length){let h;f?h=a.plan_management.project.filter(j=>j.project_name.replace(" ","_")===f&&j):h=a.plan_management.project;const _=h.map(j=>j.chat.filter(S=>Number(p)?P(S.created_at)<=Number(p):!0)).flat();i(_)}},[s]);const o=({target:p})=>{const f=p.selectedIndex,h=p.options[f].value,_=new URLSearchParams(s);_.set("project",h),t(_)},d=async({currentTarget:p})=>{if(a!=null&&a.plan_management){const f=p.querySelector("svg");f.classList.add("rotate-[-360deg]","transition-transform","duration-1000");const h=setTimeout(()=>{f.classList.remove("rotate-[-360deg]","transition-transform","duration-1000"),clearTimeout(h)},1e3)}};return e.jsxs(z,{title:"Registros",className:"px-8",children:[e.jsxs("div",{className:"w-full flex gap-8 h-[40px]",children:[e.jsx(D,{tip:"Selecione uma data  como filtro",children:e.jsx(me,{typeFilter:"filter_time_chats"})}),e.jsx(D,{tip:"Selecione um chat",children:e.jsx(de,{options:u||[],Icon:da,handleSelectDatabase:o})}),e.jsx(D,{tip:"Atualize seus chats",children:e.jsx("div",{className:"p-2 bg-primary-100 rounded-md cursor-pointer",onClick:d,children:e.jsx(re,{className:"text-xl"})})})]}),e.jsxs("div",{className:"w-full flex bg-gray my-4",children:[e.jsx(Ya,{chats:r,setIndex:l}),!!r.length&&e.jsx(Za,{chats:r,index:n})]})]})}function as({plan_management:a}){return e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsx("h2",{className:"text-xl p-2",children:"Historico de transações"}),e.jsx("div",{className:"w-full max-w-[1000px]",children:a?e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("div",{className:"w-full flex p-4 justify-between border border-zinc-800",children:[e.jsx("span",{className:"w-1/3 text-center",children:"Plano"}),e.jsx("span",{className:"w-1/3 text-center",children:"Transação"}),e.jsx("span",{className:"w-1/3 text-center",children:"Data e hora"}),e.jsx("span",{className:"w-1/3 text-center",children:"Valor do plano"}),e.jsx("span",{className:"w-1/3 text-center",children:"Método de pagamento"}),e.jsx("span",{className:"w-1/3 text-center",children:"Status"})]}),a.trasaction.map((s,t)=>e.jsxs("div",{className:"w-full flex px-4 justify-between border border-zinc-500/20",children:[e.jsx("span",{className:"w-1/3 text-center",children:a.plan.plan_name}),e.jsx("span",{className:"w-1/3 text-center",children:s.transaction_describe==="PAYMENT"?"Pagamento":s.transaction_describe==="REFUND_REQUEST"?"Reembolso solicitado":s.transaction_describe==="SUBSCRIPTION_CANCELLATION"?"Plano cancelado":"Reembolso cancelado"}),e.jsx("span",{className:"w-1/3 text-center",children:F(s.created_at).dateFormat_A}),e.jsxs("span",{className:"w-1/3 text-center",children:["R$",Number(s.amount_paid).toFixed(2).replace(".",",")]}),e.jsx("span",{className:"w-1/3 text-center",children:s.payment_method}),e.jsx("span",{className:"w-1/3 text-center",children:s.status==="APPROVED"?"Aprovado":s.status==="REJECT"?"Recusado":"Pendente"})]},t))]}):e.jsx("h2",{className:"text-zinc-500",children:"Você ainda não efetuou nenhum pagamento"})})]})}function ss({plan_management:a}){return a&&a.status!=="DISABLED"?e.jsx("span",{className:"font-bold text-yellow-600 uppercase",children:a.plan.plan_name}):e.jsx("span",{className:"text-zinc-400/60",children:"Sem plano"})}function ue(a){const l=(new Date(a)-new Date)/(1e3*60*60*24);return Number(l.toFixed(0))}function ts({plan_management:a}){const s=()=>a?ue(a.free_trial):0;return a&&a.status!=="DISABLED"&&e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("span",{children:["Projetos criados: ",a.project.length," / ",Number(a.plan.max_projects.default)]}),e.jsxs("span",{children:["Limite de messages: ",ja(a).totalMessages," / ",Number(a.plan.max_messages.default)," "]}),e.jsxs("span",{children:["Reembolso garantido: ",s()>0?s()+" dias restantes":"expirado"]}),e.jsxs("span",{children:["Status do plano: ",a.status==="ACTIVE"?"Ativo":"Desativado"]})]})}function ns({client:a}){const s=H(),t=()=>{s("/plans")};return(a!=null&&a.refund_requested.length&&a.refund_requested[0].status!=="PENDING",!0)&&e.jsx("div",{className:"w-full flex flex-col gap-4 my-4",children:e.jsx(v,{onClick:t,children:a!=null&&a.plan_management&&a.plan_management.status!=="DISABLED"?"Mudar de plano":"Adicionar plano"})})}async function os(a){return await R.post(`${O}/refund_requested`,a).catch(t=>console.log(t))}async function rs(a){return await R.post(`${O}/refund_requested/reactive`,{client_id:a}).catch(t=>console.log(t))}function ls({client:a}){const{setModalContent:s}=x.useContext(w),t=()=>a!=null&&a.plan_management?ue(a==null?void 0:a.plan_management.free_trial):0,n=async()=>{if(a){const u=prompt("Digite o motivo do seu cancelamento:"),o=prompt("Digite de 0 a 5, o quanto você gostou do nosso sistema"),d={client_id:a.id,reason:u||"",product_review:Number(o||0)};await os(d)?(s({componentName:"modal_request_success",components:e.jsx(g,{message:"Solicitação de reembolso foi enviada com sucesso!",componentName:"modal_request_success"})}),setTimeout(()=>window.location.reload(),1e3)):s({componentName:"modal_error_request",components:e.jsx(g,{message:"Ocorreu um erro ao enviar sua solicitação de reembolso, por favor entre em contato com nosso suporte.",componentName:"modal_error_request"})})}else s({componentName:"modal_error_client",components:e.jsx(g,{message:"Erro ao processar o cliente, por favor recarregue a página.",componentName:"modal_error_client"})})},l=()=>{if(a!=null&&a.plan_management)return a!=null&&a.refund_requested.length&&a.plan_management.status==="ACTIVE"&&t()>0?a.refund_requested[0].status!=="PENDING":t()>0&&a.plan_management.status!=="DISABLED"},r=()=>{a?window.open(`https://dash.ticto.com.br/subscription-verification?code=${a==null?void 0:a.ticto_order_code}&email=${a==null?void 0:a.purchase_email}`):s({componentName:"modal_failed_cancel",components:e.jsx(g,{message:"Falha ao preencher os dados de cancelamento, por favor entre em contato com o suporte.",componentName:"modal_failed_cancel"})})},i=()=>{if(a!=null&&a.plan_management&&a.plan_management.status==="ACTIVE"&&t()<=0)return!!(a.refund_requested.length&&a.refund_requested[0].status!=="PENDING")};return l()?e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("a",{onClick:n,className:"text-center underline cursor-pointer",children:"Pedir reembolso"})}):i()&&e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("a",{onClick:r,className:"text-center underline cursor-pointer",children:"Gerenciar assinatura"})})}function is({client:a}){return e.jsxs("div",{className:"w-1/2 min-w-[150px] max-w-[400px] border border-zinc-600 p-2 rounded-md z-50",children:[e.jsx("h2",{className:"w-full text-center",children:"Plano atual:"}),e.jsx("div",{className:"w-full flex justify-center p-4",children:e.jsx(ss,{plan_management:a==null?void 0:a.plan_management})}),e.jsx("div",{className:"w-full flex justify-center p-4",children:e.jsx(ts,{plan_management:a==null?void 0:a.plan_management})}),e.jsx(ns,{client:a}),e.jsx(ls,{client:a})]})}function cs({client:a}){const{setModalContent:s}=x.useContext(w),t=async()=>{a&&await rs(a.id)&&(s({componentName:"modal_reactive_plan",components:e.jsx(g,{message:"Plano reativado com  sucesso!",componentName:"modal_reactive_plan"})}),setTimeout(()=>window.location.reload(),1500))};return!!(a!=null&&a.refund_requested.length)&&a.refund_requested[0].status!=="CANCEL"&&e.jsxs("div",{className:"w-1/2 min-w-[150px] max-w-[400px] border border-zinc-600 p-2 rounded-md",children:[e.jsx("h2",{className:"w-full text-center pb-4 text-xl",children:"Reembolso solicitado:"}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Reembolso solicidado em:",e.jsx("p",{children:a.refund_requested[0].created_at.substring(0,10)})]}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Plano:",e.jsx("p",{children:a.plan_management.plan.plan_name})]}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Status:",a.refund_requested[0].status==="PENDING"?e.jsx("p",{className:"text-red-600",children:"Pendente"}):a.refund_requested[0].status==="APPROVED"?e.jsx("p",{className:"text-green-600",children:"Dinheiro devolvido"}):e.jsx("p",{className:"text-zinc-200",children:"Reembolso cancelado"})]}),e.jsx("div",{className:"w-full flex justify-center mt-6",children:a.refund_requested[0].status==="PENDING"&&e.jsx(v,{onClick:t,children:"Cancelar reembolso"})})]})}function ds(){const{client:a}=x.useContext(C);return e.jsxs(z,{title:"Assinatura",className:"flex-col gap-8",children:[e.jsxs("div",{className:"w-full p-4 flex gap-6 justify-center",children:[e.jsx(is,{client:a}),e.jsx(cs,{client:a}),e.jsx(ee,{tutorialId:"add_plan"})]}),e.jsx(as,{plan_management:a==null?void 0:a.plan_management})]})}function K({name:a}){const{register:s}=U(),[t,n]=x.useState(!1),l=()=>n(r=>!r);return e.jsxs("div",{className:"w-3/5 px-2 rounded-md flex justify-center items-center gap-2 bg-gray_light",children:[e.jsx("input",{className:"",type:t?"text":"password",...s(a)}),e.jsx(ma,{"data-isopen":!!t,className:"text-2xl data-[isopen=false]:hidden",onClick:l}),e.jsx(ua,{"data-isopen":!!t,className:"text-2xl data-[isopen=true]:hidden",onClick:l})]})}function ms(){const{setValue:a}=U(),s=J(),{handleSubmit:t}=s,{client:n}=x.useContext(C),{setModalContent:l,clearModal:r}=x.useContext(w),i=async u=>{if(!n)throw new Error("Client not founded.");if(u.new_password.length<8||u.current_password.length<8){const m=!u.new_password.length||!u.current_password.length?"Preencha todos os dados":"Informe uma senha com mais de 8 caracteres";l({componentName:"modal_error_fill_data",components:e.jsx(g,{message:m,componentName:"modal_error_fill_data",type:"WARNING"})});return}if(u.new_password!==u.confirm_password){l({componentName:"modal_error_new_password",components:e.jsx(g,{message:"Sua confirmação de senha não é idêntica a sua nova senha!",componentName:"modal_error_new_password",type:"ERROR"})});return}u.client_id=n.id;const o=await pa(u);o||l({componentName:"modal_error_password",components:e.jsx(g,{message:"A sua atual senha está incorreta!",componentName:"modal_error_password",type:"ERROR"})}),(o==null?void 0:o.status)===200&&(a("password",u.new_password),l({componentName:"modal_change_password_success",components:e.jsx(g,{message:"Senha atualizada com sucesso!",componentName:"modal_change_password_success",functionAfterComplete:()=>r(null,{clearLast:!0})})}))};return e.jsx(X,{...s,children:e.jsxs("form",{className:"flex min-w-[200px] flex-col gap-8",onSubmit:t(i),children:[e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Sua senha atual:"}),e.jsx(K,{name:"current_password"})]}),e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Nova senha:"}),e.jsx(K,{name:"new_password"})]}),e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Confirme sua senha:"}),e.jsx(K,{name:"confirm_password"})]}),e.jsxs(v,{customClass:"flex items-center gap-2",children:[e.jsx(ie,{})," Salvar"]})]})})}const us=q.object({fullname:q.string().min(1,"Digite seu nome completo!").refine(a=>{const s=a.split(" ");return!!(s.length>=2&&s[1])},"Vocẽ precisa informar seu nome completo"),user:q.string().min(1,"Digite um nome de usuário!").max(25,"Nome de usuário muito longe, informe um menor."),email:q.string().email(),password:q.string().min(8,"Sua senha precisa ter no minimo 8 caracteres!"),cpf_cnpj:q.string().refine(a=>a.includes("."),"Digite um cnpj ou cpf valído!")});function ps(){const{setModalContent:a}=x.useContext(w),{client:s,setClient:t}=x.useContext(C),n=J({resolver:xa(us),defaultValues:{fullname:s==null?void 0:s.fullname,user:s==null?void 0:s.user,cpf_cnpj:s==null?void 0:s.cpf_cnpj,email:s==null?void 0:s.email,password:"senha-qualquer"}}),{handleSubmit:l,formState:{errors:r}}=n;x.useEffect(()=>{const m=i(r);m&&a({componentName:"modal_error_message",components:e.jsx(g,{message:m,type:"WARNING",componentName:"modal_error_message"})})},[r]);const i=m=>{if(typeof m=="object"&&fa!==null)for(let p in m){if(p==="message")return m[p];{const f=i(m[p]);if(f!==void 0)return f}}},u=async m=>{if((s==null?void 0:s.user)===m.user||await ha(m.user)){m.client_id=s==null?void 0:s.id;const p=await _a(m);(p==null?void 0:p.status)===200&&(t(p.data),a({componentName:"modal_user_success",components:e.jsx(g,{componentName:"modal_user_success",message:"Perfil atualizado com sucesso"})}))}else a({componentName:"modal_error_user",components:e.jsx(g,{componentName:"modal_error_user",message:"Usuário informado não está disponível!",type:"WARNING"})})},o=()=>{a({componentName:"modal_show_password",components:e.jsx(T,{children:e.jsx(X,{...n,children:e.jsx(ms,{})})})})},d=()=>{a({componentName:"modal_show_email",components:e.jsx(g,{componentName:"modal_show_email",message:"Ainda não é possível atualizar o e-mail, para mais informações entre em contato com o suporte.",type:"WARNING"})})};return e.jsx(z,{title:"Configurações",children:e.jsx(X,{...n,children:e.jsxs("form",{onSubmit:l(u),className:"w-2/3 mx-auto p-4 px-8 flex flex-col gap-6",children:[e.jsxs(c.Container,{className:"flex items-center gap-4",children:[e.jsx(c.Input,{name:"fullname",title:"Nome completo"}),e.jsx(c.Input,{name:"user",title:"Usuário"})]}),e.jsx(c.Input,{name:"cpf_cnpj",title:"CNPJ ou CPF",mask:le}),e.jsxs(c.Container,{className:"flex gap-4 justify-center items-center",children:[e.jsx(c.Container,{children:e.jsx(c.Input,{type:"email",name:"email",title:"Informe seu e-mail",disabled:!0})}),e.jsxs(v,{type:"button",customClass:"min-w-[200px] flex justify-center items-center gap-2",onClick:d,children:["Alterar e-mail",e.jsx($,{})]})]}),e.jsxs(c.Container,{className:"flex gap-4 justify-center items-center",children:[e.jsx(c.Container,{children:e.jsx(c.Input,{type:"password",name:"password",title:"Sua senha",disabled:!0})}),e.jsxs(v,{type:"button",customClass:"min-w-[200px] flex justify-center items-center gap-2",onClick:o,children:["Alterar senha",e.jsx($,{})]})]}),e.jsxs(v,{customClass:"flex gap-2 mt-8",children:["Salvar ",e.jsx(ie,{})]})]})})})}function xs(){const[a]=G(),s=Number(a.get("tab"))||0;return e.jsx("div",{className:"w-full p-8 overflow-hidden",children:s===0?e.jsx(Ra,{}):s===1?e.jsx(Ja,{}):s===2?e.jsx(Xa,{}):s===3?e.jsx(es,{}):s===4?e.jsx(ds,{}):e.jsx(ps,{})})}function _s(){return e.jsxs("div",{className:"w-[90%] h-full flex-grow flex flex-col items-center bg-gradient-to-br from-primary-100 from-[10%] to-light to-[20%] dark:to-dark",children:[e.jsx(Ca,{}),e.jsx(xs,{})]})}export{_s as default};
