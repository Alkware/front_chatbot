import{j as e,B as v,b as O,A as R,r as h,C as w,M as b,F as me,c as ue,d as pe,P as T,T as E,e as xe,f as fe,u as H,g as he,h as _,i as se,t as _e,k as ge,l as ne,m as ee,n as je,o as Ne,p as ye,q as be,s as W,v as ve,w as we,x as Ce,y as $,z as Se,R as x,D as Ae,E as z,G as ae,H as J,J as Ee,K as ke,L as Te,N as Me,O as Ie,Q as De,S as Oe,U as Re,V as Pe,W as Fe,X as Le,Y as ze,Z as qe,$ as Ue,a0 as $e,a1 as Be,a2 as oe,a3 as Ge,a4 as Ve,a5 as He,a6 as We,a7 as Je,a8 as Qe,a9 as Ke,aa as Xe,ab as Ye,ac as Ze,ad as ea,ae as aa,af as ta,ag as sa,ah as na,ai as oa,aj as ra,ak as la,al as ia,am as ca,an as da,ao as Y,ap as re,aq as ma,ar as U,as as ua,at as pa,au as xa,av as fa}from"./index-ie9FIAAA.js";import{m as ha}from"./messagesEventManager-nP9Q9w4t.js";const _a=[{short:"Jan",complete:"Janeiro"},{short:"Fev",complete:"Fevereiro"},{short:"Mar",complete:"Março"},{short:"Abr",complete:"Abril"},{short:"Mai",complete:"Maio"},{short:"Jun",complete:"Junho"},{short:"Jul",complete:"Julho"},{short:"Ago",complete:"Agosto"},{short:"Set",complete:"Setembro"},{short:"Out",complete:"Outubro"},{short:"Nov",complete:"Novembro"},{short:"Dez",complete:"Dezembro"}];function P(a){const t=new Date(a);t.toLocaleTimeString("pt-BR",{hour12:!1});const s=t.getTimezoneOffset(),n=t.getMonth(),o=t.getUTCHours()-s/60,i=t.toLocaleDateString(),r=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`,u=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`,l=`${t.getDay()} de ${_a[n].short} - ${u}`;return{currentHour:o,fullDate:i,fullHour:r,shortHour:u,dateFormat_A:l,fullDateWithHour:`${i} - ${r}`}}function ga({notification:a}){return e.jsxs("div",{className:"flex flex-col justify-center items-center gap-4 min-w-[500px]",children:[e.jsx("h2",{className:"w-full text-2xl text-center font-bold",children:a.notification.title}),e.jsx("p",{dangerouslySetInnerHTML:{__html:a.notification.describe}}),e.jsx("div",{className:"flex p-4",children:!!Object.keys(a.notification.call_to_action).length&&e.jsx(v,{onClick:()=>window.open(a.notification.call_to_action.link),children:a.notification.call_to_action.text})})]})}async function ja(a){return await O.post(`${R}/notification/${a}/read`).catch(s=>console.log(s))}function Na(){const{client:a}=h.useContext(w),{setModalContent:t}=h.useContext(b),[s,n]=h.useState(),[o,i]=h.useState(),r=o==null?void 0:o.filter(l=>!l.read);h.useEffect(()=>{var c;const l=(c=a==null?void 0:a.notification_client)==null?void 0:c.sort((m,d)=>!m.read&&d.read?-1:m.read&&!d.read?1:0);i(l)},[]);const u=async l=>{const c=await ja(l.id);(c==null?void 0:c.status)===200&&(i(m=>{if(m){const d=m.filter(f=>f.id!==l.id),p=m.find(f=>f.id===l.id);if(p)return p.read=!0,d.push(p),d}}),t({componentName:"modal_display_notification",components:e.jsx(T,{children:e.jsx(ga,{notification:l})})}))};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-primary-100 rounded-full p-1",onClick:()=>n(l=>!l),children:[e.jsx("span",{"data-isnotification":!!(r!=null&&r.length),className:"w-[20px] h-[20px] data-[isnotification=false]:hidden flex justify-center items-center text-xs bg-red-800 border border-primary-300 rounded-full absolute -top-[10px] -right-[10px]",children:r==null?void 0:r.length}),e.jsx(me,{className:"text-2xl fill-light cursor-pointer"})]}),e.jsxs("div",{"data-display":!!s,className:"data-[display=false]:hidden flex flex-col absolute z-50 rounded-md bg-primary-100 p-4 right-0 translate-x-[122px] my-2 min-w-[400px]",children:[e.jsxs("div",{className:"w-full flex justify-between items-center border-b border-white/30",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Notificações"}),e.jsx(v,{children:"Marcar todas como lida"})]}),e.jsx("div",{className:"w-full flex flex-col",children:o==null?void 0:o.map(l=>e.jsxs("div",{className:"flex gap-4 items-center min-h-[60px] border-b border-white/30 hover:bg-primary-200/50 transition-colors cursor-pointer",onClick:()=>u(l),children:[e.jsx("div",{className:"min-w-1/3",children:l.read?e.jsx(ue,{className:"text-2xl fill-zinc-300"}):e.jsx(pe,{className:"text-2xl fill-orange-400"})}),e.jsxs("div",{"data-isread":!!l.read,className:"flex flex-col data-[isread=true]:opacity-60",children:[e.jsx("h2",{className:"font-medium text-lg",children:l.notification.title}),e.jsxs("div",{className:"flex gap-2 items-end px-2",children:[e.jsx("p",{className:"w-2/3 line-clamp-1 opacity-90",children:l.notification.describe}),e.jsx("span",{className:"text-xs opacity-70",children:P(l.notification.created_at).dateFormat_A})]})]})]},l.id))})]})]})}function ya(){h.useEffect(()=>{const t=localStorage.theme==="dark";document.documentElement.classList.toggle("dark",t)},[]);const a=()=>{const t=localStorage.theme==="dark";document.documentElement.classList.toggle("dark",!t);const s=t?"light":"dark";localStorage.theme=s};return e.jsxs("div",{className:"flex gap-3 px-8",children:[e.jsx(E,{tip:"Notificações",position:"BOTTOM",children:e.jsx(Na,{})}),e.jsx(E,{tip:"Escolha entre thema light ou dark",position:"BOTTOM",children:e.jsxs("div",{className:"bg-primary-100 rounded-full p-1",onClick:a,children:[e.jsx(xe,{className:"text-2xl fill-light cursor-pointer hidden dark:block"}),e.jsx(fe,{className:"text-2xl fill-light cursor-pointer block dark:hidden"})]})})]})}function ba(){return e.jsx("header",{className:"w-full h-[8%] px-20 min-h-[70px] col-span-8 row-span-1 flex justify-end items-center",children:e.jsx(ya,{})})}function va({plan_management_id:a}){const{client:t}=h.useContext(w),{setModalContent:s,clearModal:n}=h.useContext(b),o=H(),i=()=>{if(t!=null&&t.plan_management)if(t!=null&&t.plan_management.prompt.length){const r=Number(t.plan_management.plan.max_projects.default),u=t.plan_management.project.length;t.plan_management.status!=="DISABLED"?r>u?o(`/create-chat/${a}`):s({componentName:"modal_reached_max_plan",components:e.jsx(_,{message:"Você atingiu o número maximo de chats por plano.",componentName:"modal_reached_max_plan"})}):s({componentName:"modal_plan_is_desabled",components:e.jsx(_,{message:"O plano da sua conta está desabilitado.",componentName:"modal_plan_is_desabled",functionAfterComplete:()=>o("/panel?tab=4")})})}else s({componentName:"modal_create_database",components:e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("h2",{className:"text-xl text-center",children:["Para criar um novo chat, antes é necessário ",e.jsx("br",{}),"  criar uma fonte de dados."]}),e.jsxs("h2",{className:"text-lg text-center opacity-80",children:["Nossa inteligência artifical vai analisar seus dados e ",e.jsx("br",{})," responder as dúvidas do usuário ",e.jsx("br",{}),"conforme as informações passadas na fonte de dados."]}),e.jsxs(v,{customClass:"my-4",onClick:()=>{o("/panel?tab=2"),n("modal_create_database")},children:[e.jsx(se,{}),"Criar fonte de dados"]})]})})});else s({componentName:"modal_without_plan",components:e.jsx(_,{message:"Nenhum plano foi vinculado a sua conta",componentName:"modal_without_plan",functionAfterComplete:()=>o("/panel?tab=4")})})};return e.jsx(E,{tip:"Crie um novo chat",children:e.jsx("div",{onClick:i,className:"border border-primary-100 rounded-full cursor-pointer",children:e.jsx(he,{className:"text-4xl text-primary-100"})})})}function q({children:a,title:t,className:s}){return e.jsxs("div",{className:_e("w-full min-h-[70vh] flex flex-col gap-4 justify-start items-start bg-light dark:bg-dark rounded-xl border border-primary-100 dark:border-primary-300 relative hidden-scrollbar",s),children:[e.jsx("h2",{className:"w-full text-primary-100 dark:text-light text-2xl font-semibold uppercase p-4 px-8",children:t}),a]})}function B({children:a,title:t,text:s,position:n="BOTTOM",hidden:o}){const i=h.useRef(null),{client:r,setClient:u}=h.useContext(w),l=async()=>{if(r){const c=await ne(r.id,!1);u(c)}};return r&&e.jsxs("div",{className:"flex items-center relative group",children:[e.jsx("div",{"data-active":r.tutorial,"data-hidden":o,className:"data-[hidden=true]:hidden data-[active=false]:hidden w-screen h-screen backdrop-blur-sm fixed top-0 left-0 z-50"}),e.jsxs("div",{"data-active":r.tutorial,ref:i,"data-position":n,"data-hidden":o,className:`border border-light/40 bg-primary-100 p-1 rounded-xl absolute z-50 left-1/2 -translate-x-1/2 
                    data-[position=TOP]:-top-full data-[position=TOP]:-translate-y-full data-[position=BOTTOM]:-bottom-full data-[position=BOTTOM]:translate-y-full
                    text-center transition-opacity  data-[hidden=true]:hidden data-[active=false]:hidden`,children:[e.jsxs("div",{className:" bg-primary-100 rounded-md flex flex-col justify-center items-center px-4",children:[e.jsx("h2",{className:"text-center py-2 font-bold text-xl text-light",children:t}),e.jsx("p",{className:"w-[400px] px-4 text-center text-light text-lg",dangerouslySetInnerHTML:{__html:s}}),e.jsx("div",{className:"w-full flex justify-center mt-8 text-light text-base",children:e.jsx("span",{className:"underline opacity-70 cursor-pointer",onClick:l,children:"Pular tutorial"})})]}),e.jsx(ge,{"data-position":n,className:"border-light/40 fill-primary-100 absolute left-1/2 -translate-x-1/2 data-[position='BOTTOM']:top-0 data-[position='BOTTOM']:-translate-y-[78%] data-[position='BOTTOM']:rotate-180"})]}),e.jsx("div",{"data-hidden":o,className:"z-50 data-[hidden=true]:z-0",children:a})]})}function wa({slug:a}){const{setModalContent:t,clearModal:s}=h.useContext(b),n=h.useRef(null),o=h.useRef(null),i=()=>{s(null,{clearAll:!0}),window.open(`https://chat.wipzee.com/${a}`)},r=()=>{try{const c=n.current;if(c){c.classList.toggle("disabled"),c.disabled=!1,c.select();var l=document.execCommand("copy");l&&t({componentName:"modal_copy_link",components:e.jsx(_,{message:"Link Copiado!",type:"INFORMATION",componentName:"modal_copy_link"})}),c.classList.toggle("disabled"),c.disabled=!0}}catch{t({componentName:"modal_failed_copy_link",components:e.jsx(_,{message:"Falha ao copiar o link!",type:"ERROR",componentName:"modal_failed_copy_link"})})}},u=()=>{try{const c=o.current;if(c){c.classList.toggle("disabled"),c.disabled=!1,c.select();var l=document.execCommand("copy");l&&t({componentName:"modal_copy_widget",components:e.jsx(_,{message:"Widget Copiado!",type:"INFORMATION",componentName:"modal_copy_widget"})}),c.classList.toggle("disabled"),c.disabled=!0}}catch{t({componentName:"modal_failed_copy_widget",components:e.jsx(_,{message:"Falha ao copiar o link!",type:"ERROR",componentName:"modal_failed_copy_widget"})})}};return e.jsxs("div",{className:"w-full flex flex-col gap-8",children:[e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx("h2",{className:"w-4/5 text-center uppercase",children:"Link do seu chat"}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("input",{ref:n,className:"w-4/5 border border-light/20 p-2 rounded-xl disabled",disabled:!0,defaultValue:`https://chat.wipzee.com/${a}`}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx(E,{tip:"Copie seu link",children:e.jsx(ee,{onClick:r,className:" text-2xl cursor-pointer"})}),e.jsx(B,{title:"Vamos abrir seu chat",text:"Clique no icone acima para abrir seu chat em uma nova guia para testa-lo",children:e.jsx(E,{tip:"Abra seu chat",children:e.jsx(je,{onClick:i,className:" text-xl cursor-pointer"})})})]})]}),e.jsx("span",{className:"w-4/5 text-center opacity-60",children:"Esse será o link que você enviará aos usuários que irão acessar seu chat."})]}),e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx("h2",{className:"w-4/5 text-center uppercase",children:"Código do Widget"}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("input",{ref:o,className:"w-4/5 border border-light/20 p-2 rounded-xl disabled",disabled:!0,defaultValue:`<script src="https://widget.wipzee.com/${a}" defer><\/script>`}),e.jsx("div",{className:"w-1/5 flex justify-center items-center gap-4",children:e.jsx(ee,{onClick:u,className:" text-2xl cursor-pointer"})})]}),e.jsx("span",{className:"w-4/5 text-center opacity-60",children:"Copie e cole esse código no head do html do seu site."})]})]})}const Ca=a=>a.errors!=null,Sa=(a,t)=>{const s={};for(;a.length;){const n=a[0],{code:o,message:i,path:r}=n,u=r.join(".");if(!s[u])if("unionErrors"in n){const l=n.unionErrors[0].errors[0];s[u]={message:l.message,type:l.code}}else s[u]={message:i,type:o};if("unionErrors"in n&&n.unionErrors.forEach(l=>l.errors.forEach(c=>a.push(c))),t){const l=s[u].types,c=l&&l[n.code];s[u]=be(u,t,s,o,c?[].concat(c,n.message):n.message)}a.shift()}return s},le=(a,t,s={})=>async(n,o,i)=>{try{const r=await a[s.mode==="sync"?"parse":"parseAsync"](n,t);return i.shouldUseNativeValidation&&Ne({},i),{errors:{},values:s.raw?n:r}}catch(r){if(Ca(r))return{values:{},errors:ye(Sa(r.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw r}};function Aa(){const{watch:a}=W(),[t,s]=h.useState();return h.useEffect(()=>{const n=a("step_4.slug");s(n.replaceAll(" ","-"))},[a()]),e.jsxs("div",{className:"w-full flex gap-2 items-center bg-white p-2 my-4 rounded-md",children:[e.jsx(ve,{className:"fill-zinc-600"}),e.jsx(we,{className:"fill-zinc-600"}),e.jsx(Ce,{className:"fill-zinc-600"}),e.jsxs("div",{className:"w-full bg-zinc-600 rounded-xl p-3 flex gap-2 items-center",children:[e.jsx($,{className:"fill-green-600"}),e.jsxs("h2",{className:"opacity-80",children:["https://chat.wipzee.com/",t]})]})]})}function Ea(){const{control:a}=W(),{fields:t,remove:s,append:n}=Se({control:a,name:"step_0.social_proof"});return e.jsxs(x.Container,{className:"overflow-auto h-[400px]",children:[e.jsxs(x.Container,{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione avaliações dos seus clientes:"}),e.jsx("span",{className:"text-sm opacity-70",children:"(Essas avaliações estarão visível na bio do chat)"})]}),e.jsxs(v,{type:"button",onClick:()=>n({}),children:["Adicionar ",e.jsx(se,{})]})]}),e.jsx(x.Container,{className:"px-4 overflow-auto h-[300px] my-2",children:t.map((o,i)=>e.jsxs(x.Container,{className:"w-full flex flex-col gap-4 my-2 p-2 rounded-lg border border-primary-100 relative",children:[e.jsx(Ae,{className:"absolute -top-3 -right-3 bg-red-800/50 fill-red-500 cursor-pointer rounded-full p-1 text-2xl",onClick:()=>s(i)}),e.jsxs(x.Container,{className:"w-full flex justify-start items-center gap-4",children:[e.jsx(x.File,{name:`step_0.social_proof.${i}.avatar`,sizeContainer:"50px"}),e.jsx(x.Input,{title:"Nome do cliente",name:`step_0.social_proof.${i}.person_name`}),e.jsx(x.Input,{type:"number",title:"Nota da avaliação",name:`step_0.social_proof.${i}.rating`,min:0,max:5})]}),e.jsx(x.TextArea,{name:`step_0.social_proof.${i}.text`,title:"Oque o cliente achou do produto?"}),e.jsxs(x.Container,{className:"flex gap-4 justify-start",children:[e.jsx(x.File,{name:`step_0.social_proof.${i}.images.0`,sizeContainer:"50px"}),e.jsx(x.File,{name:`step_0.social_proof.${i}.images.1`,sizeContainer:"50px"}),e.jsx(x.File,{name:`step_0.social_proof.${i}.images.2`,sizeContainer:"50px"})]})]},o.id))})]})}function ka({project:a,setProjects:t}){var N,C,k,F,I;const{setModalContent:s,clearModal:n}=h.useContext(b),{setClient:o,client:i}=h.useContext(w),[r,u]=h.useState(),[l,c]=z(),m=Number(l.get(ae))||0,d=J({resolver:le(Ee),defaultValues:{step_0:{project_name:a.project_name,logo:a.logo,bio:a.bio,social_proof:a.social_proof},step_1:{prompt_id:a.prompt.id,chat_input_message:a.chat_input_message,call_to_action:a.call_to_action},step_2:{facebook_pixel:a.pixel_facebook},step_3:{chat_appearance:{chat_icon:(N=a.chat_appearance)==null?void 0:N.chat_icon,icon_text:(C=a.chat_appearance)==null?void 0:C.icon_text,primary_color:(k=a.chat_appearance)==null?void 0:k.primary_color,second_color:(F=a.chat_appearance)==null?void 0:F.second_color,background:(I=a.chat_appearance)==null?void 0:I.background}},step_4:{slug:a.slug}}});h.useEffect(()=>{(async()=>{l.set(ke,(a.call_to_action.length-1).toString()),c(l);const j=await Te(a.plan_management_id);(j==null?void 0:j.status)===200&&u(j.data.prompt)})()},[]);const p=async j=>{var M,L;let y={};if(Object.keys(j).forEach(S=>{const G=j[S];Object.keys(G).forEach(V=>{y[V]=j[S][V]})}),y&&a.slug){if((M=j.step_4)!=null&&M.slug&&((L=j.step_4)==null?void 0:L.slug)!==a.slug&&!await De(j.step_4.slug)){s({componentName:"modal_error_slug",components:e.jsx(_,{componentName:"modal_error_slug",message:"A slug escolhida não está disponível!",type:"WARNING"})});return}y.chat_appearance.can_update=a.chat_appearance.can_update,y.chat_appearance.id=a.chat_appearance.id;const S=await Oe(y,a.slug);S&&S.status===200&&(t(G=>{const V=G.findIndex(Q=>Q.id===a.id),Z=G.filter(Q=>Q.id!==a.id);return y.is_online=S.data.is_online,y.plan_management_id=S.data.plan_management_id,y.id=S.data.id,y.prompt=S.data.prompt,y.chat_appearance=S.data.chat_appearance,Z.splice(V,0,y),Z}),s({componentName:"modal_chat_updated",components:e.jsx(_,{message:"Chat atualizado com sucesso",componentName:"modal_chat_updated",functionAfterComplete:()=>n("modal_edit_project")})}))}};async function f(){const j=async()=>{if(a.id){const y=await Pe(a.id);if(y&&y.status===200){t(L=>L.filter(S=>S.id!==a.id));const M=i==null?void 0:i.plan_management.project.findIndex(L=>L.id===a.id);i&&M&&(i.plan_management.project.splice(M,1),o(i)),s({componentName:"modal_delete_success",components:e.jsx(_,{message:"Chat excluido com sucesso!",componentName:"modal_delete_success",functionAfterComplete:()=>n(null,{clearAll:!0})})})}}};s({componentName:"modal_confirm_delete_chat",components:e.jsx(T,{children:e.jsx(Re,{title:"Tem certeza que deseja deletar esse chat?",subTitle:"Uma vez removido, não pode ser revertido.",confirmFunction:j,cancelFuntion:()=>n("modal_confirm_delete_chat")})})})}const g=j=>{l.set(ae,j.toString()),c(l),d.unregister("step_3.chat_appearance.chat_icon"),d.register("step_3.chat_appearance.chat_icon",{value:j})};return!!(r!=null&&r.length)&&e.jsx("div",{className:"w-[90vw] h-[80vh] min-h-[450px] min-w-[700px] flex overflow-hidden",children:e.jsxs(x.EditForm,{form:d,onDelete:f,onSubmit:p,activeSimulator:!0,children:[e.jsxs(x.EditStep,{index:0,titleStep:"Informações do chat",children:[e.jsxs(x.Container,{className:"flex justify-start items-center gap-6",children:[e.jsx(x.File,{name:"step_0.logo",sizeContainer:"80px"}),e.jsx(x.Input,{name:"step_0.project_name",title:"Escreva o nome do seu chat"})]}),e.jsx(x.TextArea,{name:"step_0.bio",title:"Escreva uma descrição para seu chat"}),e.jsx(Ea,{})]}),e.jsxs(x.EditStep,{index:1,titleStep:"Configurações do chat",children:[e.jsx(x.Select,{name:"step_1.prompt_id",options:r.map(j=>Object({value:j.id,text:j.prompt_name})),title:"Selecione sua fonte de dados"}),e.jsx(x.TextArea,{name:"step_1.chat_input_message.0",title:"Digite a primeira mensagem do seu chat"}),e.jsx(Me,{})]}),e.jsx(x.EditStep,{index:2,titleStep:"Aparência do chat",children:e.jsxs(x.Container,{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"flex flex-col justify-center gap-4",children:[e.jsx("h2",{className:"text-center text-xl",children:"Escolha um icone para seu chat"}),e.jsx("div",{className:"flex justify-center gap-8 text-5xl",children:Ie.map(({Icon:j,id:y},M)=>e.jsx(j,{"data-iscurrent":m-1===M,className:"hover:bg-primary-100 data-[iscurrent=true]:bg-primary-100 cursor-pointer rounded-full p-2",onClick:()=>g(y)},y))})]}),e.jsx(x.Input,{name:"step_3.chat_appearance.icon_text",title:"Digite o texto que será exibido ao lado do icon"}),e.jsxs(x.Container,{className:"flex",children:[e.jsx(x.Color,{name:"step_3.chat_appearance.primary_color",title:"Escolha a cor primária do seu chat"}),e.jsx(x.Color,{name:"step_3.chat_appearance.second_color",title:"Escolha a cor secundária do seu chat"})]}),e.jsx(x.Color,{name:"step_3.chat_appearance.background",title:"Escolha a cor do background do seu chat"})]})}),e.jsx(x.EditStep,{index:3,titleStep:"Configuração avançadas",children:e.jsxs(x.Container,{className:"flex flex-col",children:[e.jsx(x.Input,{name:"step_4.slug",title:"Altere a slug do seu chat"}),e.jsx(Aa,{}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium uppercase",children:"Lembre-se"}),e.jsx("span",{className:"opacity-70",children:"Ao trocar a slug do seu chat, todos seus clientes que possuirem a URL antiga, podem perder acesso ao seu site utilizando a antiga URL."})]})]})})]})})}function Ta({project:a,setNewProject:t,prompts:s}){const{client:n}=h.useContext(w),{setModalContent:o}=h.useContext(b),i=H(),[r,u]=z(),l=()=>{r.get("tour")==="2"&&(r.set("tour","0"),u(r),n&&ne(n==null?void 0:n.id,!1)),o({componentName:"modal_edit_project",components:e.jsx(T,{children:e.jsx(ka,{setProjects:t,project:a,prompts:s})})})},c=async(p,f)=>{if(!f)return o({componentName:"modal_failed_updated_status_chat",components:e.jsx(_,{message:"Falha ao atualizar o status do chat, reinicie a página e tente novamente",componentName:"modal_failed_updated_status_chat",type:"WARNING"})}),!1;const g=await qe(p,f);return(g==null?void 0:g.status)===200?(t(N=>(N.find(C=>C.id===g.data.id).is_online=g.data.is_online,N)),!0):(o({componentName:"modal_failed_updated_status_chat_02",components:e.jsx(_,{message:"Falha ao atualizar o status do chat, reinicie a página e tente novamente",componentName:"modal_failed_updated_status_chat_02",type:"WARNING"})}),!1)},m=()=>{if(r.set("tour","2"),u(r),!a.slug){o({componentName:"modal_failed_display_link",components:e.jsx(_,{message:"Falha ao exibir seus links",type:"ERROR",componentName:"modal_failed_display_link"})});return}o({componentName:"modal_display_share_project",components:e.jsx(T,{children:e.jsx(wa,{slug:a.slug})})})},d=({target:p})=>{p.dataset.metric&&i("/panel?tab=1")};return a&&e.jsxs("div",{className:"w-1/4 min-w-[200px] bg-primary-100 dark:bg-gray text-light relative flex flex-col items-center gap-2 cursor-pointer rounded-xl",onClick:d,"data-metric":!0,children:[e.jsxs("div",{className:"w-full flex justify-between items-center gap-2 p-2",children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(B,{title:"Vamos acessar seu chat",text:"Clique aqui em cima para obter seu link ou para pegar o código do widget",hidden:r.get("tour")==="2"||r.get("tour")==="0",children:e.jsx(E,{tip:"Veja todos os seus links",children:e.jsx(Fe,{className:" text-xl",onClick:m})})}),e.jsx(B,{title:"Vamos personalizar seu chat",text:"Agora que já viu como funciona, vamos conhecer como podemos deixar ele de acordo com a sua marca!",hidden:r.get("tour")!=="2",children:e.jsx(E,{tip:"Edite seu chat",children:e.jsx(Le,{className:"text-xl",onClick:l})})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(E,{tip:"Ative ou desative seu chat",children:e.jsx(ze,{isActive:a.is_online,template:"onOff",cb:p=>c(p,a.slug)})})})]}),e.jsx("div",{className:"w-[150px] h-[110px] rounded-xl overflow-hidden","data-metric":!0,children:e.jsx("img",{src:a.logo||"https://via.placeholder.com/100",alt:"imagem do projeto",className:"w-full h-full object-cover"})}),e.jsx("h2",{className:"text-center py-4 font-bold text-lg","data-metric":!0,children:a.project_name})]},a.slug)}function Ma(){var n;const{client:a}=h.useContext(w),[t,s]=h.useState(a!=null&&a.plan_management?a.plan_management.project:[]);return a&&e.jsx(q,{title:"Meus chats",children:e.jsxs("div",{className:"w-4/5 px-8 pb-6 flex flex-col gap-8 z-50",children:[e.jsx("div",{className:"w-full flex justify-end items-center",children:e.jsx(B,{title:"Vamos criar seu primeiro chat",text:'Clique em <span class="text-3xl font-medium mx-1">+</span> para criar seu primeiro chat de forma simples e fácil',position:"BOTTOM",hidden:t.length!==0,children:e.jsx(va,{plan_management_id:(n=a==null?void 0:a.plan_management)==null?void 0:n.id})})}),t.length?e.jsx("div",{className:"w-full flex flex-col gap-4",children:e.jsx("div",{className:"w-full flex items-center gap-4",children:t.map(o=>{var i;return e.jsx(Ta,{project:o,setNewProject:s,prompts:(i=a.plan_management)==null?void 0:i.prompt},o.id)})})}):e.jsx("h2",{className:"py-8 font-bold text-primary-100 dark:text-light",children:'Você ainda não possui nenhum chat, clique em "Novo chat" para começar seu primeiro projeto.'})]})})}function Ia({setColumns:a,columns:t,modalName:s}){const{clearModal:n}=h.useContext(b),[o,i]=h.useState(t),r=l=>{const c=l.currentTarget.dataset.status=="true",m=l.currentTarget.dataset.name;i(()=>[...t.filter((d,p)=>(p>1&&d.columnName===m&&(d.status=!c),d))])},u=()=>{localStorage.setItem("metricColumnActive",JSON.stringify(t)),a(t),n(s)};return e.jsxs("div",{className:"w-1/2 max-w-[400px] bg-zinc-800 text-light",children:[e.jsx("h2",{className:"w-full text-center text-xl p-4",children:"Organize suas columns"}),e.jsx("div",{className:"w-full flex gap-2 flex-col",children:o.map((l,c)=>e.jsxs("div",{className:"w-full flex justify-between px-4",children:[e.jsx("p",{children:l.columnName}),e.jsx("div",{className:"w-[30px] h-[20px] bg-zinc-100 flex overflow-hidden rounded-full cursor-pointer",style:{justifyContent:`${l.status?"end":"start"}`},onClick:r,"data-status":l.status,"data-name":l.columnName,children:e.jsx("div",{className:"w-2/3 h-full rounded-xl flex justify-center items-center",style:{background:`${l.status?"green":"red"}`},children:c<2&&e.jsx($,{className:"w-[8px]"})})})]},l.columnName))}),e.jsx("div",{className:"w-full flex mt-12 justify-center",children:e.jsx(v,{onClick:u,children:"Salvar"})})]})}function ie({options:a,alternativeTitle:t,title:s,Icon:n,defaultValue:o,handleSelectDatabase:i}){return e.jsxs("div",{className:"w-full px-2 h-full bg-light dark:bg-gray border border-primary-100 font-bold rounded-lg flex gap-2 justify-center items-center",children:[n&&e.jsx(n,{className:"text-2xl fill-primary-100 dark:fill-light"}),e.jsxs("select",{className:"h-full bg-light dark:bg-gray text-primary-100 dark:text-light cursor-pointer outline-none ",disabled:!a.length,onChange:i,defaultValue:o||"#",children:[s&&t&&e.jsx("option",{disabled:!0,value:"#",className:"cursor-pointer",children:a.length?s:t}),a.map((r,u)=>e.jsx("option",{value:r.id,className:"cursor-pointer",children:r.name},u))]})]})}function ce({typeFilter:a}){const[t,s]=z(),n=({target:o})=>{const i=P(new Date).currentHour,r=o,{value:u}=o.options[r.selectedIndex];var l=0;switch(u){case"today":l=i;break;case"yesterday":l=i+24;break;case"last_7_days":l=i+6*24;break;case"last_14_days":l=i+13*24;break;case"last_month":l=i+29*24;break;case"last_3_month":l=i+89*24;break;case"last_6_month":l=i+179*24;break;case"last_year":l=i+364*24;break;default:l=0;break}const c=new URLSearchParams(t);c.set(a,l.toString()),s(c)};return e.jsx(ie,{handleSelectDatabase:n,Icon:Ue,options:[{id:"0",name:"Todas as datas"},{id:"today",name:"Hoje"},{id:"yesterday",name:"Ontem"},{id:"last_7_days",name:"Ultimos 7 dias"},{id:"last_14_days",name:"Ultimos 14 dias"},{id:"last_month",name:"Ultimo mês"},{id:"last_3_month",name:"Ultimos 3 meses"},{id:"last_6_month",name:"Ultimos 6 meses"},{id:"last_year",name:"Ultimo ano"}]})}function D(a){const t=Number(new Date),s=Number(new Date(a)),o=(t-s)/(1e3*3600);return Math.floor(o)}function A(a,t=0){function s(){return a.metric.chat_event.reduce((p,f)=>{const g=f.open_chat.filter(N=>{const C=D(N.created_at);return t>0?C<=t:!0});return p+g.length},0)}function n(){return(a.metric.chat_event.filter(f=>{const g=D(f.created_at);return t>0?g<=t:!0})||[]).filter((f,g,N)=>g===N.findIndex(C=>C.guest_id===f.guest_id)).length}function o(){return a.plan_message_manager.filter(p=>{const f=D(p.created_at);return t>0?f<=t:!0},0).reduce((p,f)=>p+f.input,0)}function i(){return a.plan_message_manager.filter(p=>{const f=D(p.created_at);return t>0?f<=t:!0},0).reduce((p,f)=>p+f.output,0)}function r(){const d=o()+i(),p=n()>0?d/n():0;return p%1===0?p:Number(p.toFixed(1))}function u(){const d=a.metric.chat_event.reduce((C,k)=>{const F=k.chat_time.filter(I=>{const j=D(I.created_at);return t>0?j<=t:!0});return C+F.reduce((I,j)=>{if(!j.closed_at&&!j.created_at)return 0;const y=Number(new Date(j.closed_at))-Number(new Date(j.created_at));return I+y},0)},0),p=Math.floor(d/1e3),f=Math.floor(p/60);return`${Math.floor(f/60).toString().padStart(2,"0")}:${(f%60).toString().padStart(2,"0")}:${(p%60).toString().padStart(2,"0")}`}function l(){const d=a.metric.chat_event.reduce((k,F)=>{const I=F.chat_time.filter(j=>{const y=D(j.created_at);return t>0?y<=t:!0});return k+I.reduce((j,y)=>{if(!y.closed_at&&!y.created_at)return 0;const M=Number(new Date(y.closed_at))-Number(new Date(y.created_at));return j+M},0)},0),p=d>0?d/n():0,f=Math.floor(p/1e3),g=Math.floor(f/60),N=Math.floor(g/60),C=`${N.toString().padStart(2,"0")}:${(g%60).toString().padStart(2,"0")}:${(f%60).toString().padStart(2,"0")}`;return N!==1/0?C:"00:00:00"}function c(){return a.metric.button_event.filter(p=>{const f=D(p);return t>0?f<=t:!0},0).reduce((p,f)=>p+f.clicked_button.length,0)}function m(){return P(a.created_at).dateFormat_A}return{IS_ONLINE:a.is_online||!1,NAME:a.project_name,CAT:s(),CAU:n(),MESSAGE_INPUT:o(),MESSAGE_OUTPUT:i(),MESSAGES_TOTAL:o()+i(),MEDIA_MESSAGES_CHAT:r(),USAGE_TIME:u(),MEDIA_USAGE_TIME:l(),CREATED_AT:m(),LINK_CLICKS:c(),LEADS_COLLECTED:0,SERVICE_NOTE:0,RESOLUTION_RATE:0,TOKEN_INPUT:"0",TOKEN_OUTPUT:"0",TOKEN_TOTAL:"0",USED_REAL:"0"}}async function Da(a){return await O.post(`${R}/analyze_metric`,{prompt:a}).catch(s=>console.log(s))}function Oa(a){const t=a.split("");let s="";return t.forEach(n=>{n.includes(`
`)&&s.length||n.includes(":")?s+=n+"<br />":s+=n}),s}async function Ra(a,t){const s=await O.post(`${R}/metric_analysis/create`,{plan_management_id:a,result:t});if(s.data.error)throw new Error("Unable to create the Metric Analysis.");return s}async function Pa({feedback:a,metrics_analysis_rating:t,metric_analysis_id:s}){const n=await O.post(`${R}/metric_analysis/create_feedback`,{feedback:a,metrics_analysis_rating:t,metric_analysis_id:s});if(n.data.error)throw new Error("Unable to create the Feedback Metric Analysis.");return n}async function Fa(a){const t=await O.get(`${R}/metric_analysis/${a}`);if(t.status===400)throw new Error("Unable to create the Feedback Metric Analysis.");return t}function La({index:a,spanReview:t,metric_analysis_id:s}){const n=h.useRef(null),{setModalContent:o,clearModal:i}=h.useContext(b),r=async()=>{var l;const u=(l=n.current)==null?void 0:l.value;u&&s?(await Pa({feedback:u,metrics_analysis_rating:a,metric_analysis_id:s})).data.response&&o({componentName:"modal_send_success",components:e.jsx(_,{componentName:"modal_send_success",message:"Feedback enviado com sucesso. Obrigado!",functionAfterComplete:()=>i(null,{clearLast:!0})})}):o({componentName:"modal_error_send_feedback",components:e.jsx(_,{componentName:"modal_error_send_feedback",message:"Você precisa deixar um feedback antes de enviar sua avaliação ou houve um erro no envio do feedback!",type:"ERROR"})})};return e.jsxs("div",{className:"w-[300px] flex flex-col items-center gap-2",children:[e.jsxs("h2",{className:"text-center font-bold text-lg",children:['Sua avaliação foi "',t,'".']}),e.jsx("p",{className:"text-center opacity-80",children:"Gostaria de deixar um feedback em algo poderia melhorar?"}),e.jsx("textarea",{ref:n}),e.jsx(v,{customClass:"my-4",onClick:r,children:"Enviar"})]})}var te=`
 A wipzee é uma empresa que fornece um chatbot com inteligencia artificial, promovendo uma experiência completa ao usuário.
 Desda personalização do chat até o consumo de dados (Métricas), abaixo será informado as minhas métricas, quero que você faça uma analise
 completa e sugira melhorias ou me de feedbacks positivos sobre as métricas.

 exemplo 1: se tiver muitos chats abertos e nenhum clique no link, significa que o cliente não está sendo influenciado a clicar no link. Sugestão: "Mudar o texto do link e deixar mais atrativo ou melhorar sua fonte de dados."
 exemplo 2: se tiver muitos chats abertos e nenhuma ou poucas mensagens, significa que o cliente não está sentindo avontade de conversar com a IA ou não está conseguindo conversar com ela. SOLUÇÃO: Melhorar a primeira mensagem do chat ou ver se existe algum problema tecnico nas trocas de mengens."
`;function za(){const{clearModal:a,setModalContent:t}=h.useContext(b),{client:s}=h.useContext(w),[n,o]=h.useState(),i=h.useRef(null);h.useEffect(()=>{(async()=>{if(s){const c=(await Fa(s.plan_management.id)).data.response,m=s.plan_management.plan.max_analyze_metric.default,d=s.plan_management.plan.max_analyze_metric.bonus,p=Number(m+d);c.length?o({status:"APRROVED",analysis:c}):c.length==p?r():t({componentName:"modal_limit_analysis",components:e.jsx(_,{componentName:"modal_limit_analysis",message:"O limite de analises no seu plano foi atingido. Aguarde até amanhã ou mude de plano para fazer uma nova análise.",functionAfterComplete:()=>a(null,{clearAll:!0})})})}})()},[]);const r=()=>{if(n&&s&&(n==null?void 0:n.analysis.length)>=Number(s.plan_management.plan.max_analyze_metric.default)){t({componentName:"modal_max_limit_analysis",components:e.jsx(_,{componentName:"modal_max_limit_analysis",message:"O limite de análises no seu plano foi atingido. Aguarde até amanhã ou mude de plano para fazer uma nova análise.",type:"WARNING"})});return}if(o(null),!s)throw new Error("Client is missing!");const l=s.plan_management.project,c=P(new Date).currentHour;l&&l.forEach(m=>{te+=`
                    NOME DO CHAT: ${m.project_name}
                    
                    MÉTRICAS:

                    Chats abertos total:
                    (Essa métrica pode tanto ser tanto varios usuários abrindo um chat ou como pode ser o mesmo usuário abrindo ele varias vezes)
                    [1000]

                    Chats abertos:
                    (Essa métrica conta quantas vezes o usuário abriu o chat, caso o usuário abra o mesmo chat 2 vezes ou mais, será contabilizado apenas uma vez)
                    [1]

                    Quando o chat foi criado:  
                    (Essa métrica registra quando o chat foi criado)
                    [${A(m,c).CREATED_AT}]

                    chat está ativado ou desativado:  
                    (Informa se o chat está ativado ou não: true = ativado e false = desativado)
                    [${A(m,c).IS_ONLINE}]

                    Leads coletados:  
                    (Informa quantos usuários deixaram um contato salvo no sistema)
                    [${A(m,c).LEADS_COLLECTED}]

                    Cliques no link:  
                    (Informa quantos cliques no link(call to action) foi dado no chat)
                    [100]

                    Média de mensagens:  
                    (Informa qual a média de mensagens por chat)
                    [${A(m,c).MEDIA_MESSAGES_CHAT}]

                    Média de tempo de uso:  
                    (Informa qual a média que o usuário ficou interagindo no chat)
                    [${A(m,c).MEDIA_USAGE_TIME}]

                    Total de Mensagens:  
                    (Informa qual o total de mensagens que esse chat tem)
                    [${A(m,c).MESSAGES_TOTAL}]

                    Entrada de Mensagens:  
                    (Informa quantas mensagens os usuários já mandaram para esse chat)
                    [${A(m,c).MESSAGE_INPUT}]

                    Entrada de Mensagens:  
                    (Informa quantas mensagens os usuários já mandaram para esse chat)
                    [${A(m,c).MESSAGE_OUTPUT}]

                    Saída de Mensagens:  
                    (Informa quantas mensagens nossa inteligencia artificial já mandou para esse chat)
                    [${A(m,c).MESSAGE_OUTPUT}]

                    tempo de uso:  
                    (Informa quanto tempo esse chat já ficou aberto)
                    [${A(m,c).USAGE_TIME}]`}),(async()=>{const m=await Da(te);if((m==null?void 0:m.status)===200&&m.data){const{text:d}=m.data.choices[0],p=await Ra(s==null?void 0:s.plan_management.id,d);o({status:"APRROVED",analysis:p.data.response})}else t({componentName:"modal_error_analyze_metric",components:e.jsx(_,{componentName:"modal_error_analyze_metric",message:"Não foi possível analisar suas métricas, por favor tente mais tarde.",type:"ERROR"})})})()},u=l=>{var c,m;if(n!=null&&n.analysis[0].feedback)t({componentName:"modal_error_analysis_metric",components:e.jsx(_,{componentName:"modal_error_analysis_metric",message:"Essa análise já foi avaliada!",type:"WARNING"})});else{const d=l.currentTarget.tabIndex,p=((c=l.currentTarget.querySelector("span"))==null?void 0:c.textContent)||"Regular",f=(m=i.current)==null?void 0:m.querySelectorAll("div > svg");f==null||f.forEach(g=>g.classList.remove("fill-primary-100")),f==null||f.forEach((g,N)=>N+1<=d&&g.classList.add("fill-primary-100")),t({componentName:"modal_show_feedback_analyze",components:e.jsx(T,{children:e.jsx(La,{index:d,spanReview:p,metric_analysis_id:n==null?void 0:n.analysis[0].id})})})}};return n?e.jsxs("div",{className:"max-w-[500px] flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Relatório da análise"}),e.jsxs("span",{className:"opacity-70",children:[n.analysis.length,"/",Number(s==null?void 0:s.plan_management.plan.max_analyze_metric.default)," Análises restantes de hoje"]})]}),e.jsx("div",{className:"max-h-[300px] overflow-auto border border-primary-100 p-2",children:e.jsx("p",{dangerouslySetInnerHTML:{__html:Oa(n.analysis[0].result)},className:"text-center"})}),e.jsxs("div",{className:"flex flex-col w-full items-center my-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Avalie essa análise:"}),e.jsx("div",{className:"flex gap-2",ref:i,children:Array.from({length:5}).map((l,c)=>e.jsxs("div",{tabIndex:c+1,onClick:u,className:"group flex flex-col justify-center items-center",children:[e.jsx(Be,{"data-isselected":c+1<=n.analysis[0].metrics_analysis_rating,className:"cursor-pointer text-3xl hover:fill-primary-100 data-[isselected=true]:fill-primary-100"}),e.jsx("span",{className:"group-hover:opacity-100 opacity-0",children:c===0?"horrível":c===1?"ruim":c===2?"regular":c===3?"boa":"excelente"})]},c))})]}),e.jsxs("div",{className:"flex gap-8 justify-center items-center",children:[e.jsx("span",{onClick:()=>a(null,{clearLast:!0}),className:"underline opacity-80 my-4 cursor-pointer",children:"Fechar análise"}),e.jsx(v,{onClick:r,children:"Nova análise"})]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx($e,{}),e.jsx("h2",{children:"Analisando métricas"})]})}function qa({client:a,handleRequestDataProject:t,setColumns:s,columns:n}){const{setModalContent:o}=h.useContext(b),i=async({currentTarget:l})=>{if(a!=null&&a.plan_management){const c=l.querySelector("svg");c.classList.add("rotate-[-360deg]","transition-transform","duration-1000"),t(a==null?void 0:a.id);const m=setTimeout(()=>{c.classList.remove("rotate-[-360deg]","transition-transform","duration-1000"),clearTimeout(m)},1e3)}},r=()=>{o({componentName:"modal_organization_column",components:e.jsx(Ia,{modalName:"modal_organization_column",setColumns:s,columns:n})})},u=()=>{o({componentName:"modal_show_analyze_metric",components:e.jsx(T,{children:e.jsx(za,{})})})};return e.jsxs("div",{className:"w-[70vw] flex gap-8 justify-end items-center",children:[e.jsx("div",{className:"p-2 bg-light dark:bg-dark border border-primary-100 rounded-md cursor-pointer",onClick:i,children:e.jsx(oe,{className:"text-xl fill-primary-100 dark:fill-light"})}),e.jsx("div",{className:"h-[40px]",children:e.jsx(ce,{typeFilter:"filter_time_metric"})}),e.jsxs(v,{onClick:r,customClass:"bg-light dark:bg-dark text-primary-100 dark:text-light border border-primary-100 px-4",children:[" ",e.jsx(Ge,{className:"text-xl fill-primary-100 dark:fill-light"})," Organize as colunas"]}),e.jsxs(v,{customClass:"bg-primary-100 border border-primary-100 px-4",onClick:u,children:[" ",e.jsx(Ve,{className:"text-xl"})," Analisar métricas com IA"]})]})}const K=[{key:"IS_ONLINE",columnName:"Status",status:!0,dataType:"boolean"},{key:"NAME",columnName:"Nome do chat",status:!0,dataType:"string"},{key:"CAT",columnName:"Chats abertos (total)",status:!0,dataType:"number"},{key:"CAU",columnName:"Chats abertos (unico)",status:!1,dataType:"number"},{key:"MESSAGE_INPUT",columnName:"Mensagens de entrada",status:!1,dataType:"number"},{key:"MESSAGE_OUTPUT",columnName:"Mensagens de saída",status:!1,dataType:"number"},{key:"MESSAGES_TOTAL",columnName:"Mensagens total",status:!0,dataType:"number"},{key:"MEDIA_MESSAGES_CHAT",columnName:"Mensagens por chat",status:!1,dataType:"number"},{key:"USAGE_TIME",columnName:"Tempo de uso",status:!1,dataType:"string"},{key:"MEDIA_USAGE_TIME",columnName:"Tempo de uso por chat",status:!0,dataType:"string"},{key:"LINK_CLICKS",columnName:"Cliques no link",status:!0,dataType:"number"},{key:"LEADS_COLLECTED",columnName:"Leads coletados",status:!0,dataType:"number"},{key:"SERVICE_NOTE",columnName:"Nota de atendimento",status:!0,dataType:"number"},{key:"RESOLUTION_RATE",columnName:"Taxa de resolução",status:!0,dataType:"number"},{key:"CREATED_AT",columnName:"Criado em",status:!0,dataType:"string"}];function Ua({setColumns:a,columns:t}){return h.useEffect(()=>{const s=JSON.parse(localStorage.getItem("metricColumnActive")||"[]");s.length>0?s.length!==K.length?localStorage.setItem("metricColumnActive",JSON.stringify(K)):a(s):localStorage.setItem("metricColumnActive",JSON.stringify(K))},[]),t&&e.jsx("div",{className:"w-1/2 flex",children:t.map(s=>s.status&&e.jsx("span",{className:"flex-none p-3 text-sm font-bold uppercase text-center bg-primary-100 dark:bg-primary-300 text-light dark:text-primary-100 border-r border-r-light dark:border-r-primary-100",children:s.columnName},s.columnName))})}function $a({columns:a,setColumns:t,planManagement:s}){const[n]=z(),o=n.get("filter_time_metric");return e.jsxs("div",{className:"w-[70vw] h-[40vh] self-center rounded-xl overflow-x-auto",children:[e.jsx(Ua,{setColumns:t,columns:a}),e.jsx("div",{className:"flex flex-col",children:s!=null&&s.project?s.project.map(i=>e.jsx("div",{className:"flex-none flex",children:a.map((r,u)=>r.status&&e.jsx("span",{className:"w-48 flex-none text-ellipsis overflow-hidden whitespace-nowrap text-center border border-primary-100/30 p-2",children:u===0?e.jsxs("div",{className:"w-full flex justify-center items-center gap-2",children:[e.jsx("div",{className:`w-[8px] h-[8px] ${i.is_online?"bg-green-700":"bg-red-700"} rounded-full`}),e.jsx("span",{children:i.is_online?"Ativo":"Desativado"})]}):u===1?i.project_name:A(i,o)[r.key]},r.columnName))},i.id)):e.jsx("h2",{className:"text-center p-4",children:'Você ainda não criou nenhum chat, clique em "Meus chats" , depois criar "Novo chat".'})}),e.jsx("div",{className:"flex-none flex ",children:a.map((i,r)=>i.status&&e.jsx("div",{className:"w-48 flex-none p-2 flex justify-center items-center gap-2",children:r===1?e.jsx("span",{className:"w-full font-bold text-primary-100 text-xl text-center",children:"TOTAL"}):i.dataType==="number"?e.jsx("span",{className:"w-full font-bold text-primary-100 text-xl text-center",children:s==null?void 0:s.project.reduce((u,l)=>u+Number(A(l,o)[i.key]),0)}):e.jsx("span",{className:"w-full text-primary-100 text-xl text-center",children:"-"})},i.key))})]})}function Ba(){const a=JSON.parse(localStorage.getItem("metricColumnActive")||"[]"),{setModalContent:t}=h.useContext(b),{client:s}=h.useContext(w),[n,o]=h.useState(a),[i,r]=h.useState(s==null?void 0:s.plan_management);h.useEffect(()=>{s!=null&&s.plan_management&&u(s==null?void 0:s.id)},[]);const u=async l=>{const c=await He(l);(c==null?void 0:c.status)===200?r(c.data.plan_management):t({componentName:"modal_failed_load_metric",components:e.jsx(_,{message:"Falha ao recarregar as métricas, tente reiniciar a página.",type:"ERROR",componentName:"modal_failed_load_metric"})})};return e.jsx("div",{className:"w-full h-full overflow-y-auto flex flex-col gap-8",children:e.jsxs(q,{title:"Métricas",className:"flex-col items-center gap-8",children:[e.jsx(qa,{client:s,columns:n,handleRequestDataProject:u,setColumns:o}),e.jsx($a,{columns:n,planManagement:i,setColumns:o})]})})}function Ga({plan_management_id:a}){const{client:t}=h.useContext(w),{setModalContent:s}=h.useContext(b),n=H(),o=()=>{if(t!=null&&t.plan_management){const i=Number(t.plan_management.plan.max_databases.default),r=t.plan_management.prompt.length;t.plan_management.status!=="DISABLED"?i>r?n(`/create-database/${a}`):s({componentName:"modal_max_database",components:e.jsx(_,{message:"Você atingiu o número maximo de base de dados no seu plano.",componentName:"modal_max_database"})}):s({componentName:"modal_desactive_account",components:e.jsx(_,{message:"O plano da sua conta está desabilitado.",componentName:"modal_desactive_account"})})}else s({componentName:"modal_without_plan",components:e.jsx(_,{message:"Nenhum plano foi vinculado a sua conta",componentName:"modal_without_plan"})})};return e.jsx(We,{className:"w-[300px] text-5xl py-3 fill-primary-100",onClick:o})}function Va({prompt:a,setPrompts:t}){const{setModalContent:s,clearModal:n}=h.useContext(b),{client:o,setClient:i}=h.useContext(w),r=JSON.parse(a.prompt_query||"{}"),u=!!Object.keys(r).length,l=J({resolver:le(ea),defaultValues:u?{step_0:{products:r.step_0.products||""},step_1:{payment_methods:r.step_1.payment_methods||"",order_tracking:r.step_1.order_tracking||"",tracking_link:r.step_1.tracking_link||""},step_2:{days_of_warranty:r.step_2.days_of_warranty||0,how_exchanges_work_and_returns:r.step_2.how_exchanges_work_and_returns||"",how_guarantee_work:r.step_2.how_guarantee_work||""},step_3:{address:r.step_3.address||"",company_name:r.step_3.company_name||"",contact_email:r.step_3.contact_email||"",contact_phone_number:r.step_3.contact_phone_number||"",support_hours:r.step_3.support_hours||""},step_4:{client_describe:r.step_4.client_describe||"",ia_name:r.step_4.ia_name||"",restrictions:r.step_4.restrictions}}:void 0}),c=async d=>{const p=JSON.stringify(d),f=aa(d),g={prompt_name:a.prompt_name,prompt:f,prompt_query:p,client_describe:d.step_4.client_describe};if(g){const N=await ta(g,a.id);N&&N.status===200&&(t(C=>[...C.filter(k=>k.id!==N.data.id),N.data]),s({componentName:"modal_updated_database",components:e.jsx(_,{message:"Database atualizado com sucesso",componentName:"modal_updated_database",functionAfterComplete:()=>n(null,{clearAll:!0})})}))}};async function m(){if(a.id){const d=await sa(a.id);if((d==null?void 0:d.status)===200){t(f=>f.filter(g=>g.id!==d.data.id));const p=o==null?void 0:o.plan_management.prompt.findIndex(f=>f.id===a.id);o&&p&&(o.plan_management.prompt.splice(p,1),i(o)),s({componentName:"modal_delete_success",components:e.jsx(_,{message:"Fonte de dados excluido com sucesso!",componentName:"modal_delete_success",functionAfterComplete:()=>n(null,{clearAll:!0})})})}else(d==null?void 0:d.status)===500?s({componentName:"modal_failed_delete_database",components:e.jsx(_,{message:"Você não pode excluir uma fonte de dados que possui um chat vinculado a ela, tente excluir todos os chats primeiro, antes de excluir essa fonte de dados.",type:"ERROR",componentName:"modal_failed_delete_database"})}):s({componentName:"modal_failed_delete",components:e.jsx(_,{message:"Falha ao tentar excluir essa fonte de dados. Tente reiniciar a página e tentar de novo.",type:"ERROR",componentName:"modal_failed_delete"})})}}return e.jsx("div",{className:"w-[80vw] h-[70vh] flex overflow-auto hidden-scrollbar ",children:e.jsxs(x.EditForm,{form:l,onDelete:m,onSubmit:c,children:[e.jsx(x.EditStep,{index:0,titleStep:"Informações do produto",icon:e.jsx(Je,{}),children:e.jsx(Qe,{})}),e.jsxs(x.EditStep,{index:1,titleStep:"Métodos de pagamento",icon:e.jsx(Ke,{}),children:[e.jsx(x.Container,{className:"flex gap-4",title:"Quais são os métodos de pagamentos aceitos?",children:e.jsx(x.Select,{title:"Escolha seus métodos de pagamentos",isMultiple:!0,name:"step_1.payment_methods",options:[{value:"Pix",text:"Pix"},{value:"Boleto",text:"Boleto"},{value:"Cartão de débito",text:"Cartão de débito"},{value:"Cartão de crédito",text:"Cartão de crédito"},{value:"Pagamentos em aplicativo",text:"Pagamentos em aplicativo"}]})}),e.jsx(x.TextArea,{name:"step_1.how_to_buy",title:"como comprar seu produto?"}),e.jsxs(x.Optional,{defaultField:"",name:"step_1.order_tracking",text:"Você está entregando um produto físico?",children:[e.jsx(x.TextArea,{name:"step_1.order_tracking",title:"Como os clientes podem rastrear seu pedido?"}),e.jsx(x.Optional,{defaultField:"",name:"step_1.tracking_link",text:"Você possui link para rastrear pedido?",children:e.jsx(x.Input,{title:"Digite a url do site:",name:"step_1.tracking_link",onChange:({target:d})=>{d.value.toLowerCase().includes("http")||(d.value=`https://${d.value.replace("http","")}`)}})})]})]}),e.jsxs(x.EditStep,{index:2,titleStep:"Politicas e condições",icon:e.jsx(Xe,{}),children:[e.jsx(x.Input,{type:"number",name:"step_2.days_of_warranty",title:"Quantos dias o cliente tem de garantia?"}),e.jsx(x.TextArea,{name:"step_2.how_guarantee_work",title:"Como funciona a garantia?"}),e.jsx(x.Optional,{defaultField:"",name:"step_2.how_exchanges_work_and_returns",text:"Esse produto/serviço possui troca ou devolução?",children:e.jsx(x.TextArea,{name:"step_2.how_exchanges_work_and_returns",title:"Como funciona as trocas e devoluções?"})})]}),e.jsxs(x.EditStep,{index:3,titleStep:"Sobre a empresa",icon:e.jsx(Ye,{}),children:[e.jsx(x.Container,{className:"flex gap-4",children:e.jsx(x.Input,{name:"step_3.company_name",title:"Qual o nome da empresa?"})}),e.jsx(x.Input,{name:"step_3.address",title:"Qual o endereço da sua empresa?"}),e.jsxs(x.Container,{className:"flex gap-4",children:[e.jsx(x.Input,{name:"step_3.contact_email",title:"Digite um e-mail para contato"}),e.jsx(x.Input,{title:"Digite um telefone para contato",name:"step_3.contact_phone_number",onChange:({target:d})=>{const p=d.value.replace(/[^\d]/g,"");if(p.length<11){let f;p.length===11?f=p.replace(/^(\d{2})(\d{1})(\d{4})(\d{4})$/,"($1) $2 $3-$4"):f=p.replace(/^(\d{2})(\d{4})(\d{4})$/,"($1) $2-$3"),d.value=f}else d.value=d.value.substring(0,15)}})]}),e.jsx(x.Input,{name:"step_3.support_hours",title:"Qual seu horário para suporte humano?"})]}),e.jsxs(x.EditStep,{index:4,titleStep:"Personalidade da IA ",icon:e.jsx(Ze,{}),children:[e.jsx(x.Optional,{defaultField:"",name:"step_4.ia_name",text:"Deseja dar um nome a sua inteligência artificial?",children:e.jsx(x.Input,{name:"step_4.ia_name",title:"Qual o nome da sua inteligência artificial?"})}),e.jsx(x.Optional,{defaultField:"",text:"Deseja adicionar restrições de palavras ou frase?",name:"step_4.restrictions",children:e.jsx(x.Input,{name:"step_4.restrictions",title:"Faça uma lista de restrições para que a IA evite utiliza-la em uma conversa"})}),e.jsx(x.TextArea,{title:"Faça uma breve descrição de quem é seu público (cliente)",name:"step_4.client_describe"})]})]})})}function Ha(){var l;const{client:a}=h.useContext(w),{setModalContent:t,clearModal:s}=h.useContext(b),n=Array(na).fill(0),[o,i]=h.useState(((l=a==null?void 0:a.plan_management)==null?void 0:l.prompt)||[]),r=c=>{o!=null&&o.length&&t({componentName:"modal_create_database",components:e.jsx(T,{children:e.jsx(Va,{prompt:o[c],setPrompts:i})})})},u=c=>{async function m(d){d.preventDefault();const p=d.target.querySelector("input").value,f=o[c].id;if(p){const g=await la(p,f);(g==null?void 0:g.status)===200&&(i([...o,o[c].prompt_name=p]),t({componentName:"modal_saved",components:e.jsx(_,{message:"Nome da sua base de dados foi atualizado com sucesso!",componentName:"modal_saved",functionAfterComplete:()=>s(null,{clearAll:!0})})}))}}t({componentName:"modal_edit_name",components:e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col justify-center items-center gap-4",children:[e.jsx("h2",{children:"Digite o novo nome da sua fonte de dados:"}),e.jsxs("form",{onSubmit:m,className:"flex flex-col justify-center items-center gap-4",children:[e.jsx("input",{placeholder:"Ex: Minha nova base de dados",name:"database_name",defaultValue:o[c].prompt_name}),e.jsx(v,{type:"button",children:"Salvar"})]})]})})})};return a&&e.jsx(q,{title:"Fonte de dados",children:e.jsx("div",{className:"w-full flex-wrap flex justify-center p-4 my-12 gap-8",children:n.map((c,m)=>{var d,p,f,g,N;return(d=a.plan_management)!=null&&d.plan&&m<Number(a.plan_management.plan.max_databases.default)?e.jsx("div",{"data-prompt":!!((p=o[m])!=null&&p.prompt_name),className:"flex justify-center items-center rounded-xl cursor-pointer border border-primary-100 bg-primary-100 dark:bg-primary-300 hover:bg-primary-200 text-light dark:text-primary-100 text-xl data-[prompt=false]:text-2xl data-[prompt=false]:bg-primary-200/20 z-50",children:(f=o[m])!=null&&f.prompt_name?e.jsxs("div",{className:"w-[300px] flex gap-2 items-center justify-center",children:[e.jsxs("h2",{className:"w-[200px] text-center py-4 flex justify-center items-center gap-2",onClick:()=>r(m),children:[e.jsx(oa,{}),e.jsx("span",{className:"w-full whitespace-nowrap text-ellipsis overflow-x-hidden",children:(g=o[m])==null?void 0:g.prompt_name})]}),e.jsx(ra,{className:"cursor-text ",onClick:()=>u(m)})]}):e.jsx(B,{title:"Vamos criar sua primeira fonte de dados",text:"Clique em <span class='font-medium text-2xl mx-1'>+</span> para criar sua primeira fonte de dados.",position:"BOTTOM",hidden:m!==1,children:e.jsx(E,{tip:"Criar fonte de dados",children:e.jsx(Ga,{plan_management_id:a.plan_management.id})})})},m):e.jsx("div",{"data-prompt":!!((N=o[m])!=null&&N.prompt_name),className:"flex opacity-30 cursor-not-allowed justify-center items-center rounded-xl border border-primary-100 bg-primary-300 hover:bg-primary-200 text-xl data-[prompt=false]:text-2xl data-[prompt=false]:bg-primary-200/20",children:e.jsx($,{className:"w-[300px] py-3 text-5xl"})},m)})})})}function Wa({chats:a,setIndex:t}){const s=n=>{t(n)};return e.jsx("div",{className:"w-[300px] h-full overflow-auto flex flex-col border-r border-light/40",children:a==null?void 0:a.map((n,o)=>!!n.messages.length&&e.jsxs("div",{className:"w-full cursor-pointer hover:bg-primary-200 transition-colors p-4 border border-primary-100/20",onClick:()=>s(o),children:[e.jsx("h2",{className:"whitespace-nowrap text-ellipsis overflow-hidden py-1 text-xl font-bold",children:n.messages.length>1?n.messages[1].message.replace("<br/>",""):`Chat ${o.toString().padStart(2,"0")}`},n.messages.join()),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"italic text-xs",children:[n.messages.length," messagens"]}),e.jsx("span",{className:"italic text-xs",children:P(n.messages[n.messages.length-1].time).dateFormat_A})]})]},n.id))})}function Ja({chats:a,index:t}){var i;const{client:s}=h.useContext(w),[n,o]=h.useState();return h.useEffect(()=>{var r,u;if(a.length){const l=(r=s==null?void 0:s.plan_management.project.find(m=>a&&m.id===a[t].project_id))==null?void 0:r.logo,c=(u=s==null?void 0:s.plan_management.project.find(m=>a&&m.id===a[t].project_id))==null?void 0:u.project_name;l&&c&&o({logoChat:l,projectName:c})}},[]),n&&e.jsx("div",{className:"w-full h-full flex flex-col",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4",children:[e.jsxs("div",{className:"w-full h-[60px] flex items-center px-4 bg-primary-100",children:[e.jsx("div",{className:"w-[50px] h-[50px] overflow-hidden rounded-full",children:e.jsx("img",{src:n==null?void 0:n.logoChat,alt:"logo do cliente",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"px-4 text-xl text-light dark:text-primary-100",children:n==null?void 0:n.projectName})]}),e.jsx("div",{className:"w-full h-full p-4 flex flex-col gap-4 overflow-auto",children:(i=a[t])!=null&&i.messages?a[t].messages.map((r,u)=>e.jsx("div",{"data-player":r.player,className:"w-full flex data-[player='1']:justify-end justify-start",children:e.jsxs("div",{"data-player":r.player,className:"bg-primary-100/50 dark:bg-light text-black/80 data-[player='1']:bg-primary-100 dark:data-[player='1']:bg-primary-200 data-[player='1']:text-light p-2 rounded-xl max-w-md",children:[e.jsx("h2",{className:"",dangerouslySetInnerHTML:{__html:r.message}}),e.jsx("span",{className:"w-full flex justify-end text-xs italic",children:P(r.time).shortHour})]})},u)):e.jsx("h2",{className:"w-full h-[200px] flex justify-center items-center",children:"Ainda não existe nenhuma conversa para esse chat"})})]})})}function Qa(){var m;const{client:a}=h.useContext(w),[t,s]=z(),[n,o]=h.useState(0),[i,r]=h.useState([]),u=(m=a==null?void 0:a.plan_management)==null?void 0:m.project.map(d=>Object({id:d.project_name.replace(" ","_"),name:d.project_name}));h.useEffect(()=>{const d=t.get("filter_time_chats"),p=t.get("project");if(a&&u!=null&&u.length){let f;p?f=a.plan_management.project.filter(N=>N.project_name.replace(" ","_")===p&&N):f=a.plan_management.project;const g=f.map(N=>N.chat.filter(k=>Number(d)?D(k.created_at)<=Number(d):!0)).flat();r(g)}},[t]);const l=({target:d})=>{const p=d.selectedIndex,f=d.options[p].value,g=new URLSearchParams(t);g.set("project",f),s(g)},c=async({currentTarget:d})=>{if(a!=null&&a.plan_management){const p=d.querySelector("svg");p.classList.add("rotate-[-360deg]","transition-transform","duration-1000");const f=setTimeout(()=>{p.classList.remove("rotate-[-360deg]","transition-transform","duration-1000"),clearTimeout(f)},1e3)}};return e.jsxs(q,{title:"Registros",className:"px-8",children:[e.jsxs("div",{className:"w-full flex gap-8 h-[40px]",children:[e.jsx(E,{tip:"Selecione uma data  como filtro",children:e.jsx(ce,{typeFilter:"filter_time_chats"})}),e.jsx(E,{tip:"Selecione um chat",children:e.jsx(ie,{options:u||[],Icon:ia,handleSelectDatabase:l})}),e.jsx(E,{tip:"Atualize seus chats",children:e.jsx("div",{className:"p-2 bg-light dark:bg-gray border border-primary-100 rounded-md cursor-pointer",onClick:c,children:e.jsx(oe,{className:"text-xl"})})})]}),e.jsxs("div",{className:"w-full h-3/4 flex bg-light dark:bg-gray my-4 overflow-hidden",children:[e.jsx(Wa,{chats:i,setIndex:o}),!!i.length&&e.jsx(Ja,{chats:i,index:n})]})]})}function Ka({plan_management:a}){return e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsx("h2",{className:"text-xl p-2",children:"Historico de transações"}),e.jsx("div",{className:"w-full max-w-[1000px] p-4",children:a?e.jsxs("div",{className:"w-full flex flex-col rounded-md",children:[e.jsxs("div",{className:"w-full flex p-4 justify-between bg-primary-100/20 border border-primary-100 rounded-md",children:[e.jsx("span",{className:"text-center",children:"Plano"}),e.jsx("span",{className:"text-center",children:"Transação"}),e.jsx("span",{className:"text-center",children:"Data e hora"}),e.jsx("span",{className:"text-center",children:"Valor do plano"}),e.jsx("span",{className:"text-center",children:"Método de pagamento"}),e.jsx("span",{className:"text-center",children:"Status"})]}),a.trasaction.map((t,s)=>e.jsxs("div",{className:"w-full flex px-4 justify-between border border-zinc-500/20",children:[e.jsx("span",{className:"text-center",children:a.plan.plan_name}),e.jsx("span",{className:"text-center",children:t.transaction_describe==="PAYMENT"?"Pagamento":t.transaction_describe==="REFUND_REQUEST"?"Reembolso solicitado":t.transaction_describe==="SUBSCRIPTION_CANCELLATION"?"Plano cancelado":"Reembolso cancelado"}),e.jsx("span",{className:"text-center",children:P(t.created_at).dateFormat_A}),e.jsxs("span",{className:"text-center",children:["R$",Number(t.amount_paid).toFixed(2).replace(".",",")]}),e.jsx("span",{className:"text-center",children:t.payment_method}),e.jsx("span",{className:"text-center",children:t.status==="APPROVED"?"Aprovado":t.status==="REJECT"?"Recusado":"Pendente"})]},s))]}):e.jsx("h2",{className:"text-zinc-500",children:"Você ainda não efetuou nenhum pagamento"})})]})}function Xa({plan_management:a}){return a&&a.status!=="DISABLED"?e.jsx("span",{className:"font-bold text-yellow-600 uppercase",children:a.plan.plan_name}):e.jsx("span",{className:"text-zinc-400/60",children:"Sem plano"})}function de(a){const o=(new Date(a)-new Date)/(1e3*60*60*24);return Number(o.toFixed(0))}function Ya({plan_management:a}){const t=()=>a?de(a.free_trial):0;return a&&a.status!=="DISABLED"&&e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsxs("span",{children:["Status:",e.jsx("span",{"data-status":a.status,className:"px-1 rounded-md mx-2 bg-red-200 text-red-700 data-[status='ACTIVE']:bg-green-200 data-[status='ACTIVE']:text-green-700",children:a.status==="ACTIVE"?"Ativo":"Desativado"})]}),e.jsxs("span",{children:["Chats: ",a.project.length," / ",Number(a.plan.max_projects.default)]}),e.jsxs("span",{children:["Fonte de dados: ",a.prompt.length," / ",Number(a.plan.max_databases.default)]}),e.jsxs("span",{children:["Análise de métrica diária:  ",Number(a.plan.max_analyze_metric.default)," "]}),e.jsxs("span",{children:["Limite de messages: ",ha(a).totalMessages," / ",Number(a.plan.max_messages.default)," "]}),e.jsxs("span",{"data-free":Number(a.plan.monthly_price)<=0,className:"data-[free=true]:hidden",children:["Reembolso garantido: ",t()>0?t()+" dias restantes":"expirado"]})]})}function Za({client:a}){const t=H(),s=()=>{t("/plans")};return(a!=null&&a.refund_requested.length&&a.refund_requested[0].status!=="PENDING",!0)&&e.jsx("div",{className:"w-full flex flex-col my-4 justify-center items-center",children:e.jsx(v,{onClick:s,children:((a==null?void 0:a.plan_management)&&a.plan_management.status)!=="DISABLED"?Number(a==null?void 0:a.plan_management.plan.monthly_price)>0?"Mudar de plano":"Contratar plano":"Adicionar plano"})})}async function et(a){return await O.post(`${R}/refund_requested`,a).catch(s=>console.log(s))}async function at(a){return await O.post(`${R}/refund_requested/reactive`,{client_id:a}).catch(s=>console.log(s))}function tt({client:a}){const{setModalContent:t}=h.useContext(b),s=()=>a!=null&&a.plan_management&&Number(a.plan_management.plan.monthly_price)>0?de(a==null?void 0:a.plan_management.free_trial):0,n=async()=>{if(a){const u=prompt("Digite o motivo do seu cancelamento:"),l=prompt("Digite de 0 a 5, o quanto você gostou do nosso sistema"),c={client_id:a.id,reason:u||"",product_review:Number(l||0)};await et(c)?(t({componentName:"modal_request_success",components:e.jsx(_,{message:"Solicitação de reembolso foi enviada com sucesso!",componentName:"modal_request_success"})}),setTimeout(()=>window.location.reload(),1e3)):t({componentName:"modal_error_request",components:e.jsx(_,{message:"Ocorreu um erro ao enviar sua solicitação de reembolso, por favor entre em contato com nosso suporte.",componentName:"modal_error_request"})})}else t({componentName:"modal_error_client",components:e.jsx(_,{message:"Erro ao processar o cliente, por favor recarregue a página.",componentName:"modal_error_client"})})},o=()=>{if(a!=null&&a.plan_management&&Number(a.plan_management.plan.monthly_price)>0)return a!=null&&a.refund_requested.length&&a.plan_management.status==="ACTIVE"&&s()>0?a.refund_requested[0].status!=="PENDING":s()>0&&a.plan_management.status!=="DISABLED"},i=()=>{a?window.open(`https://dash.ticto.com.br/subscription-verification?code=${a==null?void 0:a.ticto_order_code}&email=${a==null?void 0:a.purchase_email}`):t({componentName:"modal_failed_cancel",components:e.jsx(_,{message:"Falha ao preencher os dados de cancelamento, por favor entre em contato com o suporte.",componentName:"modal_failed_cancel"})})},r=()=>{if(a!=null&&a.plan_management&&Number(a.plan_management.plan.monthly_price)>0&&a.plan_management.status==="ACTIVE"&&s()<=0)return!!(a.refund_requested.length&&a.refund_requested[0].status!=="PENDING")};return o()?e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("a",{onClick:n,className:"text-center underline cursor-pointer",children:"Pedir reembolso"})}):r()&&e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("a",{onClick:i,className:"text-center underline cursor-pointer",children:"Gerenciar assinatura"})})}function st({client:a}){return e.jsxs("div",{className:"w-1/2 min-w-[300px] max-w-[400px] border border-zinc-600 p-2 rounded-md z-50",children:[e.jsx("h2",{className:"w-full text-center",children:"Plano atual:"}),e.jsx("div",{className:"w-full flex justify-center",children:e.jsx(Xa,{plan_management:a==null?void 0:a.plan_management})}),e.jsx("div",{className:"w-full flex justify-center my-4",children:e.jsx(Ya,{plan_management:a==null?void 0:a.plan_management})}),e.jsx(Za,{client:a}),e.jsx(tt,{client:a})]})}function nt({client:a}){const{setModalContent:t}=h.useContext(b),s=async()=>{a&&await at(a.id)&&(t({componentName:"modal_reactive_plan",components:e.jsx(_,{message:"Plano reativado com  sucesso!",componentName:"modal_reactive_plan"})}),setTimeout(()=>window.location.reload(),1500))};return!!(a!=null&&a.refund_requested.length)&&a.refund_requested[0].status!=="CANCEL"&&e.jsxs("div",{className:"w-1/2 min-w-[150px] max-w-[400px] border border-zinc-600 p-2 rounded-md",children:[e.jsx("h2",{className:"w-full text-center pb-4 text-xl",children:"Reembolso solicitado:"}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Reembolso solicidado em:",e.jsx("p",{children:a.refund_requested[0].created_at.substring(0,10)})]}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Plano:",e.jsx("p",{children:a.plan_management.plan.plan_name})]}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Status:",a.refund_requested[0].status==="PENDING"?e.jsx("p",{className:"text-red-600",children:"Pendente"}):a.refund_requested[0].status==="APPROVED"?e.jsx("p",{className:"text-green-600",children:"Dinheiro devolvido"}):e.jsx("p",{className:"text-zinc-200",children:"Reembolso cancelado"})]}),e.jsx("div",{className:"w-full flex justify-center mt-6",children:a.refund_requested[0].status==="PENDING"&&e.jsx(v,{onClick:s,children:"Cancelar reembolso"})})]})}function ot(){const{client:a}=h.useContext(w);return e.jsxs(q,{title:"Assinatura",className:"flex-col",children:[e.jsxs("div",{className:"w-full flex justify-center",children:[e.jsx(st,{client:a}),e.jsx(nt,{client:a})]}),e.jsx(Ka,{plan_management:a==null?void 0:a.plan_management})]})}function X({name:a}){const{register:t}=W(),[s,n]=h.useState(!1),o=()=>n(i=>!i);return e.jsxs("div",{className:"w-3/5 px-2 rounded-md flex justify-center items-center gap-2 bg-gray_light",children:[e.jsx("input",{className:"",type:s?"text":"password",...t(a)}),e.jsx(ca,{"data-isopen":!!s,className:"text-2xl data-[isopen=false]:hidden",onClick:o}),e.jsx(da,{"data-isopen":!!s,className:"text-2xl data-[isopen=true]:hidden",onClick:o})]})}function rt(){const{setValue:a}=W(),t=J(),{handleSubmit:s}=t,{client:n}=h.useContext(w),{setModalContent:o,clearModal:i}=h.useContext(b),r=async u=>{if(!n)throw new Error("Client not founded.");if(u.new_password.length<8||u.current_password.length<8){const m=!u.new_password.length||!u.current_password.length?"Preencha todos os dados":"Informe uma senha com mais de 8 caracteres";o({componentName:"modal_error_fill_data",components:e.jsx(_,{message:m,componentName:"modal_error_fill_data",type:"WARNING"})});return}if(u.new_password!==u.confirm_password){o({componentName:"modal_error_new_password",components:e.jsx(_,{message:"Sua confirmação de senha não é idêntica a sua nova senha!",componentName:"modal_error_new_password",type:"ERROR"})});return}u.client_id=n.id;const l=await ma(u);l||o({componentName:"modal_error_password",components:e.jsx(_,{message:"A sua atual senha está incorreta!",componentName:"modal_error_password",type:"ERROR"})}),(l==null?void 0:l.status)===200&&(a("password",u.new_password),o({componentName:"modal_change_password_success",components:e.jsx(_,{message:"Senha atualizada com sucesso!",componentName:"modal_change_password_success",functionAfterComplete:()=>i(null,{clearLast:!0})})}))};return e.jsx(Y,{...t,children:e.jsxs("form",{className:"flex min-w-[200px] flex-col gap-8",onSubmit:s(r),children:[e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Sua senha atual:"}),e.jsx(X,{name:"current_password"})]}),e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Nova senha:"}),e.jsx(X,{name:"new_password"})]}),e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Confirme sua senha:"}),e.jsx(X,{name:"confirm_password"})]}),e.jsxs(v,{customClass:"flex items-center gap-2",children:[e.jsx(re,{})," Salvar"]})]})})}const lt=U.object({fullname:U.string().min(1,"Digite seu nome completo!").refine(a=>{const t=a.split(" ");return!!(t.length>=2&&t[1])},"Vocẽ precisa informar seu nome completo"),user:U.string().min(1,"Digite um nome de usuário!").max(25,"Nome de usuário muito longe, informe um menor."),email:U.string().email(),password:U.string().min(8,"Sua senha precisa ter no minimo 8 caracteres!")});function it(){const{setModalContent:a}=h.useContext(b),{client:t,setClient:s}=h.useContext(w),n=J({resolver:ua(lt),defaultValues:{fullname:t==null?void 0:t.fullname,user:t==null?void 0:t.user,email:t==null?void 0:t.email,password:"senha-qualquer"}}),{handleSubmit:o,formState:{errors:i}}=n;h.useEffect(()=>{const m=r(i);m&&a({componentName:"modal_error_message",components:e.jsx(_,{message:m,type:"WARNING",componentName:"modal_error_message"})})},[i]);const r=m=>{if(typeof m=="object"&&pa!==null)for(let d in m){if(d==="message")return m[d];{const p=r(m[d]);if(p!==void 0)return p}}},u=async m=>{if((t==null?void 0:t.user)===m.user||await xa(m.user)){m.client_id=t==null?void 0:t.id;const d=await fa(m);(d==null?void 0:d.status)===200&&(s(d.data),a({componentName:"modal_user_success",components:e.jsx(_,{componentName:"modal_user_success",message:"Perfil atualizado com sucesso"})}))}else a({componentName:"modal_error_user",components:e.jsx(_,{componentName:"modal_error_user",message:"Usuário informado não está disponível!",type:"WARNING"})})},l=()=>{a({componentName:"modal_show_password",components:e.jsx(T,{children:e.jsx(Y,{...n,children:e.jsx(rt,{})})})})},c=()=>{a({componentName:"modal_show_email",components:e.jsx(_,{componentName:"modal_show_email",message:"Ainda não é possível atualizar o e-mail, para mais informações entre em contato com o suporte.",type:"WARNING"})})};return e.jsx(q,{title:"Configurações",children:e.jsx(Y,{...n,children:e.jsxs("form",{onSubmit:o(u),className:"w-2/3 mx-auto p-4 px-8 flex flex-col gap-6",children:[e.jsxs(x.Container,{className:"flex items-center gap-4",children:[e.jsx(x.Input,{name:"fullname",title:"Nome completo"}),e.jsx(x.Input,{name:"user",title:"Usuário"})]}),e.jsxs(x.Container,{className:"flex gap-4 justify-center items-center",children:[e.jsx(x.Container,{children:e.jsx(x.Input,{type:"email",name:"email",title:"Informe seu e-mail",disabled:!0})}),e.jsxs(v,{type:"button",customClass:"min-w-[200px] flex justify-center items-center gap-2",onClick:c,children:["Alterar e-mail",e.jsx($,{})]})]}),e.jsxs(x.Container,{className:"flex gap-4 justify-center items-center",children:[e.jsx(x.Container,{children:e.jsx(x.Input,{type:"password",name:"password",title:"Sua senha",disabled:!0})}),e.jsxs(v,{type:"button",customClass:"min-w-[200px] flex justify-center items-center gap-2",onClick:l,children:["Alterar senha",e.jsx($,{})]})]}),e.jsxs(v,{customClass:"flex gap-2 mt-8",children:["Salvar ",e.jsx(re,{})]})]})})})}function ct(){const[a]=z(),t=Number(a.get("tab"))||0;return e.jsx("div",{className:"w-full px-8",children:t===0?e.jsx(Ma,{}):t===1?e.jsx(Ba,{}):t===2?e.jsx(Ha,{}):t===3?e.jsx(Qa,{}):t===4?e.jsx(ot,{}):e.jsx(it,{})})}function ut(){return e.jsxs("div",{className:"w-[90%] h-full flex-grow flex flex-col items-center bg-gradient-to-br from-primary-100 from-[10%] to-light to-[20%] dark:to-dark",children:[e.jsx(ba,{}),e.jsx(ct,{})]})}export{ut as default};
