import{r as f,M as v,j as e,T as M,F as ue,b as pe,c as xe,C as k,u as V,d as fe,P as N,B as C,e as H,t as he,f as ae,g as _e,i as ge,n as je,h as Ne,k as U,l as be,m as we,o as ve,p as $,q as J,R as n,s as Z,v as q,w as L,x as te,y as Q,z as ye,A as Ce,D as Se,E as Ae,G as ke,H as Ee,J as Ie,K as Te,L as De,N as Me,O as Pe,Q as Re,S as ne,U as Oe,V as Fe,W as Le,X as $e,Y as Ue,Z as qe,$ as ze,a0 as Be,a1 as Ge,a2 as Ve,a3 as He,a4 as Je,a5 as Qe,a6 as We,a7 as Ke,a8 as Xe,a9 as Ye,aa as Ze,ab as ea,ac as aa,ad as ta,ae as oe,af as re,ag as sa,ah as na,ai as Y,aj as le,ak as oa,al as ra,am as la}from"./index-g_3ga1-h.js";import{m as ca}from"./messagesEventManager-Ambd-xXe.js";function O({children:a}){const{clearModal:t}=f.useContext(v),s=({target:o})=>{o.dataset.close&&t(null,{clearLast:!0})};return e.jsx("div",{className:"w-full h-full flex justify-center items-center","data-close":!0,onClick:s,children:e.jsx("div",{className:"p-4 bg-primary-100 text-light dark:bg-primary-300 border border-primary-100 rounded-md",children:a})})}function ia(){f.useEffect(()=>{const t=localStorage.theme==="dark";document.documentElement.classList.toggle("dark",t)},[]);const a=()=>{const t=localStorage.theme==="dark";document.documentElement.classList.toggle("dark",!t);const s=t?"light":"dark";localStorage.theme=s};return e.jsxs("div",{className:"flex gap-3 px-8",children:[e.jsx(M,{tip:"Notificações",position:"BOTTOM",children:e.jsx("div",{className:"bg-primary-100 rounded-full p-1",children:e.jsx(ue,{className:"text-2xl fill-light cursor-pointer"})})}),e.jsx(M,{tip:"Escolha entre thema light ou dark",position:"BOTTOM",children:e.jsxs("div",{className:"bg-primary-100 rounded-full p-1",onClick:a,children:[e.jsx(pe,{className:"text-2xl fill-light cursor-pointer hidden dark:block"}),e.jsx(xe,{className:"text-2xl fill-light cursor-pointer block dark:hidden"})]})})]})}function da(){return e.jsx("header",{className:"w-full h-[8%] px-20 min-h-[70px] col-span-8 row-span-1 flex justify-end items-center",children:e.jsx(ia,{})})}function ma({plan_management_id:a}){const{client:t}=f.useContext(k),{setModalContent:s,clearModal:o}=f.useContext(v),i=V(),r=()=>{if(t!=null&&t.plan_management)if(t!=null&&t.plan_management.prompt.length){const c=t.plan_management.plan.max_projects,d=t.plan_management.project.length;t.plan_management.status!=="DISABLED"?c>d?i(`/create-chat/${a}`):s({componentName:"modal_reached_max_plan",components:e.jsx(N,{message:"Você atingiu o número maximo de chats por plano.",componentName:"modal_reached_max_plan"})}):s({componentName:"modal_plan_is_desabled",components:e.jsx(N,{message:"O plano da sua conta está desabilitado.",componentName:"modal_plan_is_desabled",functionAfterComplete:()=>i("/panel?tab=4")})})}else s({componentName:"modal_create_database",components:e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("h2",{className:"text-xl text-center",children:["Para criar um novo chat, antes é necessário ",e.jsx("br",{}),"  criar uma fonte de dados."]}),e.jsxs("h2",{className:"text-lg text-center opacity-80",children:["Nossa inteligência artifical vai analisar seus dados e ",e.jsx("br",{})," responder as dúvidas do usuário ",e.jsx("br",{}),"conforme as informações passadas na fonte de dados."]}),e.jsxs(C,{customClass:"my-4",onClick:()=>{i("/panel?tab=2"),o("modal_create_database")},children:[e.jsx(H,{}),"Criar fonte de dados"]})]})})});else s({componentName:"modal_without_plan",components:e.jsx(N,{message:"Nenhum plano foi vinculado a sua conta",componentName:"modal_without_plan",functionAfterComplete:()=>i("/panel?tab=4")})})};return e.jsx(M,{tip:"Crie um novo chat",children:e.jsx("div",{onClick:r,className:"border border-primary-100 rounded-full cursor-pointer",children:e.jsx(fe,{className:"text-4xl text-primary-100"})})})}function F({children:a,title:t,className:s}){return e.jsxs("div",{className:he("w-full h-full overflow-hidden flex flex-col gap-4 justify-center items-start bg-light dark:bg-dark rounded-xl border border-primary-300 relative",s),children:[e.jsx("h2",{className:"w-full text-dark dark:text-light text-2xl font-semibold uppercase p-4 px-8",children:t}),a]})}function ua({slug:a}){const{setModalContent:t}=f.useContext(v),s=f.useRef(null),o=f.useRef(null),i=()=>{window.open(`https://chat.wipzee.com/${a}`)},r=()=>{try{const l=s.current;if(l){l.classList.toggle("disabled"),l.disabled=!1,l.select();var d=document.execCommand("copy");d&&t({componentName:"modal_copy_link",components:e.jsx(N,{message:"Link Copiado!",type:"INFORMATION",componentName:"modal_copy_link"})}),l.classList.toggle("disabled"),l.disabled=!0}}catch{t({componentName:"modal_failed_copy_link",components:e.jsx(N,{message:"Falha ao copiar o link!",type:"ERROR",componentName:"modal_failed_copy_link"})})}},c=()=>{try{const l=o.current;if(l){l.classList.toggle("disabled"),l.disabled=!1,l.select();var d=document.execCommand("copy");d&&t({componentName:"modal_copy_widget",components:e.jsx(N,{message:"Widget Copiado!",type:"INFORMATION",componentName:"modal_copy_widget"})}),l.classList.toggle("disabled"),l.disabled=!0}}catch{t({componentName:"modal_failed_copy_widget",components:e.jsx(N,{message:"Falha ao copiar o link!",type:"ERROR",componentName:"modal_failed_copy_widget"})})}};return e.jsxs("div",{className:"w-full flex flex-col gap-8",children:[e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx("h2",{className:"w-4/5 text-center uppercase",children:"Link do seu chat"}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("input",{ref:s,className:"w-4/5 border border-light/20 p-2 rounded-xl disabled",disabled:!0,defaultValue:`https://chat.wipzee.com/${a}`}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx(ae,{onClick:r,className:" text-2xl cursor-pointer"}),e.jsx(_e,{onClick:i,className:" text-xl cursor-pointer"})]})]}),e.jsx("span",{className:"w-4/5 text-center opacity-60",children:"Esse será o link que você enviará aos usuários que irão acessar seu chat."})]}),e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsx("h2",{className:"w-4/5 text-center uppercase",children:"Código do Widget"}),e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("input",{ref:o,className:"w-4/5 border border-light/20 p-2 rounded-xl disabled",disabled:!0,defaultValue:`<script src="https://widget.wipzee.com/${a}" defer><\/script>`}),e.jsx("div",{className:"w-1/5 flex justify-center items-center gap-4",children:e.jsx(ae,{onClick:c,className:" text-2xl cursor-pointer"})})]}),e.jsx("span",{className:"w-4/5 text-center opacity-60",children:"Copie e cole esse código no head do html do seu site."})]})]})}const pa=a=>a.errors!=null,xa=(a,t)=>{const s={};for(;a.length;){const o=a[0],{code:i,message:r,path:c}=o,d=c.join(".");if(!s[d])if("unionErrors"in o){const l=o.unionErrors[0].errors[0];s[d]={message:l.message,type:l.code}}else s[d]={message:r,type:i};if("unionErrors"in o&&o.unionErrors.forEach(l=>l.errors.forEach(m=>a.push(m))),t){const l=s[d].types,m=l&&l[o.code];s[d]=Ne(d,t,s,i,m?[].concat(m,o.message):o.message)}a.shift()}return s},ce=(a,t,s={})=>async(o,i,r)=>{try{const c=await a[s.mode==="sync"?"parse":"parseAsync"](o,t);return r.shouldUseNativeValidation&&ge({},r),{errors:{},values:s.raw?o:c}}catch(c){if(pa(c))return{values:{},errors:je(xa(c.errors,!r.shouldUseNativeValidation&&r.criteriaMode==="all"),r)};throw c}};function fa(){const{watch:a}=U(),[t,s]=f.useState();return f.useEffect(()=>{const o=a("step_4.slug");s(o.replaceAll(" ","-"))},[a()]),e.jsxs("div",{className:"w-full flex gap-2 items-center bg-white p-2 my-4 rounded-md",children:[e.jsx(be,{className:"fill-zinc-600"}),e.jsx(we,{className:"fill-zinc-600"}),e.jsx(ve,{className:"fill-zinc-600"}),e.jsxs("div",{className:"w-full bg-zinc-600 rounded-xl p-3 flex gap-2 items-center",children:[e.jsx($,{className:"fill-green-600"}),e.jsxs("h2",{className:"opacity-80",children:["https://chat.wipzee.com/",t]})]})]})}function ha(){const{control:a}=U(),{fields:t,remove:s,append:o}=J({control:a,name:"step_0.social_proof"});return e.jsxs(n.Container,{className:"overflow-auto h-[400px]",children:[e.jsxs(n.Container,{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione avaliações dos seus clientes:"}),e.jsx("span",{className:"text-sm opacity-70",children:"(Essas avaliações estarão visível na bio do chat)"})]}),e.jsxs(C,{type:"button",onClick:()=>o({}),children:["Adicionar ",e.jsx(H,{})]})]}),e.jsx(n.Container,{className:"px-4 overflow-auto h-[300px] my-2",children:t.map((i,r)=>e.jsxs(n.Container,{className:"w-full flex flex-col gap-4 my-2 p-2 rounded-lg border border-primary-100 relative",children:[e.jsx(Z,{className:"absolute -top-3 -right-3 bg-red-800/50 fill-red-500 cursor-pointer rounded-full p-1 text-2xl",onClick:()=>s(r)}),e.jsxs(n.Container,{className:"w-full flex justify-start items-center gap-4",children:[e.jsx(n.File,{name:`step_0.social_proof.${r}.avatar`,sizeContainer:"50px"}),e.jsx(n.Input,{title:"Nome do cliente",name:`step_0.social_proof.${r}.person_name`}),e.jsx(n.Input,{type:"number",title:"Nota da avaliação",name:`step_0.social_proof.${r}.rating`,min:0,max:5})]}),e.jsx(n.TextArea,{name:`step_0.social_proof.${r}.text`,title:"Oque o cliente achou do produto?"}),e.jsxs(n.Container,{className:"flex gap-4 justify-start",children:[e.jsx(n.File,{name:`step_0.social_proof.${r}.images.0`,sizeContainer:"50px"}),e.jsx(n.File,{name:`step_0.social_proof.${r}.images.1`,sizeContainer:"50px"}),e.jsx(n.File,{name:`step_0.social_proof.${r}.images.2`,sizeContainer:"50px"})]})]},i.id))})]})}function _a({project:a,setProjects:t}){const{setModalContent:s,clearModal:o}=f.useContext(v),{setClient:i,client:r}=f.useContext(k),[c,d]=f.useState(),[l,m]=q(),g=Number(l.get(L)),h=Number(l.get(te))||0,p=Q({resolver:ce(ye),defaultValues:{step_0:{project_name:a.project_name,logo:a.logo,bio:a.bio,social_proof:a.social_proof},step_1:{prompt_id:a.prompt.id,chat_input_message:a.chat_input_message,call_to_action:a.call_to_action},step_2:{facebook_pixel:a.pixel_facebook},step_3:{chat_appearence:{chat_icon:a.chat_appearence.chat_icon,icon_text:a.chat_appearence.icon_text,primary_color:a.chat_appearence.primary_color,second_color:a.chat_appearence.second_color,background:a.chat_appearence.background}},step_4:{slug:a.slug}}}),{fields:x,append:u,remove:b,update:w}=J({control:p.control,name:"step_1.call_to_action"});f.useEffect(()=>{(async()=>{l.set(L,(a.call_to_action.length-1).toString()),m(l);const j=await Ce(a.plan_management_id);(j==null?void 0:j.status)===200&&d(j.data.prompt)})()},[]);const S=async j=>{var D,R;let _={};if(Object.keys(j).forEach(I=>{const B=j[I];Object.keys(B).forEach(G=>{_[G]=j[I][G]})}),_&&a.slug){if((D=j.step_4)!=null&&D.slug&&((R=j.step_4)==null?void 0:R.slug)!==a.slug&&!await ke(j.step_4.slug)){s({componentName:"modal_error_slug",components:e.jsx(N,{componentName:"modal_error_slug",message:"A slug escolhida não está disponível!",type:"WARNING"})});return}_.chat_appearence.can_update=a.chat_appearence.can_update,_.chat_appearence.id=a.chat_appearence.id;const I=await Ee(_,a.slug);I&&I.status===200&&(t(B=>{const G=B.findIndex(W=>W.id===a.id),ee=B.filter(W=>W.id!==a.id);return _.is_online=I.data.is_online,_.plan_management_id=I.data.plan_management_id,_.id=I.data.id,_.prompt=I.data.prompt,_.chat_appearence=I.data.chat_appearence,ee.splice(G,0,_),ee}),s({componentName:"modal_chat_updated",components:e.jsx(N,{message:"Chat atualizado com sucesso",componentName:"modal_chat_updated",functionAfterComplete:()=>o("modal_edit_project")})}))}};async function A(){if(a.id){const j=await Ie(a.id);if(j&&j.status===200){t(D=>D.filter(R=>R.id!==a.id));const _=r==null?void 0:r.plan_management.project.findIndex(D=>D.id===a.id);r&&_&&(r.plan_management.project.splice(_,1),i(r)),s({componentName:"modal_delete_success",components:e.jsx(N,{message:"Chat excluido com sucesso!",componentName:"modal_delete_success",functionAfterComplete:()=>o(null,{clearAll:!0})})})}}}const T=j=>{const _=p.watch(`step_1.call_to_action.${g}`);x.find(R=>R.button_text===(_==null?void 0:_.button_text)&&R.button_link===_.button_link)||(!x[g].button_text&&_?w(g,{button_text:_.button_text,button_link:_.button_link,button_describe:_.button_describe}):b(x.length-1)),l.set(L,j.toString()),m(l)},y=()=>{var j;if(x.length===0||(j=x[x.length-1])!=null&&j.button_text)if(x.length<3){u({button_describe:"",button_link:"",button_text:""});const _=g+1;l.set(L,_.toString()),m(l)}else s({componentName:"modal_limit_cta",components:e.jsx(N,{message:"Você pode ter no maximo 3 CTA por chat.",componentName:"modal_limit_cta",type:"WARNING"})});else s({componentName:"modal_empty_cta",components:e.jsx(N,{message:"Você precisa preencher o ultimo link, antes de adicionar mais",componentName:"modal_empty_cta"})})},E=j=>{l.set(te,j.toString()),m(l),p.unregister("step_3.chat_appearence.chat_icon"),p.register("step_3.chat_appearence.chat_icon",{value:j})};return!!(c!=null&&c.length)&&e.jsx("div",{className:"w-[90vw] h-[80vh] min-h-[450px] min-w-[700px] flex overflow-hidden",children:e.jsxs(n.EditForm,{form:p,onDelete:A,onSubmit:S,activeSimulator:!0,children:[e.jsxs(n.EditStep,{index:0,titleStep:"Informações do chat",children:[e.jsxs(n.Container,{className:"flex justify-start items-center gap-6",children:[e.jsx(n.File,{name:"step_0.logo",sizeContainer:"80px"}),e.jsx(n.Input,{name:"step_0.project_name",title:"Escreva o nome do seu chat"})]}),e.jsx(n.TextArea,{name:"step_0.bio",title:"Escreva uma descrição para seu chat"}),e.jsx(ha,{})]}),e.jsxs(n.EditStep,{index:1,titleStep:"Configurações do chat",children:[e.jsx(n.Select,{name:"step_1.prompt_id",options:c.map(j=>Object({value:j.id,text:j.prompt_name})),title:"Selecione sua fonte de dados"}),e.jsx(n.TextArea,{name:"step_1.chat_input_message.0",title:"Digite a primeira mensagem do seu chat"}),e.jsxs("div",{className:"flex flex-col ",children:[e.jsxs("div",{className:"flex justify-between py-4",children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione chamadas para ação no seu chat"}),e.jsx("span",{className:"text-sm opacity-70",children:"(Essas CTA serão usadas no contexto da conversa)"})]}),e.jsxs(C,{type:"button",customClass:"bg-primary-200",onClick:y,children:[e.jsx(H,{}),"  Adicionar link"]})]}),e.jsx("div",{className:"flex justify-center gap-4 border-b border-primary-100/50",children:x.map((j,_)=>_!==g&&!!j.button_text&&e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"w-full flex gap-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer bg-primary-100 px-3 rounded-lg",onClick:()=>T(_),children:[j.button_text,e.jsx(Se,{className:"text-xl"})]})})},j.id))}),e.jsx("div",{className:"flex justify-center p-4",children:x.map((j,_)=>_===g&&e.jsxs(n.Container,{className:"flex gap-4",children:[e.jsxs(n.Container,{className:"flex flex-col gap-8",children:[e.jsxs(n.Container,{className:"flex gap-4",children:[e.jsx(n.Input,{name:`step_1.call_to_action.${_}.button_text`,title:"Digite o texto do link"}),e.jsx(n.Input,{name:`step_1.call_to_action.${_}.button_link`,title:"Digite a url do link"})]}),e.jsx(n.TextArea,{name:`step_1.call_to_action.${_}.button_describe`,title:"Digite a descrição do link"})]}),e.jsx(Z,{className:"text-2xl fill-red-500 bg-red-900/50 rounded-full mt-4 cursor-pointer",onClick:()=>{b(_),l.set(L,(_-1).toString()),m(l)}})]},j.id))})]})]}),e.jsx(n.EditStep,{index:2,titleStep:"Eventos e rastreamentos",children:e.jsx(n.Input,{name:"step_2.facebook_pixel",title:"Adicione o pixel do seu facebook"})}),e.jsx(n.EditStep,{index:3,titleStep:"Aparência do chat",children:e.jsxs(n.Container,{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"flex flex-col justify-center gap-4",children:[e.jsx("h2",{className:"text-center text-xl",children:"Escolha um icone para seu chat"}),e.jsx("div",{className:"flex justify-center gap-8 text-5xl",children:Ae.map(({Icon:j,id:_},D)=>e.jsx(j,{"data-iscurrent":h===D,className:"hover:bg-primary-100 data-[iscurrent=true]:bg-primary-100 cursor-pointer rounded-full p-2",onClick:()=>E(_)},_))})]}),e.jsx(n.Input,{name:"step_3.chat_appearence.icon_text",title:"Digite o texto que será exibido ao lado do icon"}),e.jsxs(n.Container,{className:"flex",children:[e.jsx(n.Color,{name:"step_3.chat_appearence.primary_color",title:"Escolha a cor primária do seu chat"}),e.jsx(n.Color,{name:"step_3.chat_appearence.second_color",title:"Escolha a cor secundária do seu chat"})]}),e.jsx(n.Color,{name:"step_3.chat_appearence.background",title:"Escolha a cor do background do seu chat"})]})}),e.jsx(n.EditStep,{index:4,titleStep:"Configuração avançadas",children:e.jsxs(n.Container,{className:"flex flex-col",children:[e.jsx(n.Input,{name:"step_4.slug",title:"Altere a slug do seu chat"}),e.jsx(fa,{}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium uppercase",children:"Lembre-se"}),e.jsx("span",{className:"opacity-70",children:"Ao trocar a slug do seu chat, todos seus clientes que possuirem a URL antiga, podem perder acesso ao seu site utilizando a antiga URL."})]})]})})]})})}function ga({project:a,setNewProject:t,prompts:s}){const{setModalContent:o}=f.useContext(v),i=V(),r=()=>{o({componentName:"modal_edit_project",components:e.jsx(O,{children:e.jsx(_a,{setProjects:t,project:a,prompts:s})})})},c=async(m,g)=>{if(!g)return o({componentName:"modal_failed_updated_status_chat",components:e.jsx(N,{message:"Falha ao atualizar o status do chat, reinicie a página e tente novamente",componentName:"modal_failed_updated_status_chat",type:"WARNING"})}),!1;const h=await Pe(m,g);return(h==null?void 0:h.status)===200?(t(p=>(p.find(x=>x.id===h.data.id).is_online=h.data.is_online,p)),!0):(o({componentName:"modal_failed_updated_status_chat_02",components:e.jsx(N,{message:"Falha ao atualizar o status do chat, reinicie a página e tente novamente",componentName:"modal_failed_updated_status_chat_02",type:"WARNING"})}),!1)},d=()=>{if(!a.slug){o({componentName:"modal_failed_display_link",components:e.jsx(N,{message:"Falha ao exibir seus links",type:"ERROR",componentName:"modal_failed_display_link"})});return}o({componentName:"modal_display_share_project",components:e.jsx(O,{children:e.jsx(ua,{slug:a.slug})})})},l=({target:m})=>{m.dataset.metric&&i("/panel?tab=1")};return a&&e.jsxs("div",{className:"w-1/4 min-w-[200px] bg-gray  relative flex flex-col items-center gap-2 cursor-pointer rounded-xl",onClick:l,"data-metric":!0,children:[e.jsxs("div",{className:"w-full flex justify-between items-center gap-2 p-2",children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(M,{tip:"Veja todos os seus links",children:e.jsx(Te,{className:" text-xl",onClick:d})}),e.jsx(M,{tip:"Edite seu chat",children:e.jsx(De,{className:"text-xl",onClick:r})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(M,{tip:"Ative ou desative seu chat",children:e.jsx(Me,{isActive:a.is_online,template:"onOff",cb:m=>c(m,a.slug)})})})]}),e.jsx("div",{className:"w-[150px] h-[110px] rounded-xl overflow-hidden","data-metric":!0,children:e.jsx("img",{src:a.logo||"https://via.placeholder.com/100",alt:"imagem do projeto",className:"w-full h-full object-cover"})}),e.jsx("h2",{className:"text-center py-4 font-bold text-lg","data-metric":!0,children:a.project_name})]},a.slug)}function ja(){var o;const{client:a}=f.useContext(k),[t,s]=f.useState(a!=null&&a.plan_management?a.plan_management.project:[]);return a&&e.jsx(F,{title:"Meus chats",children:e.jsxs("div",{className:"w-4/5 px-8 pb-6 flex flex-col gap-8",children:[e.jsx("div",{className:"w-full flex justify-end items-center",children:e.jsx(ma,{plan_management_id:(o=a==null?void 0:a.plan_management)==null?void 0:o.id})}),t.length?e.jsx("div",{className:"w-full flex flex-col gap-4",children:e.jsx("div",{className:"w-full flex items-center gap-4",children:t.map(i=>{var r;return e.jsx(ga,{project:i,setNewProject:s,prompts:(r=a.plan_management)==null?void 0:r.prompt},i.id)})})}):e.jsx("h2",{className:"py-8 font-bold",children:'Você ainda não possui nenhum chat, clique em "Novo chat" para começar seu primeiro projeto.'})]})})}function Na({setColumns:a,columns:t,modalName:s}){const{clearModal:o}=f.useContext(v),[i,r]=f.useState(t),c=l=>{const m=l.currentTarget.dataset.status=="true",g=l.currentTarget.dataset.name;r(()=>[...t.filter((h,p)=>(p>1&&h.columnName===g&&(h.status=!m),h))])},d=()=>{localStorage.setItem("metricColumnActive",JSON.stringify(t)),a(t),o(s)};return e.jsxs("div",{className:"w-1/2 max-w-[400px] bg-zinc-800 text-light",children:[e.jsx("h2",{className:"w-full text-center text-xl p-4",children:"Organize suas columns"}),e.jsx("div",{className:"w-full flex gap-2 flex-col",children:i.map((l,m)=>e.jsxs("div",{className:"w-full flex justify-between px-4",children:[e.jsx("p",{children:l.columnName}),e.jsx("div",{className:"w-[30px] h-[20px] bg-zinc-100 flex overflow-hidden rounded-full cursor-pointer",style:{justifyContent:`${l.status?"end":"start"}`},onClick:c,"data-status":l.status,"data-name":l.columnName,children:e.jsx("div",{className:"w-2/3 h-full rounded-xl flex justify-center items-center",style:{background:`${l.status?"green":"red"}`},children:m<2&&e.jsx($,{className:"w-[8px]"})})})]},l.columnName))}),e.jsx("div",{className:"w-full flex mt-12 justify-center",children:e.jsx(C,{onClick:d,children:"Salvar"})})]})}const ba=[{short:"Jan",complete:"Janeiro"},{short:"Fev",complete:"Fevereiro"},{short:"Mar",complete:"Março"},{short:"Abr",complete:"Abril"},{short:"Mai",complete:"Maio"},{short:"Jun",complete:"Junho"},{short:"Jul",complete:"Julho"},{short:"Ago",complete:"Agosto"},{short:"Set",complete:"Setembro"},{short:"Out",complete:"Outubro"},{short:"Nov",complete:"Novembro"},{short:"Dez",complete:"Dezembro"}];function z(a){const t=new Date(a);t.toLocaleTimeString("pt-BR",{hour12:!1});const s=t.getTimezoneOffset(),o=t.getMonth(),i=t.getUTCHours()-s/60,r=t.toLocaleDateString(),c=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`,d=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`,l=`${t.getDay()} de ${ba[o].short} - ${d}`;return{currentHour:i,fullDate:r,fullHour:c,shortHour:d,dateFormat_A:l,fullDateWithHour:`${r} - ${c}`}}function ie({options:a,alternativeTitle:t,title:s,Icon:o,defaultValue:i,handleSelectDatabase:r}){return e.jsxs("div",{className:"w-full px-2 h-full bg-gray border border-primary-100 font-bold rounded-lg flex gap-2 justify-center items-center",children:[o&&e.jsx(o,{className:"text-2xl"}),e.jsxs("select",{className:"h-full bg-gray cursor-pointer outline-none ",disabled:!a.length,onChange:r,defaultValue:i||"#",children:[s&&t&&e.jsx("option",{disabled:!0,value:"#",className:"cursor-pointer",children:a.length?s:t}),a.map((c,d)=>e.jsx("option",{value:c.id,className:"cursor-pointer",children:c.name},d))]})]})}function de({typeFilter:a}){const[t,s]=q(),o=({target:i})=>{const r=z(new Date).currentHour,c=i,{value:d}=i.options[c.selectedIndex];var l=0;switch(d){case"today":l=r;break;case"yesterday":l=r+24;break;case"last_7_days":l=r+6*24;break;case"last_14_days":l=r+13*24;break;case"last_month":l=r+29*24;break;case"last_3_month":l=r+89*24;break;case"last_6_month":l=r+179*24;break;case"last_year":l=r+364*24;break;default:l=0;break}const m=new URLSearchParams(t);m.set(a,l.toString()),s(m)};return e.jsx(ie,{handleSelectDatabase:o,Icon:Re,options:[{id:"0",name:"Todas as datas"},{id:"today",name:"Hoje"},{id:"yesterday",name:"Ontem"},{id:"last_7_days",name:"Ultimos 7 dias"},{id:"last_14_days",name:"Ultimos 14 dias"},{id:"last_month",name:"Ultimo mês"},{id:"last_3_month",name:"Ultimos 3 meses"},{id:"last_6_month",name:"Ultimos 6 meses"},{id:"last_year",name:"Ultimo ano"}]})}function wa({client:a,handleRequestDataProject:t,setColumns:s,columns:o}){const{setModalContent:i}=f.useContext(v),r=async({currentTarget:d})=>{if(a!=null&&a.plan_management){const l=d.querySelector("svg");l.classList.add("rotate-[-360deg]","transition-transform","duration-1000"),t(a==null?void 0:a.id);const m=setTimeout(()=>{l.classList.remove("rotate-[-360deg]","transition-transform","duration-1000"),clearTimeout(m)},1e3)}},c=()=>{i({componentName:"modal_organization_column",components:e.jsx(Na,{modalName:"modal_organization_column",setColumns:s,columns:o})})};return e.jsxs("div",{className:"w-full flex gap-8 justify-end items-center",children:[e.jsx("div",{className:"p-2 bg-dark border border-primary-100 rounded-md cursor-pointer",onClick:r,children:e.jsx(ne,{className:"text-xl"})}),e.jsx("div",{className:"h-[40px]",children:e.jsx(de,{typeFilter:"filter_time_metric"})}),e.jsxs(C,{onClick:c,customClass:"bg-dark border border-primary-100 px-4",children:[" ",e.jsx(Oe,{className:"text-xl"})," Organize as colunas"]})]})}const K=[{key:"IS_ONLINE",columnName:"status",status:!0,dataType:"boolean"},{key:"NAME",columnName:"Nome do chat",status:!0,dataType:"string"},{key:"CAT",columnName:"Chats abertos (total)",status:!0,dataType:"number"},{key:"CAU",columnName:"Chats abertos (unico)",status:!1,dataType:"number"},{key:"MESSAGE_INPUT",columnName:"Mensagens de entrada",status:!1,dataType:"number"},{key:"MESSAGE_OUTPUT",columnName:"Mensagens de saída",status:!1,dataType:"number"},{key:"MESSAGES_TOTAL",columnName:"Mensagens total",status:!0,dataType:"number"},{key:"MEDIA_MESSAGES_CHAT",columnName:"Mensagens por chat",status:!1,dataType:"number"},{key:"USAGE_TIME",columnName:"Tempo de uso",status:!1,dataType:"string"},{key:"MEDIA_USAGE_TIME",columnName:"Tempo de uso por chat",status:!0,dataType:"string"},{key:"LINK_CLICKS",columnName:"Cliques no link",status:!0,dataType:"number"},{key:"LEADS_COLLECTED",columnName:"Leads coletados",status:!0,dataType:"number"},{key:"SERVICE_NOTE",columnName:"Nota de atendimento",status:!0,dataType:"number"},{key:"RESOLUTION_RATE",columnName:"Taxa de resolução",status:!0,dataType:"number"},{key:"CREATED_AT",columnName:"Criado em",status:!0,dataType:"string"}];function va({setColumns:a,columns:t}){return f.useEffect(()=>{const s=JSON.parse(localStorage.getItem("metricColumnActive")||"[]");s.length>0?s.length!==K.length?localStorage.setItem("metricColumnActive",JSON.stringify(K)):a(s):localStorage.setItem("metricColumnActive",JSON.stringify(K))},[]),t&&e.jsx("div",{className:"w-1/2 flex",children:t.map(s=>s.status&&e.jsx("span",{className:"w-48 flex-none p-3 text-center bg-primary-300 border-r border-r-primary-100",children:s.columnName},s.columnName))})}function P(a){const t=Number(new Date),s=Number(new Date(a)),i=(t-s)/(1e3*3600);return Math.floor(i)}function se(a,t=0){function s(){return a.metric.chat_event.reduce((p,x)=>{const u=x.open_chat.filter(b=>{const w=P(b.created_at);return t>0?w<=t:!0});return p+u.length},0)}function o(){return(a.metric.chat_event.filter(x=>{const u=P(x.created_at);return t>0?u<=t:!0})||[]).filter((x,u,b)=>u===b.findIndex(w=>w.guest_id===x.guest_id)).length}function i(){return a.plan_message_manager.filter(p=>{const x=P(p.created_at);return t>0?x<=t:!0},0).reduce((p,x)=>p+x.input,0)}function r(){return a.plan_message_manager.filter(p=>{const x=P(p.created_at);return t>0?x<=t:!0},0).reduce((p,x)=>p+x.output,0)}function c(){const h=i()+r(),p=o()>0?h/o():0;return p%1===0?p:Number(p.toFixed(1))}function d(){const h=a.metric.chat_event.reduce((w,S)=>{const A=S.chat_time.filter(T=>{const y=P(T.created_at);return t>0?y<=t:!0});return w+A.reduce((T,y)=>{if(!y.closed_at&&!y.created_at)return 0;const E=Number(new Date(y.closed_at))-Number(new Date(y.created_at));return T+E},0)},0),p=Math.floor(h/1e3),x=Math.floor(p/60);return`${Math.floor(x/60).toString().padStart(2,"0")}:${(x%60).toString().padStart(2,"0")}:${(p%60).toString().padStart(2,"0")}`}function l(){const h=a.metric.chat_event.reduce((S,A)=>{const T=A.chat_time.filter(y=>{const E=P(y.created_at);return t>0?E<=t:!0});return S+T.reduce((y,E)=>{if(!E.closed_at&&!E.created_at)return 0;const j=Number(new Date(E.closed_at))-Number(new Date(E.created_at));return y+j},0)},0),p=h>0?h/o():0,x=Math.floor(p/1e3),u=Math.floor(x/60),b=Math.floor(u/60),w=`${b.toString().padStart(2,"0")}:${(u%60).toString().padStart(2,"0")}:${(x%60).toString().padStart(2,"0")}`;return b!==1/0?w:"00:00:00"}function m(){return a.metric.button_event.filter(p=>{const x=P(p);return t>0?x<=t:!0},0).reduce((p,x)=>p+x.clicked_button.length,0)}function g(){return z(a.created_at).dateFormat_A}return{IS_ONLINE:a.is_online||!1,NAME:a.project_name,CAT:s(),CAU:o(),MESSAGE_INPUT:i(),MESSAGE_OUTPUT:r(),MESSAGES_TOTAL:i()+r(),MEDIA_MESSAGES_CHAT:c(),USAGE_TIME:d(),MEDIA_USAGE_TIME:l(),CREATED_AT:g(),LINK_CLICKS:m(),LEADS_COLLECTED:0,SERVICE_NOTE:0,RESOLUTION_RATE:0,TOKEN_INPUT:"0",TOKEN_OUTPUT:"0",TOKEN_TOTAL:"0",USED_REAL:"0"}}function ya({columns:a,setColumns:t,planManagement:s}){const[o]=q(),i=o.get("filter_time_metric");return e.jsxs("div",{className:"w-[70vw] h-[40vh] self-center rounded-xl overflow-x-auto",children:[e.jsx(va,{setColumns:t,columns:a}),e.jsx("div",{className:"flex flex-col",children:s!=null&&s.project?s.project.map(r=>e.jsx("div",{className:"flex-none flex",children:a.map((c,d)=>c.status&&e.jsx("span",{className:"w-48 flex-none text-ellipsis overflow-hidden whitespace-nowrap text-center border border-primary-100/30 p-2",children:d===0?e.jsxs("div",{className:"w-full flex justify-center items-center gap-2",children:[e.jsx("div",{className:`w-[8px] h-[8px] ${r.is_online?"bg-green-700":"bg-red-700"} rounded-full`}),e.jsx("span",{children:r.is_online?"Ativo":"Desativado"})]}):d===1?r.project_name:se(r,i)[c.key]},c.columnName))},r.id)):e.jsx("h2",{className:"text-center p-4",children:'Você ainda não criou nenhum chat, clique em "Meus chats" , depois criar "Novo chat".'})}),e.jsx("div",{className:"flex-none flex bg-primary-300",children:a.map((r,c)=>r.status&&e.jsx("div",{className:"w-48 flex-none p-2 flex justify-center items-center gap-2",children:c===1?e.jsx("span",{className:"w-full font-bold text-primary-100 text-xl text-center",children:"TOTAL"}):r.dataType==="number"?e.jsx("span",{className:"w-full font-bold text-primary-100 text-xl text-center",children:s==null?void 0:s.project.reduce((d,l)=>d+Number(se(l,i)[r.key]),0)}):e.jsx("span",{className:"w-full text-primary-100 text-xl text-center",children:"-"})},r.key))})]})}function Ca(){const a=JSON.parse(localStorage.getItem("metricColumnActive")||"[]"),{setModalContent:t}=f.useContext(v),{client:s}=f.useContext(k),[o,i]=f.useState(a),[r,c]=f.useState(s==null?void 0:s.plan_management);f.useEffect(()=>{s!=null&&s.plan_management&&d(s==null?void 0:s.id)},[]);const d=async l=>{const m=await Fe(l);(m==null?void 0:m.status)===200?c(m.data.plan_management):t({componentName:"modal_failed_load_metric",components:e.jsx(N,{message:"Falha ao recarregar as métricas, tente reiniciar a página.",type:"ERROR",componentName:"modal_failed_load_metric"})})};return e.jsx("div",{className:"w-full h-full overflow-y-auto flex flex-col gap-8",children:e.jsxs(F,{title:"Métricas",className:"flex-col gap-8",children:[e.jsx(wa,{client:s,columns:o,handleRequestDataProject:d,setColumns:i}),e.jsx(ya,{columns:o,planManagement:r,setColumns:i})]})})}function Sa({plan_management_id:a}){const{client:t}=f.useContext(k),{setModalContent:s}=f.useContext(v),o=V(),i=()=>{if(t!=null&&t.plan_management){const r=t.plan_management.plan.max_databases,c=t.plan_management.prompt.length;t.plan_management.status!=="DISABLED"?r>c?o(`/create-database/${a}`):s({componentName:"modal_max_database",components:e.jsx(N,{message:"Você atingiu o número maximo de base de dados no seu plano.",componentName:"modal_max_database"})}):s({componentName:"modal_desactive_account",components:e.jsx(N,{message:"O plano da sua conta está desabilitado.",componentName:"modal_desactive_account"})})}else s({componentName:"modal_without_plan",components:e.jsx(N,{message:"Nenhum plano foi vinculado a sua conta",componentName:"modal_without_plan"})})};return e.jsx(Le,{className:"w-[300px] text-5xl py-3",onClick:i})}function Aa(){const{control:a}=U(),{append:t,remove:s,fields:o}=J({control:a,name:"step_6.questions"});return e.jsxs("div",{className:"w-full flex flex-col gap-6 justify-center items-center",children:[e.jsxs("div",{className:"w-full flex justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Adicione as perguntas e as respostas frequentes"}),e.jsxs(C,{type:"button",onClick:()=>t({ask:"",answer:""}),children:["Adicionar",e.jsx(H,{className:"text-lg"})]})]}),e.jsx("div",{className:"w-full flex flex-col gap-4",children:o.map((i,r)=>e.jsxs("div",{className:"w-full flex gap-4 justify-center items-center",children:[e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(n.Input,{name:`step_6.questions.${r}.ask`,title:"Digite uma pergunta"}),e.jsx(n.Input,{name:`step_6.questions.${r}.answer`,title:"Digite a resposta"})]}),e.jsx("div",{children:e.jsx(Z,{className:"fill-red-700 bg-red-900/50 rounded-full p-1 text-2xl cursor-pointer",onClick:()=>s(r)})})]},i.id))})]})}function ka({prompt:a,setPrompts:t}){const{setModalContent:s,clearModal:o}=f.useContext(v),{client:i,setClient:r}=f.useContext(k),c=JSON.parse(a.prompt_query||"{}"),d=!!Object.keys(c).length,l=Q({resolver:ce(Qe),defaultValues:d?{step_0:{who_created:c.step_0.who_created||"",andvisa_record:c.step_0.andvisa_record||"",how_works:c.step_0.how_works||"",what_is:c.step_0.what_is||""},step_1:{benefits:c.step_1.benefits||"",contraindications:c.step_1.contraindications||"",ingredients:c.step_1.ingredients||"",side_effects:c.step_1.side_effects||""},step_2:{average_delivery_time:{end:c.step_2.average_delivery_time.end||0,start:c.step_2.average_delivery_time.start||0},order_tracking:c.step_2.order_tracking||"",tracking_link:c.step_2.tracking_link||""},step_3:{days_of_warranty:c.step_3.days_of_warranty||0,disclaimer:c.step_3.disclaimer||"",how_exchanges_work_and_returns:c.step_3.how_exchanges_work_and_returns||"",how_guarantee_work:c.step_3.how_guarantee_work||""},step_4:{how_to_buy:c.step_4.how_to_buy||"",payment_methods:c.step_4.payment_methods||"",products:c.step_4.products||""},step_5:{address:c.step_5.address||"",CNPJ:c.step_5.CNPJ||"",company_name:c.step_5.company_name||"",contact_email:c.step_5.contact_email||"",contact_phone_number:c.step_5.contact_phone_number||"",support_hours:c.step_5.support_hours||""},step_6:{questions:c.step_6.questions||""},step_7:{client_describe:c.step_7.client_describe||"",ia_name:c.step_7.ia_name||"",restrictions:c.step_7.restrictions}}:void 0}),{fields:m,append:g,remove:h}=J({control:l.control,name:"step_4.products"}),p=async u=>{const b=JSON.stringify(u),S={prompt:We(u),prompt_query:b,client_describe:u.step_7.client_describe};if(S){const A=await Ke(S,a.id);A&&A.status===200&&(t(T=>[...T.filter(y=>y.id!==A.data.id),A.data]),s({componentName:"modal_updated_database",components:e.jsx(N,{message:"Database atualizado com sucesso",componentName:"modal_updated_database",functionAfterComplete:()=>o(null,{clearAll:!0})})}))}};async function x(){if(a.id){const u=await Xe(a.id);if((u==null?void 0:u.status)===200){t(w=>w.filter(S=>S.id!==u.data.id));const b=i==null?void 0:i.plan_management.prompt.findIndex(w=>w.id===a.id);i&&b&&(i.plan_management.prompt.splice(b,1),r(i)),s({componentName:"modal_delete_success",components:e.jsx(N,{message:"Fonte de dados excluido com sucesso!",componentName:"modal_delete_success",functionAfterComplete:()=>o(null,{clearAll:!0})})})}else(u==null?void 0:u.status)===500&&s({componentName:"modal_failed_delete_database",components:e.jsx(N,{message:"Você não pode excluir uma fonte de dados que possui um chat vinculado a ela, tente excluir todos os chats primeiro, antes de excluir essa fonte de dados.",type:"ERROR",componentName:"modal_failed_delete_database"})})}}return e.jsx("div",{className:"w-[80vw] h-[70vh] flex overflow-auto ",children:e.jsxs(n.EditForm,{form:l,onDelete:x,onSubmit:p,children:[e.jsxs(n.EditStep,{index:0,titleStep:"Informações básicas",icon:e.jsx($e,{}),children:[e.jsx(n.Input,{title:"Quem foi o criador desse produto?",name:"step_0.who_created"}),e.jsx(n.TextArea,{title:"Conte um pouco sobre seu produto...",name:"step_0.what_is"}),e.jsx(n.TextArea,{title:"Como ele funciona?",name:"step_0.how_works"}),e.jsx(n.Optional,{text:"O produto possui registro na ANVISA?",children:e.jsx(n.Input,{title:"Digite o registro da ANVISA:",name:"step_0.andvisa_record"})})]}),e.jsxs(n.EditStep,{index:1,titleStep:"Informações avançadas",icon:e.jsx(Ue,{}),children:[e.jsx(n.TextArea,{name:"step_1.benefits",title:"Quais são os beneficios do seu produto?"}),e.jsx(n.TextArea,{name:"step_1.ingredients",title:"Quais são os ingredientes do seu produto?"}),e.jsx(n.Optional,{active:!0,text:"Esse produto possui alguma contra indicação?",name:"step_1.contraindications",children:e.jsx(n.TextArea,{name:"step_1.contraindications",title:"Quais são as contra-indicações do seu produto?"})}),e.jsx(n.Optional,{active:!0,text:"Existe algum efeito colateral?",name:"step_1.side_effects",children:e.jsx(n.TextArea,{name:"step_1.side_effects",title:"Quais?"})})]}),e.jsxs(n.EditStep,{index:2,titleStep:"Entrega do produto",icon:e.jsx(qe,{}),children:[e.jsxs(n.Container,{className:"flex gap-4",title:"Qual o prazo médio em dias para entrega:",children:[e.jsx(n.Input,{type:"number",min:1,max:365,name:"step_2.average_delivery_time.start",title:"de:",joinAtInput:"dia(s)"}),e.jsx(n.Input,{type:"number",min:1,max:365,name:"step_2.average_delivery_time.end",title:"até:",joinAtInput:"dia(s)"})]}),e.jsx(n.TextArea,{name:"step_2.order_tracking",title:"Como os clientes podem rastrear seu pedido?"}),e.jsx(n.Optional,{active:!1,text:"Você possui link para rastrear pedido?",children:e.jsx(n.Input,{title:"Digite a url do site:",name:"step_2.tracking_link",onChange:({target:u})=>{u.value.toLowerCase().includes("http")||(u.value=`https://${u.value.replace("http","")}`)}})})]}),e.jsxs(n.EditStep,{index:3,titleStep:"Politicas e condições",icon:e.jsx(ze,{}),children:[e.jsx(n.Input,{type:"number",name:"step_3.days_of_warranty",title:"Quantos dias o cliente tem de garantia?"}),e.jsx(n.TextArea,{name:"step_3.how_guarantee_work",title:"Como funciona a garantia?"}),e.jsx(n.TextArea,{name:"step_3.how_exchanges_work_and_returns",title:"Como funciona as trocas e devoluções?"}),e.jsx(n.Optional,{active:!1,text:"Gostaria de deixar um disclaimer para seus clientes?",children:e.jsx(n.TextArea,{name:"step_3.disclaimer",title:"Aviso legal ( Disclaimer )"})})]}),e.jsxs(n.EditStep,{index:4,titleStep:"Métodos de pagamentos",icon:e.jsx(Be,{}),children:[e.jsx(n.Container,{className:"flex gap-4",title:"Quais são os métodos de pagamentos aceitos?",children:e.jsx(n.Select,{title:"Escolha seus métodos de pagamentos",isMultiple:!0,name:"step_4.payment_methods",options:[{value:"Pix",text:"Pix"},{value:"Boleto",text:"Boleto"},{value:"Cartão de débito",text:"Cartão de débito"},{value:"Cartão de crédito",text:"Cartão de crédito"},{value:"Pagamentos em aplicativo",text:"Pagamentos em aplicativo"}]})}),e.jsx(n.TextArea,{name:"step_4.how_to_buy",title:"como comprar seu produto?"}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("div",{className:"w-full flex justify-end",children:e.jsx(C,{type:"button",onClick:()=>g({name:"",value:"R$ 0"}),children:" Adicionar produto"})}),e.jsx(n.Container,{className:"flex flex-col gap-4",children:m.map((u,b)=>e.jsxs("div",{className:"flex justify-center items-center gap-8",children:[e.jsxs("div",{className:"w-4/5 flex gap-6 justify-center items-center",children:[e.jsx(n.Input,{name:`step_4.products.${b}.name`,title:"De um nome a esse produto:"}),e.jsx(n.Input,{name:`step_4.products.${b}.value`,onChange:({target:w})=>{const A=(parseFloat(w.value.replace(/[^\d]/g,""))/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});w.value=A},title:"Qual o valor do produto?"})]}),e.jsx(Ge,{onClick:()=>h(b),className:"fill-red-500 text-2xl cursor-pointer"})]},u.id))})]})]}),e.jsxs(n.EditStep,{index:5,titleStep:"Sobre a empresa",icon:e.jsx(Ve,{}),children:[e.jsxs(n.Container,{className:"flex gap-4",children:[e.jsx(n.Input,{name:"step_5.company_name",title:"Qual o nome da empresa?"}),e.jsx(n.Input,{title:"Qual o seu CNPJ?",name:"step_5.CNPJ",onChange:({target:u})=>{if(u.value.length<=18){const w=u.value.replace(/[^\d]/g,"").replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/,"$1.$2.$3/$4-$5");u.value=w}else u.value=u.value.substring(0,18)}})]}),e.jsx(n.Input,{name:"step_5.address",title:"Qual o endereço da sua empresa?"}),e.jsxs(n.Container,{className:"flex gap-4",children:[e.jsx(n.Input,{name:"step_5.contact_email",title:"Digite um e-mail para contato"}),e.jsx(n.Input,{title:"Digite um telefone para contato",name:"step_5.contact_phone_number",onChange:({target:u})=>{const b=u.value.replace(/[^\d]/g,"");if(b.length<11){let w;b.length===11?w=b.replace(/^(\d{2})(\d{1})(\d{4})(\d{4})$/,"($1) $2 $3-$4"):w=b.replace(/^(\d{2})(\d{4})(\d{4})$/,"($1) $2-$3"),u.value=w}else u.value=u.value.substring(0,15)}})]}),e.jsx(n.Input,{name:"step_5.support_hours",title:"Qual seu horário para suporte humano?"})]}),e.jsx(n.EditStep,{index:6,titleStep:"Perguntas frequentes",icon:e.jsx(He,{}),children:e.jsx(Aa,{})}),e.jsxs(n.EditStep,{index:7,titleStep:"Personalidade da IA ",icon:e.jsx(Je,{}),children:[e.jsx(n.Optional,{text:"Deseja dar um nome a sua inteligência artificial?",active:!1,children:e.jsx(n.Input,{name:"step_7.ia_name",title:"Qual o nome da sua inteligência artificial?"})}),e.jsx(n.Optional,{text:"Deseja adicionar restrições de palavras ou frase?",active:!1,name:"step_7.restrictions",children:e.jsx(n.Input,{name:"step_7.restrictions",title:"Faça uma lista de restrições para que a IA evite utiliza-la em uma conversa"})}),e.jsx(n.TextArea,{title:"Faça uma breve descrição de quem é seu público (cliente)",name:"step_7.client_describe"})]})]})})}function Ea(){var l;const{client:a}=f.useContext(k),{setModalContent:t,clearModal:s}=f.useContext(v),o=Array(Ye).fill(0),[i,r]=f.useState(((l=a==null?void 0:a.plan_management)==null?void 0:l.prompt)||[]),c=m=>{i!=null&&i.length&&t({componentName:"modal_create_database",components:e.jsx(O,{children:e.jsx(ka,{prompt:i[m],setPrompts:r})})})},d=m=>{async function g(h){h.preventDefault();const p=h.target.querySelector("input").value,x=i[m].id;if(p){const u=await aa(p,x);(u==null?void 0:u.status)===200&&(r([...i,i[m].prompt_name=p]),t({componentName:"modal_saved",components:e.jsx(N,{message:"Nome da sua base de dados foi atualizado com sucesso!",componentName:"modal_saved",functionAfterComplete:()=>s(null,{clearAll:!0})})}))}}t({componentName:"modal_edit_name",components:e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col justify-center items-center gap-4",children:[e.jsx("h2",{children:"Digite o novo nome da sua fonte de dados:"}),e.jsxs("form",{onSubmit:g,className:"flex flex-col justify-center items-center gap-4",children:[e.jsx("input",{placeholder:"Ex: Minha nova base de dados",name:"database_name",defaultValue:i[m].prompt_name}),e.jsx(C,{children:"Salvar"})]})]})})})};return a&&e.jsx(F,{title:"Fonte de dados",children:e.jsx("div",{className:"w-full flex-wrap flex justify-center p-4 my-12 gap-8",children:o.map((m,g)=>{var h,p,x,u,b;return(h=a.plan_management)!=null&&h.plan&&g<a.plan_management.plan.max_databases?e.jsx("div",{"data-prompt":!!((p=i[g])!=null&&p.prompt_name),className:"flex justify-center items-center rounded-xl cursor-pointer border border-primary-100 bg-primary-300 hover:bg-primary-200 text-xl data-[prompt=false]:text-2xl data-[prompt=false]:bg-primary-200/20",children:(x=i[g])!=null&&x.prompt_name?e.jsxs("div",{className:"w-[300px] flex gap-2 items-center justify-center",children:[e.jsxs("h2",{className:"w-[200px] text-center py-4 flex justify-center items-center gap-2 ",onClick:()=>c(g),children:[e.jsx(Ze,{}),e.jsx("span",{className:"w-full whitespace-nowrap text-ellipsis overflow-x-hidden",children:(u=i[g])==null?void 0:u.prompt_name})]}),e.jsx(ea,{className:"cursor-text ",onClick:()=>d(g)})]}):e.jsx(Sa,{plan_management_id:a.plan_management.id})},g):e.jsx("div",{"data-prompt":!!((b=i[g])!=null&&b.prompt_name),className:"flex opacity-30 cursor-not-allowed justify-center items-center rounded-xl border border-primary-100 bg-primary-300 hover:bg-primary-200 text-xl data-[prompt=false]:text-2xl data-[prompt=false]:bg-primary-200/20",children:e.jsx($,{className:"w-[300px] py-3 text-5xl"})},g)})})})}function Ia({chats:a,setIndex:t}){const s=o=>{t(o)};return e.jsx("div",{className:"w-[300px] flex flex-col border-r border-light/40",children:a==null?void 0:a.map((o,i)=>e.jsxs("div",{className:"w-full cursor-pointer hover:bg-primary-200 transition-colors p-4 border border-primary-100/20",onClick:()=>s(i),children:[e.jsx("h2",{className:"whitespace-nowrap text-ellipsis overflow-hidden py-1 text-xl font-bold",children:o.messages.length>1?o.messages[1].message.replace("<br/>",""):`Chat ${i.toString().padStart(2,"0")}`},o.messages.join()),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"italic text-xs",children:[o.messages.length," messagens"]}),e.jsx("span",{className:"italic text-xs",children:z(o.messages[o.messages.length-1].time).dateFormat_A})]})]},o.id))})}function Ta({chats:a,index:t}){var r;const{client:s}=f.useContext(k),[o,i]=f.useState();return f.useEffect(()=>{var c,d;if(a.length){const l=(c=s==null?void 0:s.plan_management.project.find(g=>a&&g.id===a[t].project_id))==null?void 0:c.logo,m=(d=s==null?void 0:s.plan_management.project.find(g=>a&&g.id===a[t].project_id))==null?void 0:d.project_name;l&&m&&i({logoChat:l,projectName:m})}},[]),o&&e.jsx("div",{className:"w-2/3 overflow-auto flex flex-col",children:e.jsxs("div",{className:"w-full flex flex-col gap-4",children:[e.jsxs("div",{className:"w-full h-[60px] flex items-center px-4 bg-primary-100",children:[e.jsx("div",{className:"w-[50px] h-[50px] overflow-hidden rounded-full",children:e.jsx("img",{src:o==null?void 0:o.logoChat,alt:"logo do cliente",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"px-4 text-xl",children:o==null?void 0:o.projectName})]}),e.jsx("div",{className:"w-full h-[350px] p-4 flex flex-col gap-4 overflow-y-auto",children:(r=a[t])!=null&&r.messages?a[t].messages.map((c,d)=>e.jsx("div",{"data-player":c.player,className:"w-full flex data-[player='1']:justify-end justify-start",children:e.jsxs("div",{"data-player":c.player,className:"bg-light text-black/80 data-[player='1']:bg-primary-200 data-[player='1']:text-light p-2 rounded-xl max-w-md",children:[e.jsx("h2",{className:"",dangerouslySetInnerHTML:{__html:c.message}}),e.jsx("span",{className:"w-full flex justify-end text-xs italic",children:z(c.time).shortHour})]})},d)):e.jsx("h2",{className:"w-full h-[200px] flex justify-center items-center",children:"Ainda não existe nenhuma conversa para esse chat"})})]})})}function Da(){var g;const{client:a}=f.useContext(k),[t,s]=q(),[o,i]=f.useState(0),[r,c]=f.useState([]),d=(g=a==null?void 0:a.plan_management)==null?void 0:g.project.map(h=>Object({id:h.project_name.replace(" ","_"),name:h.project_name}));f.useEffect(()=>{const h=t.get("filter_time_chats"),p=t.get("project");if(a&&d!=null&&d.length){let x;p?x=a.plan_management.project.filter(b=>b.project_name.replace(" ","_")===p&&b):x=a.plan_management.project;const u=x.map(b=>b.chat.filter(S=>Number(h)?P(S.created_at)<=Number(h):!0)).flat();c(u)}},[t]);const l=({target:h})=>{const p=h.selectedIndex,x=h.options[p].value,u=new URLSearchParams(t);u.set("project",x),s(u)},m=async({currentTarget:h})=>{if(a!=null&&a.plan_management){const p=h.querySelector("svg");p.classList.add("rotate-[-360deg]","transition-transform","duration-1000");const x=setTimeout(()=>{p.classList.remove("rotate-[-360deg]","transition-transform","duration-1000"),clearTimeout(x)},1e3)}};return e.jsxs(F,{title:"Registros",className:"px-8",children:[e.jsxs("div",{className:"w-full flex gap-8 h-[40px]",children:[e.jsx(M,{tip:"Selecione uma data  como filtro",children:e.jsx(de,{typeFilter:"filter_time_chats"})}),e.jsx(M,{tip:"Selecione um chat",children:e.jsx(ie,{options:d||[],Icon:ta,handleSelectDatabase:l})}),e.jsx(M,{tip:"Atualize seus chats",children:e.jsx("div",{className:"p-2 bg-primary-100 rounded-md cursor-pointer",onClick:m,children:e.jsx(ne,{className:"text-xl"})})})]}),e.jsxs("div",{className:"w-full flex bg-gray my-4",children:[e.jsx(Ia,{chats:r,setIndex:i}),!!r.length&&e.jsx(Ta,{chats:r,index:o})]})]})}function Ma({plan_management:a}){return e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsx("h2",{className:"text-xl p-2",children:"Historico de transações"}),e.jsx("div",{className:"w-full max-w-[1000px]",children:a?e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("div",{className:"w-full flex p-4 justify-between border border-zinc-800",children:[e.jsx("span",{className:"w-1/3 text-center",children:"Plano"}),e.jsx("span",{className:"w-1/3 text-center",children:"Transação"}),e.jsx("span",{className:"w-1/3 text-center",children:"Data e hora"}),e.jsx("span",{className:"w-1/3 text-center",children:"Valor do plano"}),e.jsx("span",{className:"w-1/3 text-center",children:"Método de pagamento"}),e.jsx("span",{className:"w-1/3 text-center",children:"Status"})]}),a.trasaction.map((t,s)=>e.jsxs("div",{className:"w-full flex px-4 justify-between border border-zinc-500/20",children:[e.jsx("span",{className:"w-1/3 text-center",children:a.plan.plan_name}),e.jsx("span",{className:"w-1/3 text-center",children:t.transaction_describe==="PAYMENT"?"Pagamento":t.transaction_describe==="REFUND_REQUEST"?"Reembolso solicitado":t.transaction_describe==="SUBSCRIPTION_CANCELLATION"?"Plano cancelado":"Reembolso cancelado"}),e.jsx("span",{className:"w-1/3 text-center",children:z(t.created_at).dateFormat_A}),e.jsxs("span",{className:"w-1/3 text-center",children:["R$",Number(t.amount_paid).toFixed(2).replace(".",",")]}),e.jsx("span",{className:"w-1/3 text-center",children:t.payment_method}),e.jsx("span",{className:"w-1/3 text-center",children:t.status==="APPROVED"?"Aprovado":t.status==="REJECT"?"Recusado":"Pendente"})]},s))]}):e.jsx("h2",{className:"text-zinc-500",children:"Você ainda não efetuou nenhum pagamento"})})]})}function Pa({plan_management:a}){return a&&a.status!=="DISABLED"?e.jsx("span",{className:"font-bold text-yellow-600 uppercase",children:a.plan.plan_name}):e.jsx("span",{className:"text-zinc-400/60",children:"Sem plano"})}function me(a){const i=(new Date(a)-new Date)/(1e3*60*60*24);return Number(i.toFixed(0))}function Ra({plan_management:a}){const t=()=>a?me(a.free_trial):0;return a&&a.status!=="DISABLED"&&e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("span",{children:["Projetos criados: ",a.project.length," / ",a.plan.max_projects]}),e.jsxs("span",{children:["Limite de messages: ",ca(a).totalMessages," / ",a.plan.max_messages," "]}),e.jsxs("span",{children:["Reembolso garantido: ",t()>0?t()+" dias restantes":"expirado"]}),e.jsxs("span",{children:["Status do plano: ",a.status==="ACTIVE"?"Ativo":"Desativado"]})]})}function Oa({client:a}){const t=V(),s=()=>{t("/plans")};return(a!=null&&a.refund_requested.length&&a.refund_requested[0].status!=="PENDING",!0)&&e.jsx("div",{className:"w-full flex flex-col gap-4 my-4",children:e.jsx(C,{onClick:s,children:a!=null&&a.plan_management&&a.plan_management.status!=="DISABLED"?"Mudar de plano":"Adicionar plano"})})}async function Fa(a){return await oe.post(`${re}/refund_requested`,a).catch(s=>console.log(s))}async function La(a){return await oe.post(`${re}/refund_requested/reactive`,{client_id:a}).catch(s=>console.log(s))}function $a({client:a}){const{setModalContent:t}=f.useContext(v),s=()=>a!=null&&a.plan_management?me(a==null?void 0:a.plan_management.free_trial):0,o=async()=>{if(a){const d=prompt("Digite o motivo do seu cancelamento:"),l=prompt("Digite de 0 a 5, o quanto você gostou do nosso sistema"),m={client_id:a.id,reason:d||"",product_review:Number(l||0)};await Fa(m)?(t({componentName:"modal_request_success",components:e.jsx(N,{message:"Solicitação de reembolso foi enviada com sucesso!",componentName:"modal_request_success"})}),setTimeout(()=>window.location.reload(),1e3)):t({componentName:"modal_error_request",components:e.jsx(N,{message:"Ocorreu um erro ao enviar sua solicitação de reembolso, por favor entre em contato com nosso suporte.",componentName:"modal_error_request"})})}else t({componentName:"modal_error_client",components:e.jsx(N,{message:"Erro ao processar o cliente, por favor recarregue a página.",componentName:"modal_error_client"})})},i=()=>{if(a!=null&&a.plan_management)return a!=null&&a.refund_requested.length&&a.plan_management.status==="ACTIVE"&&s()>0?a.refund_requested[0].status!=="PENDING":s()>0&&a.plan_management.status!=="DISABLED"},r=()=>{a?window.open(`https://dash.ticto.com.br/subscription-verification?code=${a==null?void 0:a.ticto_order_code}&email=${a==null?void 0:a.purchase_email}`):t({componentName:"modal_failed_cancel",components:e.jsx(N,{message:"Falha ao preencher os dados de cancelamento, por favor entre em contato com o suporte.",componentName:"modal_failed_cancel"})})},c=()=>{if(a!=null&&a.plan_management&&a.plan_management.status==="ACTIVE"&&s()<=0)return!!(a.refund_requested.length&&a.refund_requested[0].status!=="PENDING")};return i()?e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("a",{onClick:o,className:"text-center underline cursor-pointer",children:"Pedir reembolso"})}):c()&&e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("a",{onClick:r,className:"text-center underline cursor-pointer",children:"Gerenciar assinatura"})})}function Ua({client:a}){return e.jsxs("div",{className:"w-1/2 min-w-[150px] max-w-[400px] border border-zinc-600 p-2 rounded-md",children:[e.jsx("h2",{className:"w-full text-center",children:"Plano atual:"}),e.jsx("div",{className:"w-full flex justify-center p-4",children:e.jsx(Pa,{plan_management:a==null?void 0:a.plan_management})}),e.jsx("div",{className:"w-full flex justify-center p-4",children:e.jsx(Ra,{plan_management:a==null?void 0:a.plan_management})}),e.jsx(Oa,{client:a}),e.jsx($a,{client:a})]})}function qa({client:a}){const{setModalContent:t}=f.useContext(v),s=async()=>{a&&await La(a.id)&&(t({componentName:"modal_reactive_plan",components:e.jsx(N,{message:"Plano reativado com  sucesso!",componentName:"modal_reactive_plan"})}),setTimeout(()=>window.location.reload(),1500))};return!!(a!=null&&a.refund_requested.length)&&a.refund_requested[0].status!=="CANCEL"&&e.jsxs("div",{className:"w-1/2 min-w-[150px] max-w-[400px] border border-zinc-600 p-2 rounded-md",children:[e.jsx("h2",{className:"w-full text-center pb-4 text-xl",children:"Reembolso solicitado:"}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Reembolso solicidado em:",e.jsx("p",{children:a.refund_requested[0].created_at.substring(0,10)})]}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Plano:",e.jsx("p",{children:a.plan_management.plan.plan_name})]}),e.jsxs("span",{className:"flex gap-2 text-zinc-400",children:["Status:",a.refund_requested[0].status==="PENDING"?e.jsx("p",{className:"text-red-600",children:"Pendente"}):a.refund_requested[0].status==="APPROVED"?e.jsx("p",{className:"text-green-600",children:"Dinheiro devolvido"}):e.jsx("p",{className:"text-zinc-200",children:"Reembolso cancelado"})]}),e.jsx("div",{className:"w-full flex justify-center mt-6",children:a.refund_requested[0].status==="PENDING"&&e.jsx(C,{onClick:s,children:"Cancelar reembolso"})})]})}function za(){const{client:a}=f.useContext(k);return e.jsxs(F,{title:"Assinatura",className:"flex-col gap-8",children:[e.jsxs("div",{className:"w-full p-4 flex gap-6 justify-center",children:[e.jsx(Ua,{client:a}),e.jsx(qa,{client:a})]}),e.jsx(Ma,{plan_management:a==null?void 0:a.plan_management})]})}function X({name:a}){const{register:t}=U(),[s,o]=f.useState(!1),i=()=>o(r=>!r);return e.jsxs("div",{className:"w-3/5 px-2 rounded-md flex justify-center items-center gap-2 bg-gray_light",children:[e.jsx("input",{className:"",type:s?"text":"password",...t(a)}),e.jsx(sa,{"data-isopen":!!s,className:"text-2xl data-[isopen=false]:hidden",onClick:i}),e.jsx(na,{"data-isopen":!!s,className:"text-2xl data-[isopen=true]:hidden",onClick:i})]})}function Ba(){const{setValue:a}=U(),t=Q(),{handleSubmit:s}=t,{client:o}=f.useContext(k),{setModalContent:i,clearModal:r}=f.useContext(v),c=async d=>{if(!o)throw new Error("Client not founded.");if(d.new_password.length<8||d.current_password.length<8){const g=!d.new_password.length||!d.current_password.length?"Preencha todos os dados":"Informe uma senha com mais de 8 caracteres";i({componentName:"modal_error_fill_data",components:e.jsx(N,{message:g,componentName:"modal_error_fill_data",type:"WARNING"})});return}if(d.new_password!==d.confirm_password){i({componentName:"modal_error_new_password",components:e.jsx(N,{message:"Sua confirmação de senha não é idêntica a sua nova senha!",componentName:"modal_error_new_password",type:"ERROR"})});return}d.client_id=o.id;const l=await oa(d);l||i({componentName:"modal_error_password",components:e.jsx(N,{message:"A sua atual senha está incorreta!",componentName:"modal_error_password",type:"ERROR"})}),(l==null?void 0:l.status)===200&&(a("password",d.new_password),i({componentName:"modal_change_password_success",components:e.jsx(N,{message:"Senha atualizada com sucesso!",componentName:"modal_change_password_success",functionAfterComplete:()=>r(null,{clearLast:!0})})}))};return e.jsx(Y,{...t,children:e.jsxs("form",{className:"flex min-w-[200px] flex-col gap-8",onSubmit:s(c),children:[e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Sua senha atual:"}),e.jsx(X,{name:"current_password"})]}),e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Nova senha:"}),e.jsx(X,{name:"new_password"})]}),e.jsxs("div",{className:"w-full flex gap-4 justify-between items-center",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium ",children:"Confirme sua senha:"}),e.jsx(X,{name:"confirm_password"})]}),e.jsxs(C,{customClass:"flex items-center gap-2",children:[e.jsx(le,{})," Salvar"]})]})})}function Ga(){const{setModalContent:a}=f.useContext(v),{client:t,setClient:s}=f.useContext(k),o=Q({defaultValues:{fullname:t==null?void 0:t.fullname,user:t==null?void 0:t.user,cpf_cnpj:t==null?void 0:t.cpf_cnpj,email:t==null?void 0:t.email,password:"senha-qualquer"}}),{handleSubmit:i}=o,r=async l=>{if((t==null?void 0:t.user)===l.user||await ra(l.user)){l.client_id=t==null?void 0:t.id;const m=await la(l);(m==null?void 0:m.status)===200&&(s(m.data),a({componentName:"modal_user_success",components:e.jsx(N,{componentName:"modal_user_success",message:"Perfil atualizado com sucesso"})}))}else a({componentName:"modal_error_user",components:e.jsx(N,{componentName:"modal_error_user",message:"Usuário informado não está disponível!",type:"WARNING"})})},c=()=>{a({componentName:"modal_show_password",components:e.jsx(O,{children:e.jsx(Y,{...o,children:e.jsx(Ba,{})})})})},d=()=>{a({componentName:"modal_show_email",components:e.jsx(N,{componentName:"modal_show_email",message:"Ainda não é possível atualizar o e-mail, para mais informações entre em contato com o suporte.",type:"WARNING"})})};return e.jsx(F,{title:"Configurações",children:e.jsx(Y,{...o,children:e.jsxs("form",{onSubmit:i(r),className:"w-2/3 mx-auto p-4 px-8 flex flex-col gap-6",children:[e.jsxs(n.Container,{className:"flex items-center gap-4",children:[e.jsx(n.Input,{name:"fullname",title:"Nome completo"}),e.jsx(n.Input,{name:"user",title:"Usuário"})]}),e.jsx(n.Input,{name:"cpf_cnpj",title:"CNPJ ou CPF"}),e.jsxs(n.Container,{className:"flex gap-4 justify-center items-center",children:[e.jsx(n.Container,{children:e.jsx(n.Input,{type:"email",name:"email",title:"Informe seu e-mail",disabled:!0})}),e.jsxs(C,{type:"button",customClass:"min-w-[200px] flex justify-center items-center gap-2",onClick:d,children:["Alterar e-mail",e.jsx($,{})]})]}),e.jsxs(n.Container,{className:"flex gap-4 justify-center items-center",children:[e.jsx(n.Container,{children:e.jsx(n.Input,{type:"password",name:"password",title:"Sua senha",disabled:!0})}),e.jsxs(C,{type:"button",customClass:"min-w-[200px] flex justify-center items-center gap-2",onClick:c,children:["Alterar senha",e.jsx($,{})]})]}),e.jsxs(C,{customClass:"flex gap-2 mt-8",children:["Salvar ",e.jsx(le,{})]})]})})})}function Va(){const[a]=q(),t=Number(a.get("tab"))||0;return e.jsx("div",{className:"w-full p-8 overflow-hidden",children:t===0?e.jsx(ja,{}):t===1?e.jsx(Ca,{}):t===2?e.jsx(Ea,{}):t===3?e.jsx(Da,{}):t===4?e.jsx(za,{}):e.jsx(Ga,{})})}function Qa(){return e.jsxs("div",{className:"w-[90%] h-full flex-grow flex flex-col items-center bg-gradient-to-br from-primary-100 from-[10%] to-light to-[20%] dark:to-dark",children:[e.jsx(da,{}),e.jsx(Va,{})]})}export{Qa as default};
